<div class="alert alert-success"><div class="icon"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"></path></svg></div><div class="message"><div class="title"> 说明</div><p>本文作为洛谷UVA1086 The Ministers' Major Mess<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>的题解，已经在洛谷发布。
<a href="https://www.luogu.com.cn/problem/solution/UVA1086">https://www.luogu.com.cn/problem/solution/UVA1086</a></p>
</div></div>
<h2 id="ti-yi-jian-shu" tabindex="-1">题意简述</h2>
<p>有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>B</mi><mo>≤</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">1 \leq B \leq 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span>）个提案和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>M</mi><mo>≤</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">1 \leq M \leq 500</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">500</span></span></span></span>）个议员。每个议员可以对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>K</mi><mo>≤</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">1 \leq K \leq 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span>）个提案投票，作出 <strong>通过</strong> 或者 <strong>否决</strong> 的决定。现在你需要对每个议案的最终结果作出判断，使得每个议员的决定都有超过半数以上和最终结果相吻合。</p>
<h2 id="ti-mu-fen-xi" tabindex="-1">题目分析</h2>
<p>首先要注意 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> 的范围非常小，我们可以分情况讨论：
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> ，那么这个议员的决定必须是最后结果，才能满足 <strong>使得每个议员的决定都有超过半数以上和最终结果相吻合</strong>。
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">K=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> ，此时需要注意 <strong>超过半数以上</strong> 的含义，在原题的 pdf 文档中的英文描述是 <strong>more than half</strong>，这意味着符合的数目要比一半多，不能等于一半。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">K=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 的时候的一半是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，比一半多意味着两个决定都要与最终吻合。
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">K=3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>，按照上述思路，需要有至少两个决定与最终结果吻合。也就是说如果有一个决定不吻合了，那么剩下的两个决定都必须吻合。
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">K=4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span>，一半是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>，超过一半，也就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>，需要有至少 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> 个决定与最终吻合，一个决定不吻合了剩下三个就都需要吻合。
这种如果一个决定不吻合，剩下两个/三个都必须吻合，启示我们可以使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>−</mo><mi>S</mi><mi>A</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">2-SAT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 来解决。</p>
<h2 id="dai-ma-fen-xi" tabindex="-1">代码分析</h2>
<p>下面规定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span> 表示一个提案，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> 表示对这个提案做出的决定。点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 表示的是提案为<strong>否定</strong>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">se</span></span></span></span>；点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">i+n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 表示的是提案为<strong>通过</strong>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">true</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span>。
对于提案最终必须是某种情况，我们可以写个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>u</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">must</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span></span></span></span> 函数：提案 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span> 最后必须是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> 情况。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="aW5saW5lJTIwdm9pZCUyMG11c3QoaW50JTIwZSUyQ2NoYXIlMjBhKSU3QiUwQSUwOWlmKGElM0QlM0QneScpJTdCJTBBJTA5JTA5YWRkKGUlMkNlJTJCbiklM0IlMEElMDklN0RlbHNlJTdCJTBBJTA5JTA5YWRkKGUlMkJuJTJDZSklM0IlMEElMDklN0QlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div></div><div class="code"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">must</span><span class="hljs-params">(<span class="hljs-type">int</span> e,<span class="hljs-type">char</span> a)</span></span>{
	<span class="hljs-keyword">if</span>(a==<span class="hljs-string">&#x27;y&#x27;</span>){
		<span class="hljs-built_in">add</span>(e,e+n);
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-built_in">add</span>(e+n,e);
	}
}
</div></code></pre>
<p>想让一个点必须是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">se</span></span></span></span>，可以让这个点的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">true</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span> 向这个点的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">se</span></span></span></span> 连一条边。另一情况同理。
对于一个提案的决定与最终不符的话，其他决定必须相符的情况，我们可以写个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">op</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span></span></span></span> 函数（具体含义看代码）。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="aW5saW5lJTIwdm9pZCUyMG9wKGludCUyMGUxJTJDY2hhciUyMGExJTJDaW50JTIwZTIlMkNjaGFyJTIwYTIpJTdCJTBBJTA5aWYoYTElM0QlM0QneScpJTdCJTBBJTA5JTA5aWYoYTIlM0QlM0QneScpJTIwYWRkKGUxJTJDZTIlMkJuKSUzQiUwQSUwOSUwOWVsc2UlMjBhZGQoZTElMkNlMiklM0IlMEElMDklN0RlbHNlJTdCJTBBJTA5JTA5aWYoYTIlM0QlM0QneScpJTIwYWRkKGUxJTJCbiUyQ2UyJTJCbiklM0IlMEElMDklMDllbHNlJTIwYWRkKGUxJTJCbiUyQ2UyKSUzQiUwQSUwOSU3RCUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div></div><div class="code"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">op</span><span class="hljs-params">(<span class="hljs-type">int</span> e1,<span class="hljs-type">char</span> a1,<span class="hljs-type">int</span> e2,<span class="hljs-type">char</span> a2)</span></span>{
	<span class="hljs-keyword">if</span>(a1==<span class="hljs-string">&#x27;y&#x27;</span>){
		<span class="hljs-keyword">if</span>(a2==<span class="hljs-string">&#x27;y&#x27;</span>) <span class="hljs-built_in">add</span>(e1,e2+n);
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(e1,e2);
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-keyword">if</span>(a2==<span class="hljs-string">&#x27;y&#x27;</span>) <span class="hljs-built_in">add</span>(e1+n,e2+n);
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(e1+n,e2);
	}
}
</div></code></pre>
<p>（定义这两个函数的目的是为了之后的建边的代码好写）
然后建边部分：</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG0lM0JpJTJCJTJCKSU3QiUwQSUwOWludCUyMGslMkNlMSUyQ2UyJTJDZTMlMkNlNCUzQiUwQSUwOWNoYXIlMjBhMSUyQ2EyJTJDYTMlMkNhNCUzQiUwQSUwOWNpbiUzRSUzRWslM0IlMEElMDlpZihrJTNEJTNEMSklN0IlMEElMDklMDljaW4lM0UlM0VlMSUzRSUzRWExJTNCJTBBJTA5JTA5bXVzdChlMSUyQ2ExKSUzQiUwQSUwOSU3RCUwQSUwOWlmKGslM0QlM0QyKSU3QiUwQSUwOSUwOWNpbiUzRSUzRWUxJTNFJTNFYTElM0UlM0VlMiUzRSUzRWEyJTNCJTBBJTA5JTA5bXVzdChlMSUyQ2ExKSUzQiUwQSUwOSUwOW11c3QoZTIlMkNhMiklM0IlMEElMDklN0QlMEElMDlpZihrJTNEJTNEMyklN0IlMEElMDklMDljaW4lM0UlM0VlMSUzRSUzRWExJTNFJTNFZTIlM0UlM0VhMiUzRSUzRWUzJTNFJTNFYTMlM0IlMEElMDklMDlvcChlMSUyQ2ExJTJDZTIlMkNhMiklM0IlMEElMDklMDlvcChlMSUyQ2ExJTJDZTMlMkNhMyklM0IlMEElMDklMDlvcChlMiUyQ2EyJTJDZTElMkNhMSklM0IlMEElMDklMDlvcChlMiUyQ2EyJTJDZTMlMkNhMyklM0IlMEElMDklMDlvcChlMyUyQ2EzJTJDZTIlMkNhMiklM0IlMEElMDklMDlvcChlMyUyQ2EzJTJDZTElMkNhMSklM0IlMEElMDklN0QlMEElMDlpZihrJTNEJTNENCklN0IlMEElMDklMDljaW4lM0UlM0VlMSUzRSUzRWExJTNFJTNFZTIlM0UlM0VhMiUzRSUzRWUzJTNFJTNFYTMlM0UlM0VlNCUzRSUzRWE0JTNCJTBBJTA5JTA5b3AoZTElMkNhMSUyQ2UyJTJDYTIpJTNCJTBBJTA5JTA5b3AoZTElMkNhMSUyQ2UzJTJDYTMpJTNCJTBBJTA5JTA5b3AoZTElMkNhMSUyQ2U0JTJDYTQpJTNCJTBBJTA5JTA5b3AoZTIlMkNhMiUyQ2UxJTJDYTEpJTNCJTBBJTA5JTA5b3AoZTIlMkNhMiUyQ2UzJTJDYTMpJTNCJTBBJTA5JTA5b3AoZTIlMkNhMiUyQ2U0JTJDYTQpJTNCJTBBJTA5JTA5b3AoZTMlMkNhMyUyQ2UyJTJDYTIpJTNCJTBBJTA5JTA5b3AoZTMlMkNhMyUyQ2UxJTJDYTEpJTNCJTBBJTA5JTA5b3AoZTMlMkNhMyUyQ2U0JTJDYTQpJTNCJTBBJTA5JTA5b3AoZTQlMkNhNCUyQ2UyJTJDYTIpJTNCJTBBJTA5JTA5b3AoZTQlMkNhNCUyQ2UxJTJDYTEpJTNCJTBBJTA5JTA5b3AoZTQlMkNhNCUyQ2UzJTJDYTMpJTNCJTBBJTA5JTdEJTBBJTdEJTBB"><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div></div><div class="code"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){
	<span class="hljs-type">int</span> k,e1,e2,e3,e4;
	<span class="hljs-type">char</span> a1,a2,a3,a4;
	cin&gt;&gt;k;
	<span class="hljs-keyword">if</span>(k==<span class="hljs-number">1</span>){
		cin&gt;&gt;e1&gt;&gt;a1;
		<span class="hljs-built_in">must</span>(e1,a1);
	}
	<span class="hljs-keyword">if</span>(k==<span class="hljs-number">2</span>){
		cin&gt;&gt;e1&gt;&gt;a1&gt;&gt;e2&gt;&gt;a2;
		<span class="hljs-built_in">must</span>(e1,a1);
		<span class="hljs-built_in">must</span>(e2,a2);
	}
	<span class="hljs-keyword">if</span>(k==<span class="hljs-number">3</span>){
		cin&gt;&gt;e1&gt;&gt;a1&gt;&gt;e2&gt;&gt;a2&gt;&gt;e3&gt;&gt;a3;
		<span class="hljs-built_in">op</span>(e1,a1,e2,a2);
		<span class="hljs-built_in">op</span>(e1,a1,e3,a3);
		<span class="hljs-built_in">op</span>(e2,a2,e1,a1);
		<span class="hljs-built_in">op</span>(e2,a2,e3,a3);
		<span class="hljs-built_in">op</span>(e3,a3,e2,a2);
		<span class="hljs-built_in">op</span>(e3,a3,e1,a1);
	}
	<span class="hljs-keyword">if</span>(k==<span class="hljs-number">4</span>){
		cin&gt;&gt;e1&gt;&gt;a1&gt;&gt;e2&gt;&gt;a2&gt;&gt;e3&gt;&gt;a3&gt;&gt;e4&gt;&gt;a4;
		<span class="hljs-built_in">op</span>(e1,a1,e2,a2);
		<span class="hljs-built_in">op</span>(e1,a1,e3,a3);
		<span class="hljs-built_in">op</span>(e1,a1,e4,a4);
		<span class="hljs-built_in">op</span>(e2,a2,e1,a1);
		<span class="hljs-built_in">op</span>(e2,a2,e3,a3);
		<span class="hljs-built_in">op</span>(e2,a2,e4,a4);
		<span class="hljs-built_in">op</span>(e3,a3,e2,a2);
		<span class="hljs-built_in">op</span>(e3,a3,e1,a1);
		<span class="hljs-built_in">op</span>(e3,a3,e4,a4);
		<span class="hljs-built_in">op</span>(e4,a4,e2,a2);
		<span class="hljs-built_in">op</span>(e4,a4,e1,a1);
		<span class="hljs-built_in">op</span>(e4,a4,e3,a3);
	}
}
</div></code></pre>
<p>建好边之后就是常规的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>−</mo><mi>S</mi><mi>A</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">2-SAT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 解法:
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>j</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">tarjan</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">jan</span></span></span></span>：</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="aW50JTIwbiUzQiUwQXN0YWNrJTNDaW50JTNFJTIwcyUzQiUwQWludCUyMGxvdyU1Qm1heG4lNUQlMkNkZm4lNUJtYXhuJTVEJTNCJTBBaW50JTIwX3RpbWUlM0IlMEFib29sJTIwbG9jayU1Qm1heG4lNUQlM0IlMEFpbnQlMjBpZCU1Qm1heG4lNUQlM0IlMEFpbnQlMjB0b3QlM0IlMEF2b2lkJTIwZGZzKGludCUyMHgpJTNCJTBBdm9pZCUyMHRhcmphbigpJTdCJTBBJTA5bWVtc2V0KGxvdyUyQzAlMkNzaXplb2YobG93KSklM0IlMEElMDltZW1zZXQoZGZuJTJDMCUyQ3NpemVvZihkZm4pKSUzQiUwQSUwOV90aW1lJTNEMCUzQiUwQSUwOW1lbXNldChsb2NrJTJDMCUyQ3NpemVvZihsb2NrKSklM0IlMEElMDltZW1zZXQoaWQlMkMwJTJDc2l6ZW9mKGlkKSklM0IlMEElMDl0b3QlM0QwJTNCJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4qMiUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aWYoIWRmbiU1QmklNUQpJTIwZGZzKGkpJTNCJTBBJTA5JTdEJTBBJTdEJTBBdm9pZCUyMGRmcyhpbnQlMjB4KSU3QiUwQSUwOWxvdyU1QnglNUQlM0RkZm4lNUJ4JTVEJTNEJTJCJTJCX3RpbWUlM0IlMEElMDlzLnB1c2goeCklM0IlMEElMDlsb2NrJTVCeCU1RCUzRHRydWUlM0IlMEElMDlmb3IoaW50JTIwaSUzRGhlYWQlNUJ4JTVEJTNCaSUzQmklM0RlZGdlJTVCaSU1RC5uZXh0KSU3QiUwQSUwOSUwOWludCUyMHRvJTNEZWRnZSU1QmklNUQudG8lM0IlMEElMDklMDlpZighZGZuJTVCdG8lNUQpJTdCJTBBJTA5JTA5JTA5ZGZzKHRvKSUzQiUwQSUwOSUwOSUwOWxvdyU1QnglNUQlM0RtaW4obG93JTVCeCU1RCUyQ2xvdyU1QnRvJTVEKSUzQiUwQSUwOSUwOSU3RGVsc2UlMjBpZihsb2NrJTVCdG8lNUQpJTIwbG93JTVCeCU1RCUzRG1pbihsb3clNUJ4JTVEJTJDZGZuJTVCdG8lNUQpJTNCJTBBJTA5JTdEJTBBJTA5aWYobG93JTVCeCU1RCUzRCUzRGRmbiU1QnglNUQpJTdCJTBBJTA5JTA5dG90JTJCJTJCJTNCJTBBJTA5JTA5d2hpbGUodHJ1ZSklN0IlMEElMDklMDklMDlpbnQlMjBrJTNEcy50b3AoKSUzQnMucG9wKCklM0IlMEElMDklMDklMDlpZCU1QmslNUQlM0R0b3QlM0IlMEElMDklMDklMDlsb2NrJTVCayU1RCUzRGZhbHNlJTNCJTBBJTA5JTA5JTA5aWYoayUzRCUzRHgpJTIwYnJlYWslM0IlMEElMDklMDklN0QlMEElMDklN0QlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div></div><div class="code"><span class="hljs-type">int</span> n;
stack&lt;<span class="hljs-type">int</span>&gt; s;
<span class="hljs-type">int</span> low[maxn],dfn[maxn];
<span class="hljs-type">int</span> _time;
<span class="hljs-type">bool</span> lock[maxn];
<span class="hljs-type">int</span> id[maxn];
<span class="hljs-type">int</span> tot;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tarjan</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(low,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(low));
	<span class="hljs-built_in">memset</span>(dfn,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(dfn));
	_time=<span class="hljs-number">0</span>;
	<span class="hljs-built_in">memset</span>(lock,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(lock));
	<span class="hljs-built_in">memset</span>(id,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(id));
	tot=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n*<span class="hljs-number">2</span>;i++){
		<span class="hljs-keyword">if</span>(!dfn[i]) <span class="hljs-built_in">dfs</span>(i);
	}
}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
	low[x]=dfn[x]=++_time;
	s.<span class="hljs-built_in">push</span>(x);
	lock[x]=<span class="hljs-literal">true</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[x];i;i=edge[i].next){
		<span class="hljs-type">int</span> to=edge[i].to;
		<span class="hljs-keyword">if</span>(!dfn[to]){
			<span class="hljs-built_in">dfs</span>(to);
			low[x]=<span class="hljs-built_in">min</span>(low[x],low[to]);
		}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(lock[to]) low[x]=<span class="hljs-built_in">min</span>(low[x],dfn[to]);
	}
	<span class="hljs-keyword">if</span>(low[x]==dfn[x]){
		tot++;
		<span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>){
			<span class="hljs-type">int</span> k=s.<span class="hljs-built_in">top</span>();s.<span class="hljs-built_in">pop</span>();
			id[k]=tot;
			lock[k]=<span class="hljs-literal">false</span>;
			<span class="hljs-keyword">if</span>(k==x) <span class="hljs-keyword">break</span>;
		}
	}
}
</div></code></pre>
<p>这里在 dfs 之前把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">low</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>f</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">dfn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">df</span><span class="mord mathnormal">n</span></span></span></span> 等变量都重置了，因为我们不止会用一次 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>j</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">tarjan</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">jan</span></span></span></span>，这个在后面会说。
然后单独写一个函数判断是否有解：</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="aW5saW5lJTIwYm9vbCUyMGNoZWNrKCklN0IlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aWYoaWQlNUJpJTVEJTNEJTNEaWQlNUJpJTJCbiU1RCklN0IlMEElMDklMDklMDlyZXR1cm4lMjBmYWxzZSUzQiUwQSUwOSUwOSU3RCUwQSUwOSU3RCUwQSUwOXJldHVybiUyMHRydWUlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div></div><div class="code"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">bool</span> <span class="hljs-title">check</span><span class="hljs-params">()</span></span>{
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-keyword">if</span>(id[i]==id[i+n]){
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</div></code></pre>
<p>然后我们将最后的可能的一种答案存放在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span> 数组中，注意数组是 <code>int</code> 类型的，这个后面也会说。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSU3QiUwQSUwOWlmKGlkJTVCaSUyQm4lNUQlM0NpZCU1QmklNUQpJTIwYW5zJTVCaSU1RCUzRHRydWUlM0IlMEElMDllbHNlJTIwYW5zJTVCaSU1RCUzRDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div></div><div class="code"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
	<span class="hljs-keyword">if</span>(id[i+n]&lt;id[i]) ans[i]=<span class="hljs-literal">true</span>;
	<span class="hljs-keyword">else</span> ans[i]=<span class="hljs-number">0</span>;
}
</div></code></pre>
<p>然后题目和一般的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>−</mo><mi>S</mi><mi>A</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">2-SAT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 不同，他不让你求一种可能结果，而是对于一些可以通过，也可以否定的提案输出 <code>?</code>，如何判断一个提案是 <code>?</code> 而不是一个确定的结果呢？
我们可以这样，如果求得的一个可能的答案为 <code>y</code>，那么我们加一条从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">true</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span> 到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">se</span></span></span></span> 的边，即强制选择 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">se</span></span></span></span>。再跑一遍 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>j</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">tarjan</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">jan</span></span></span></span>，如果还有解，那么说明这个提案否定和通过都可以；如果无解，那么说明这个提案最后必须是通过。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTJGJTJGJUU1JTg4JUE0JUU2JTk2JUFEJUU2JTk4JUFGJUU1JTkwJUE2JUU1JThGJUFGJUU0JUJCJUE1JUU0JUI4JUJBJUU5JTk3JUFFJUU1JThGJUI3JTBBZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSU3QiUwQSUwOWlmKGFucyU1QmklNUQlM0QlM0R0cnVlKSU3QiUwQSUwOSUwOW11c3QoaSUyQyduJyklM0IlMEElMDklMDl0YXJqYW4oKSUzQiUwQSUwOSUwOWlmKGNoZWNrKCkpJTIwYW5zJTVCaSU1RCUzRDMlM0IlMEElMDklN0RlbHNlJTdCJTBBJTA5JTA5bXVzdChpJTJDJ3knKSUzQiUwQSUwOSUwOXRhcmphbigpJTNCJTBBJTA5JTA5aWYoY2hlY2soKSklMjBhbnMlNUJpJTVEJTNEMyUzQiUwQSUwOSU3RCUwQSUwOXJlZG8oKSUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div></div><div class="code"><span class="hljs-comment">//判断是否可以为问号</span>
<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
	<span class="hljs-keyword">if</span>(ans[i]==<span class="hljs-literal">true</span>){
		<span class="hljs-built_in">must</span>(i,<span class="hljs-string">&#x27;n&#x27;</span>);
		<span class="hljs-built_in">tarjan</span>();
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>()) ans[i]=<span class="hljs-number">3</span>;
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-built_in">must</span>(i,<span class="hljs-string">&#x27;y&#x27;</span>);
		<span class="hljs-built_in">tarjan</span>();
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>()) ans[i]=<span class="hljs-number">3</span>;
	}
	<span class="hljs-built_in">redo</span>();
}
</div></code></pre>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span> 数组中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 代表必须是否定，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 代表必须是肯定，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> 代表都可以。
注意这里有个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>d</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">redo</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span></span></span></span> 函数，用来撤销用于判断一个提案是否为 <code>?</code> 时建的边：</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="aW5saW5lJTIwdm9pZCUyMHJlZG8oKSU3QiUwQSUwOWhlYWQlNUJlZGdlJTVCc2l6ZSU1RC5mcm9tJTVEJTNEZWRnZSU1QnNpemUlNUQubmV4dCUzQiUwQSUwOXNpemUtLSUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div></div><div class="code"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">redo</span><span class="hljs-params">()</span></span>{
	head[edge[size].from]=edge[size].next;
	size--;
}
</div></code></pre>
<p>建图部分：</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="c3RydWN0JTIwRWRnZSU3QiUwQSUwOWludCUyMGZyb20lMkNuZXh0JTJDdG8lM0IlMEElN0QlMjBlZGdlJTVCMTUqNTAwJTVEJTNCJTBBaW50JTIwaGVhZCU1QjIwMSU1RCUzQiUwQWludCUyMHNpemUlM0IlMEFpbmxpbmUlMjB2b2lkJTIwYWRkKGludCUyMHUlMkNpbnQlMjB2KSU3QiUwQSUwOXNpemUlMkIlMkIlM0IlMEElMDllZGdlJTVCc2l6ZSU1RC50byUzRHYlM0IlMEElMDllZGdlJTVCc2l6ZSU1RC5uZXh0JTNEaGVhZCU1QnUlNUQlM0IlMEElMDllZGdlJTVCc2l6ZSU1RC5mcm9tJTNEdSUzQiUwQSUwOWhlYWQlNUJ1JTVEJTNEc2l6ZSUzQiUwQSU3RCUwQWlubGluZSUyMHZvaWQlMjByZWRvKCklN0IlMEElMDloZWFkJTVCZWRnZSU1QnNpemUlNUQuZnJvbSU1RCUzRGVkZ2UlNUJzaXplJTVELm5leHQlM0IlMEElMDlzaXplLS0lM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div></div><div class="code"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>{
	<span class="hljs-type">int</span> from,next,to;
} edge[<span class="hljs-number">15</span>*<span class="hljs-number">500</span>];
<span class="hljs-type">int</span> head[<span class="hljs-number">201</span>];
<span class="hljs-type">int</span> size;
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span>{
	size++;
	edge[size].to=v;
	edge[size].next=head[u];
	edge[size].from=u;
	head[u]=size;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">redo</span><span class="hljs-params">()</span></span>{
	head[edge[size].from]=edge[size].next;
	size--;
}
</div></code></pre>
<p>（注意 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">edge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span></span></span></span> 数组的大小。为了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>d</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">redo</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span></span></span></span> 操作，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>d</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Edge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span></span></span></span> 结构体中新增了一个成员：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>r</mi><mi>o</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">from</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">m</span></span></span></span>）
最后根据 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span> 数组输出。</p>
<h2 id="wan-zheng-dai-ma" tabindex="-1">完整代码</h2>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2lvc3RyZWFtJTNFJTBBJTIzaW5jbHVkZSUzQ2NzdHJpbmclM0UlMEElMjNpbmNsdWRlJTNDc3RhY2slM0UlMEElMjNpbmNsdWRlJTNDY3N0ZGlvJTNFJTBBJTIzZGVmaW5lJTIwbWF4biUyMDIwMSUwQXVzaW5nJTIwbmFtZXNwYWNlJTIwc3RkJTNCJTBBc3RydWN0JTIwRWRnZSU3QiUwQSUwOWludCUyMGZyb20lMkNuZXh0JTJDdG8lM0IlMEElN0QlMjBlZGdlJTVCMTUqNTAwJTVEJTNCJTBBaW50JTIwaGVhZCU1QjIwMSU1RCUzQiUwQWludCUyMHNpemUlM0IlMEFpbmxpbmUlMjB2b2lkJTIwYWRkKGludCUyMHUlMkNpbnQlMjB2KSU3QiUwQSUwOXNpemUlMkIlMkIlM0IlMEElMDllZGdlJTVCc2l6ZSU1RC50byUzRHYlM0IlMEElMDllZGdlJTVCc2l6ZSU1RC5uZXh0JTNEaGVhZCU1QnUlNUQlM0IlMEElMDllZGdlJTVCc2l6ZSU1RC5mcm9tJTNEdSUzQiUwQSUwOWhlYWQlNUJ1JTVEJTNEc2l6ZSUzQiUwQSU3RCUwQWlubGluZSUyMHZvaWQlMjByZWRvKCklN0IlMEElMDloZWFkJTVCZWRnZSU1QnNpemUlNUQuZnJvbSU1RCUzRGVkZ2UlNUJzaXplJTVELm5leHQlM0IlMEElMDlzaXplLS0lM0IlMEElN0QlMEFpbnQlMjBuJTNCJTBBc3RhY2slM0NpbnQlM0UlMjBzJTNCJTBBaW50JTIwbG93JTVCbWF4biU1RCUyQ2RmbiU1Qm1heG4lNUQlM0IlMEFpbnQlMjBfdGltZSUzQiUwQWJvb2wlMjBsb2NrJTVCbWF4biU1RCUzQiUwQWludCUyMGlkJTVCbWF4biU1RCUzQiUwQWludCUyMHRvdCUzQiUwQXZvaWQlMjBkZnMoaW50JTIweCklM0IlMEF2b2lkJTIwdGFyamFuKCklN0IlMEElMDltZW1zZXQobG93JTJDMCUyQ3NpemVvZihsb3cpKSUzQiUwQSUwOW1lbXNldChkZm4lMkMwJTJDc2l6ZW9mKGRmbikpJTNCJTBBJTA5X3RpbWUlM0QwJTNCJTBBJTA5bWVtc2V0KGxvY2slMkMwJTJDc2l6ZW9mKGxvY2spKSUzQiUwQSUwOW1lbXNldChpZCUyQzAlMkNzaXplb2YoaWQpKSUzQiUwQSUwOXRvdCUzRDAlM0IlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbioyJTNCaSUyQiUyQiklN0IlMEElMDklMDlpZighZGZuJTVCaSU1RCklMjBkZnMoaSklM0IlMEElMDklN0QlMEElN0QlMEF2b2lkJTIwZGZzKGludCUyMHgpJTdCJTBBJTA5bG93JTVCeCU1RCUzRGRmbiU1QnglNUQlM0QlMkIlMkJfdGltZSUzQiUwQSUwOXMucHVzaCh4KSUzQiUwQSUwOWxvY2slNUJ4JTVEJTNEdHJ1ZSUzQiUwQSUwOWZvcihpbnQlMjBpJTNEaGVhZCU1QnglNUQlM0JpJTNCaSUzRGVkZ2UlNUJpJTVELm5leHQpJTdCJTBBJTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaSU1RC50byUzQiUwQSUwOSUwOWlmKCFkZm4lNUJ0byU1RCklN0IlMEElMDklMDklMDlkZnModG8pJTNCJTBBJTA5JTA5JTA5bG93JTVCeCU1RCUzRG1pbihsb3clNUJ4JTVEJTJDbG93JTVCdG8lNUQpJTNCJTBBJTA5JTA5JTdEZWxzZSUyMGlmKGxvY2slNUJ0byU1RCklMjBsb3clNUJ4JTVEJTNEbWluKGxvdyU1QnglNUQlMkNkZm4lNUJ0byU1RCklM0IlMEElMDklN0QlMEElMDlpZihsb3clNUJ4JTVEJTNEJTNEZGZuJTVCeCU1RCklN0IlMEElMDklMDl0b3QlMkIlMkIlM0IlMEElMDklMDl3aGlsZSh0cnVlKSU3QiUwQSUwOSUwOSUwOWludCUyMGslM0RzLnRvcCgpJTNCcy5wb3AoKSUzQiUwQSUwOSUwOSUwOWlkJTVCayU1RCUzRHRvdCUzQiUwQSUwOSUwOSUwOWxvY2slNUJrJTVEJTNEZmFsc2UlM0IlMEElMDklMDklMDlpZihrJTNEJTNEeCklMjBicmVhayUzQiUwQSUwOSUwOSU3RCUwQSUwOSU3RCUwQSU3RCUwQWlubGluZSUyMHZvaWQlMjBtdXN0KGludCUyMGUlMkNjaGFyJTIwYSklN0IlMEElMDlpZihhJTNEJTNEJ3knKSU3QiUwQSUwOSUwOWFkZChlJTJDZSUyQm4pJTNCJTBBJTA5JTdEZWxzZSU3QiUwQSUwOSUwOWFkZChlJTJCbiUyQ2UpJTNCJTBBJTA5JTdEJTBBJTdEJTBBaW5saW5lJTIwdm9pZCUyMG9wKGludCUyMGUxJTJDY2hhciUyMGExJTJDaW50JTIwZTIlMkNjaGFyJTIwYTIpJTdCJTBBJTA5aWYoYTElM0QlM0QneScpJTdCJTBBJTA5JTA5aWYoYTIlM0QlM0QneScpJTIwYWRkKGUxJTJDZTIlMkJuKSUzQiUwQSUwOSUwOWVsc2UlMjBhZGQoZTElMkNlMiklM0IlMEElMDklN0RlbHNlJTdCJTBBJTA5JTA5aWYoYTIlM0QlM0QneScpJTIwYWRkKGUxJTJCbiUyQ2UyJTJCbiklM0IlMEElMDklMDllbHNlJTIwYWRkKGUxJTJCbiUyQ2UyKSUzQiUwQSUwOSU3RCUwQSU3RCUwQWludCUyMGFucyU1QjEwMSU1RCUzQiUwQWlubGluZSUyMGJvb2wlMjBjaGVjaygpJTdCJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSU3QiUwQSUwOSUwOWlmKGlkJTVCaSU1RCUzRCUzRGlkJTVCaSUyQm4lNUQpJTdCJTBBJTA5JTA5JTA5cmV0dXJuJTIwZmFsc2UlM0IlMEElMDklMDklN0QlMEElMDklN0QlMEElMDlyZXR1cm4lMjB0cnVlJTNCJTBBJTdEJTBBaW5saW5lJTIwdm9pZCUyMGNsZWFyKCklN0IlMEElMDltZW1zZXQoZWRnZSUyQzAlMkNzaXplb2YoZWRnZSkpJTNCJTBBJTA5bWVtc2V0KGhlYWQlMkMwJTJDc2l6ZW9mKGhlYWQpKSUzQiUwQSUwOXNpemUlM0QwJTNCJTBBJTdEJTBBaW5saW5lJTIwdm9pZCUyMHN1YnRhc2soaW50JTIwY2FzJTJDaW50JTIwYiUyQ2ludCUyMG0pJTdCJTBBJTA5Y2xlYXIoKSUzQiUwQSUwOW4lM0RiJTNCJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG0lM0JpJTJCJTJCKSU3QiUwQSUwOSUwOWludCUyMGslMkNlMSUyQ2UyJTJDZTMlMkNlNCUzQiUwQSUwOSUwOWNoYXIlMjBhMSUyQ2EyJTJDYTMlMkNhNCUzQiUwQSUwOSUwOWNpbiUzRSUzRWslM0IlMEElMDklMDlpZihrJTNEJTNEMSklN0IlMEElMDklMDklMDljaW4lM0UlM0VlMSUzRSUzRWExJTNCJTBBJTA5JTA5JTA5bXVzdChlMSUyQ2ExKSUzQiUwQSUwOSUwOSU3RCUwQSUwOSUwOWlmKGslM0QlM0QyKSU3QiUwQSUwOSUwOSUwOWNpbiUzRSUzRWUxJTNFJTNFYTElM0UlM0VlMiUzRSUzRWEyJTNCJTBBJTA5JTA5JTA5bXVzdChlMSUyQ2ExKSUzQiUwQSUwOSUwOSUwOW11c3QoZTIlMkNhMiklM0IlMEElMDklMDklN0QlMEElMDklMDlpZihrJTNEJTNEMyklN0IlMEElMDklMDklMDljaW4lM0UlM0VlMSUzRSUzRWExJTNFJTNFZTIlM0UlM0VhMiUzRSUzRWUzJTNFJTNFYTMlM0IlMEElMDklMDklMDlvcChlMSUyQ2ExJTJDZTIlMkNhMiklM0IlMEElMDklMDklMDlvcChlMSUyQ2ExJTJDZTMlMkNhMyklM0IlMEElMDklMDklMDlvcChlMiUyQ2EyJTJDZTElMkNhMSklM0IlMEElMDklMDklMDlvcChlMiUyQ2EyJTJDZTMlMkNhMyklM0IlMEElMDklMDklMDlvcChlMyUyQ2EzJTJDZTIlMkNhMiklM0IlMEElMDklMDklMDlvcChlMyUyQ2EzJTJDZTElMkNhMSklM0IlMEElMDklMDklN0QlMEElMDklMDlpZihrJTNEJTNENCklN0IlMEElMDklMDklMDljaW4lM0UlM0VlMSUzRSUzRWExJTNFJTNFZTIlM0UlM0VhMiUzRSUzRWUzJTNFJTNFYTMlM0UlM0VlNCUzRSUzRWE0JTNCJTBBJTA5JTA5JTA5b3AoZTElMkNhMSUyQ2UyJTJDYTIpJTNCJTBBJTA5JTA5JTA5b3AoZTElMkNhMSUyQ2UzJTJDYTMpJTNCJTBBJTA5JTA5JTA5b3AoZTElMkNhMSUyQ2U0JTJDYTQpJTNCJTBBJTA5JTA5JTA5b3AoZTIlMkNhMiUyQ2UxJTJDYTEpJTNCJTBBJTA5JTA5JTA5b3AoZTIlMkNhMiUyQ2UzJTJDYTMpJTNCJTBBJTA5JTA5JTA5b3AoZTIlMkNhMiUyQ2U0JTJDYTQpJTNCJTBBJTA5JTA5JTA5b3AoZTMlMkNhMyUyQ2UyJTJDYTIpJTNCJTBBJTA5JTA5JTA5b3AoZTMlMkNhMyUyQ2UxJTJDYTEpJTNCJTBBJTA5JTA5JTA5b3AoZTMlMkNhMyUyQ2U0JTJDYTQpJTNCJTBBJTA5JTA5JTA5b3AoZTQlMkNhNCUyQ2UyJTJDYTIpJTNCJTBBJTA5JTA5JTA5b3AoZTQlMkNhNCUyQ2UxJTJDYTEpJTNCJTBBJTA5JTA5JTA5b3AoZTQlMkNhNCUyQ2UzJTJDYTMpJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTA5dGFyamFuKCklM0IlMEElMDlpZighY2hlY2soKSklN0IlMEElMDklMDljb3V0JTNDJTNDJTIyQ2FzZSUyMCUyMiUzQyUzQ2NhcyUzQyUzQyUyMiUzQSUyMGltcG9zc2libGUlMjIlM0MlM0NlbmRsJTNCJTBBJTA5JTA5cmV0dXJuJTNCJTBBJTA5JTdEJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSU3QiUwQSUwOSUwOWlmKGlkJTVCaSUyQm4lNUQlM0NpZCU1QmklNUQpJTIwYW5zJTVCaSU1RCUzRHRydWUlM0IlMEElMDklMDllbHNlJTIwYW5zJTVCaSU1RCUzRDAlM0IlMEElMDklN0QlMEElMDklMkYlMkYlRTUlODglQTQlRTYlOTYlQUQlRTYlOTglQUYlRTUlOTAlQTYlRTUlOEYlQUYlRTQlQkIlQTUlRTQlQjglQkElRTklOTclQUUlRTUlOEYlQjclMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aWYoYW5zJTVCaSU1RCUzRCUzRHRydWUpJTdCJTBBJTA5JTA5JTA5bXVzdChpJTJDJ24nKSUzQiUwQSUwOSUwOSUwOXRhcmphbigpJTNCJTBBJTA5JTA5JTA5aWYoY2hlY2soKSklMjBhbnMlNUJpJTVEJTNEMyUzQiUwQSUwOSUwOSU3RGVsc2UlN0IlMEElMDklMDklMDltdXN0KGklMkMneScpJTNCJTBBJTA5JTA5JTA5dGFyamFuKCklM0IlMEElMDklMDklMDlpZihjaGVjaygpKSUyMGFucyU1QmklNUQlM0QzJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTA5cmVkbygpJTNCJTBBJTA5JTdEJTBBJTA5Y291dCUzQyUzQyUyMkNhc2UlMjAlMjIlM0MlM0NjYXMlM0MlM0MlMjIlM0ElMjAlMjIlM0IlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aWYoYW5zJTVCaSU1RCUzRCUzRDApJTIwY291dCUzQyUzQyUyMm4lMjIlM0IlMEElMDklMDllbHNlJTIwaWYoYW5zJTVCaSU1RCUzRCUzRDEpJTIwY291dCUzQyUzQyUyMnklMjIlM0IlMEElMDklMDllbHNlJTIwaWYoYW5zJTVCaSU1RCUzRCUzRDMpJTIwY291dCUzQyUzQyUyMiUzRiUyMiUzQiUwQSUwOSU3RCUwQSUwOWNvdXQlM0MlM0NlbmRsJTNCJTBBJTdEJTBBaW50JTIwbWFpbigpJTdCJTBBJTA5aW50JTIwY2FzJTNEMCUzQiUwQSUwOXdoaWxlKHRydWUpJTdCJTBBJTA5JTA5Y2FzJTJCJTJCJTNCJTBBJTA5JTA5aW50JTIwYiUyQ20lM0IlMEElMDklMDljaW4lM0UlM0ViJTNFJTNFbSUzQiUwQSUwOSUwOWlmKGIlM0QlM0QwJTI2JTI2bSUzRCUzRDApJTIwcmV0dXJuJTIwMCUzQiUwQSUwOSUwOWVsc2UlMjBzdWJ0YXNrKGNhcyUyQ2IlMkNtKSUzQiUwQSUwOSU3RCUwQSUwOXJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div><div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div><div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div><div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div><div>111</div><div>112</div><div>113</div><div>114</div><div>115</div><div>116</div><div>117</div><div>118</div><div>119</div><div>120</div><div>121</div><div>122</div><div>123</div><div>124</div><div>125</div><div>126</div><div>127</div><div>128</div><div>129</div><div>130</div><div>131</div><div>132</div><div>133</div><div>134</div><div>135</div><div>136</div><div>137</div><div>138</div><div>139</div><div>140</div><div>141</div><div>142</div><div>143</div><div>144</div><div>145</div><div>146</div><div>147</div><div>148</div><div>149</div><div>150</div><div>151</div><div>152</div><div>153</div><div>154</div><div>155</div><div>156</div><div>157</div><div>158</div><div>159</div><div>160</div><div>161</div><div>162</div><div>163</div><div>164</div><div>165</div><div>166</div><div>167</div><div>168</div><div>169</div><div>170</div><div>171</div><div>172</div><div>173</div><div>174</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stack&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> maxn 201</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>{
	<span class="hljs-type">int</span> from,next,to;
} edge[<span class="hljs-number">15</span>*<span class="hljs-number">500</span>];
<span class="hljs-type">int</span> head[<span class="hljs-number">201</span>];
<span class="hljs-type">int</span> size;
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span>{
	size++;
	edge[size].to=v;
	edge[size].next=head[u];
	edge[size].from=u;
	head[u]=size;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">redo</span><span class="hljs-params">()</span></span>{
	head[edge[size].from]=edge[size].next;
	size--;
}
<span class="hljs-type">int</span> n;
stack&lt;<span class="hljs-type">int</span>&gt; s;
<span class="hljs-type">int</span> low[maxn],dfn[maxn];
<span class="hljs-type">int</span> _time;
<span class="hljs-type">bool</span> lock[maxn];
<span class="hljs-type">int</span> id[maxn];
<span class="hljs-type">int</span> tot;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tarjan</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(low,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(low));
	<span class="hljs-built_in">memset</span>(dfn,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(dfn));
	_time=<span class="hljs-number">0</span>;
	<span class="hljs-built_in">memset</span>(lock,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(lock));
	<span class="hljs-built_in">memset</span>(id,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(id));
	tot=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n*<span class="hljs-number">2</span>;i++){
		<span class="hljs-keyword">if</span>(!dfn[i]) <span class="hljs-built_in">dfs</span>(i);
	}
}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
	low[x]=dfn[x]=++_time;
	s.<span class="hljs-built_in">push</span>(x);
	lock[x]=<span class="hljs-literal">true</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[x];i;i=edge[i].next){
		<span class="hljs-type">int</span> to=edge[i].to;
		<span class="hljs-keyword">if</span>(!dfn[to]){
			<span class="hljs-built_in">dfs</span>(to);
			low[x]=<span class="hljs-built_in">min</span>(low[x],low[to]);
		}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(lock[to]) low[x]=<span class="hljs-built_in">min</span>(low[x],dfn[to]);
	}
	<span class="hljs-keyword">if</span>(low[x]==dfn[x]){
		tot++;
		<span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>){
			<span class="hljs-type">int</span> k=s.<span class="hljs-built_in">top</span>();s.<span class="hljs-built_in">pop</span>();
			id[k]=tot;
			lock[k]=<span class="hljs-literal">false</span>;
			<span class="hljs-keyword">if</span>(k==x) <span class="hljs-keyword">break</span>;
		}
	}
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">must</span><span class="hljs-params">(<span class="hljs-type">int</span> e,<span class="hljs-type">char</span> a)</span></span>{
	<span class="hljs-keyword">if</span>(a==<span class="hljs-string">&#x27;y&#x27;</span>){
		<span class="hljs-built_in">add</span>(e,e+n);
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-built_in">add</span>(e+n,e);
	}
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">op</span><span class="hljs-params">(<span class="hljs-type">int</span> e1,<span class="hljs-type">char</span> a1,<span class="hljs-type">int</span> e2,<span class="hljs-type">char</span> a2)</span></span>{
	<span class="hljs-keyword">if</span>(a1==<span class="hljs-string">&#x27;y&#x27;</span>){
		<span class="hljs-keyword">if</span>(a2==<span class="hljs-string">&#x27;y&#x27;</span>) <span class="hljs-built_in">add</span>(e1,e2+n);
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(e1,e2);
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-keyword">if</span>(a2==<span class="hljs-string">&#x27;y&#x27;</span>) <span class="hljs-built_in">add</span>(e1+n,e2+n);
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(e1+n,e2);
	}
}
<span class="hljs-type">int</span> ans[<span class="hljs-number">101</span>];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">bool</span> <span class="hljs-title">check</span><span class="hljs-params">()</span></span>{
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-keyword">if</span>(id[i]==id[i+n]){
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(edge,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(edge));
	<span class="hljs-built_in">memset</span>(head,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(head));
	size=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">(<span class="hljs-type">int</span> cas,<span class="hljs-type">int</span> b,<span class="hljs-type">int</span> m)</span></span>{
	<span class="hljs-built_in">clear</span>();
	n=b;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){
		<span class="hljs-type">int</span> k,e1,e2,e3,e4;
		<span class="hljs-type">char</span> a1,a2,a3,a4;
		cin&gt;&gt;k;
		<span class="hljs-keyword">if</span>(k==<span class="hljs-number">1</span>){
			cin&gt;&gt;e1&gt;&gt;a1;
			<span class="hljs-built_in">must</span>(e1,a1);
		}
		<span class="hljs-keyword">if</span>(k==<span class="hljs-number">2</span>){
			cin&gt;&gt;e1&gt;&gt;a1&gt;&gt;e2&gt;&gt;a2;
			<span class="hljs-built_in">must</span>(e1,a1);
			<span class="hljs-built_in">must</span>(e2,a2);
		}
		<span class="hljs-keyword">if</span>(k==<span class="hljs-number">3</span>){
			cin&gt;&gt;e1&gt;&gt;a1&gt;&gt;e2&gt;&gt;a2&gt;&gt;e3&gt;&gt;a3;
			<span class="hljs-built_in">op</span>(e1,a1,e2,a2);
			<span class="hljs-built_in">op</span>(e1,a1,e3,a3);
			<span class="hljs-built_in">op</span>(e2,a2,e1,a1);
			<span class="hljs-built_in">op</span>(e2,a2,e3,a3);
			<span class="hljs-built_in">op</span>(e3,a3,e2,a2);
			<span class="hljs-built_in">op</span>(e3,a3,e1,a1);
		}
		<span class="hljs-keyword">if</span>(k==<span class="hljs-number">4</span>){
			cin&gt;&gt;e1&gt;&gt;a1&gt;&gt;e2&gt;&gt;a2&gt;&gt;e3&gt;&gt;a3&gt;&gt;e4&gt;&gt;a4;
			<span class="hljs-built_in">op</span>(e1,a1,e2,a2);
			<span class="hljs-built_in">op</span>(e1,a1,e3,a3);
			<span class="hljs-built_in">op</span>(e1,a1,e4,a4);
			<span class="hljs-built_in">op</span>(e2,a2,e1,a1);
			<span class="hljs-built_in">op</span>(e2,a2,e3,a3);
			<span class="hljs-built_in">op</span>(e2,a2,e4,a4);
			<span class="hljs-built_in">op</span>(e3,a3,e2,a2);
			<span class="hljs-built_in">op</span>(e3,a3,e1,a1);
			<span class="hljs-built_in">op</span>(e3,a3,e4,a4);
			<span class="hljs-built_in">op</span>(e4,a4,e2,a2);
			<span class="hljs-built_in">op</span>(e4,a4,e1,a1);
			<span class="hljs-built_in">op</span>(e4,a4,e3,a3);
		}
	}
	<span class="hljs-built_in">tarjan</span>();
	<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">check</span>()){
		cout&lt;&lt;<span class="hljs-string">&quot;Case &quot;</span>&lt;&lt;cas&lt;&lt;<span class="hljs-string">&quot;: impossible&quot;</span>&lt;&lt;endl;
		<span class="hljs-keyword">return</span>;
	}
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-keyword">if</span>(id[i+n]&lt;id[i]) ans[i]=<span class="hljs-literal">true</span>;
		<span class="hljs-keyword">else</span> ans[i]=<span class="hljs-number">0</span>;
	}
	<span class="hljs-comment">//判断是否可以为问号</span>
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-keyword">if</span>(ans[i]==<span class="hljs-literal">true</span>){
			<span class="hljs-built_in">must</span>(i,<span class="hljs-string">&#x27;n&#x27;</span>);
			<span class="hljs-built_in">tarjan</span>();
			<span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>()) ans[i]=<span class="hljs-number">3</span>;
		}<span class="hljs-keyword">else</span>{
			<span class="hljs-built_in">must</span>(i,<span class="hljs-string">&#x27;y&#x27;</span>);
			<span class="hljs-built_in">tarjan</span>();
			<span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>()) ans[i]=<span class="hljs-number">3</span>;
		}
		<span class="hljs-built_in">redo</span>();
	}
	cout&lt;&lt;<span class="hljs-string">&quot;Case &quot;</span>&lt;&lt;cas&lt;&lt;<span class="hljs-string">&quot;: &quot;</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-keyword">if</span>(ans[i]==<span class="hljs-number">0</span>) cout&lt;&lt;<span class="hljs-string">&quot;n&quot;</span>;
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(ans[i]==<span class="hljs-number">1</span>) cout&lt;&lt;<span class="hljs-string">&quot;y&quot;</span>;
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(ans[i]==<span class="hljs-number">3</span>) cout&lt;&lt;<span class="hljs-string">&quot;?&quot;</span>;
	}
	cout&lt;&lt;endl;
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	<span class="hljs-type">int</span> cas=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>){
		cas++;
		<span class="hljs-type">int</span> b,m;
		cin&gt;&gt;b&gt;&gt;m;
		<span class="hljs-keyword">if</span>(b==<span class="hljs-number">0</span>&amp;&amp;m==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">subtask</span>(cas,b,m);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>UVA1086 The Ministers' Major Mess <a href="https://www.luogu.com.cn/problem/UVA1086">https://www.luogu.com.cn/problem/UVA1086</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
