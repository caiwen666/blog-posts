<p>赛时切4个，再上大分</p>
<h2 id="cf-2019-a" tabindex="-1">CF2019A</h2>
<p>主观难度：普及-
标签：贪心
显然总共有两种选法，一种是选所有偶数格子，一种是选所有奇数格子。这两种选法中一定存在一种选法可以把最大值选到。当总数为偶数时，两种选法能选到的格子数量相同，再选择能把最大值选到的选法就能得到最大答案。总数为奇数时，选所有奇数格子比选所有偶数格子能选到的格子数量多一个。如果选所有奇数格子能把最大值选到，那么就是最优的。反之，选所有偶数格子，虽然选到的格子数量少一个，但最大值比次大值至少大一，所以就把亏的部分补回来了。综上，把最大值选上是最优的。注意如果有多个最大值，显然选择位于奇数位置的最大值更好一些。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBaW50JTIwaW4lNUIxMDElNUQlM0IlMEFpbmxpbmUlMjB2b2lkJTIwc3VidGFzaygpJTdCJTBBJTA5aW50JTIwbiUzQmNpbiUzRSUzRW4lM0IlMEElMDlpbnQlMjBtYXh4JTNELWluZiUyQ2luZGV4JTNCJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSU3QiUwQSUwOSUwOWludCUyMHglM0JjaW4lM0UlM0V4JTNCJTBBJTA5JTA5aWYoeCUzRW1heHgpJTdCJTBBJTA5JTA5JTA5bWF4eCUzRHglM0IlMEElMDklMDklMDlpbmRleCUzRGklM0IlMEElMDklMDklN0RlbHNlJTIwaWYoeCUzRCUzRG1heHgpJTdCJTBBJTA5JTA5JTA5aWYoaSUyNTIpJTdCJTBBJTA5JTA5JTA5JTA5aW5kZXglM0RpJTNCJTBBJTA5JTA5JTA5JTdEJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTA5aWYobiUyNTIlM0QlM0QwKSU3QiUwQSUwOSUwOWNvdXQlM0MlM0NtYXh4JTJCbiUyRjIlM0MlM0NlbmRsJTNCJTBBJTA5JTdEZWxzZSU3QiUwQSUwOSUwOWlmKGluZGV4JTI1MiklN0IlMEElMDklMDklMDljb3V0JTNDJTNDbWF4eCUyQm4lMkYyJTJCMSUzQyUzQ2VuZGwlM0IlMEElMDklMDklN0RlbHNlJTdCJTBBJTA5JTA5JTA5Y291dCUzQyUzQ21heHglMkJuJTJGMiUzQyUzQ2VuZGwlM0IlMEElMDklMDklN0QlMEElMDklN0QlMEElN0QlMEFzaWduZWQlMjBtYWluKCklN0IlMEElMDlpb3MlM0ElM0FzeW5jX3dpdGhfc3RkaW8oZmFsc2UpJTNCJTBBJTA5aW50JTIwdCUzQmNpbiUzRSUzRXQlM0IlMEElMDl3aGlsZSh0LS0pJTIwc3VidGFzaygpJTNCJTBBJTA5cmV0dXJuJTIwMCUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-type">int</span> in[<span class="hljs-number">101</span>];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
	<span class="hljs-type">int</span> n;cin&gt;&gt;n;
	<span class="hljs-type">int</span> maxx=-inf,index;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-type">int</span> x;cin&gt;&gt;x;
		<span class="hljs-keyword">if</span>(x&gt;maxx){
			maxx=x;
			index=i;
		}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x==maxx){
			<span class="hljs-keyword">if</span>(i%<span class="hljs-number">2</span>){
				index=i;
			}
		}
	}
	<span class="hljs-keyword">if</span>(n%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>){
		cout&lt;&lt;maxx+n/<span class="hljs-number">2</span>&lt;&lt;endl;
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-keyword">if</span>(index%<span class="hljs-number">2</span>){
			cout&lt;&lt;maxx+n/<span class="hljs-number">2</span><span class="hljs-number">+1</span>&lt;&lt;endl;
		}<span class="hljs-keyword">else</span>{
			cout&lt;&lt;maxx+n/<span class="hljs-number">2</span>&lt;&lt;endl;
		}
	}
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
	<span class="hljs-type">int</span> t;cin&gt;&gt;t;
	<span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="cf-2019-b" tabindex="-1">CF2019B</h2>
<p>主观难度：普及/提高-
标签：map、组合计数
容易发现，有很多点，被穿过线段数量是相同的。具体的，比如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_i,x_{i+1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 区间内的点，被穿过线段数量是相同的（注意是开区间，端点处的情况我们再谨慎讨论），而且不难计算出数量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">i\times(n-i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>，共有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_{i+1}-x_i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个点。考虑到这样算出来的数量不多，所以开个map。对于这种情况，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>+</mo><mo>=</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">mp[i\times(n-i)]+=x_{i+1}-x_i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)]</span><span class="mord">+</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>。然后考虑端点处，点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 被穿过线段数量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i\times(n-i+1)-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> （左边能选 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 个点，右边能选 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个点（注意第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 个点，即区间左端点也能再选），但是这样的话会出现左右两边都选第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 个点的情况，所以再减一。这种情况下，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mo>+</mo></mrow><annotation encoding="application/x-tex">mp[i\times(n-i+1)-1]++</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">+</span></span></span></span>。
然后对于每个询问，直接从 map 取就好了。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBaW5saW5lJTIwdm9pZCUyMHN1YnRhc2soKSU3QiUwQSUwOWludCUyMG4lMkNxJTNCY2luJTNFJTNFbiUzRSUzRXElM0IlMEElMDl1bm9yZGVyZWRfbWFwJTNDaW50JTJDaW50JTNFJTIwbXAlM0IlMEElMDlpbnQlMjBsYXMlM0IlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aW50JTIweCUzQmNpbiUzRSUzRXglM0IlMEElMDklMDlpZihpJTNEJTNEMSU3QyU3Q2klM0QlM0RuKSU3QiUwQSUwOSUwOSUwOW1wJTVCbi0xJTVEJTNEbXAlNUJuLTElNUQlMkIxJTNCJTBBJTA5JTA5JTdEZWxzZSU3QiUwQSUwOSUwOSUwOWludCUyMG5vdyUzRGkqKG4taSUyQjEpLTElM0IlMEElMDklMDklMDltcCU1Qm5vdyU1RCUzRG1wJTVCbm93JTVEJTJCMSUzQiUwQSUwOSUwOSU3RCUwQSUwOSUwOWlmKGkhJTNEMSklN0IlMEElMDklMDklMDlpbnQlMjBsJTNEaS0xJTNCJTBBJTA5JTA5JTA5aW50JTIwciUzRG4tbCUzQiUwQSUwOSUwOSUwOWludCUyMG5vdyUzRGwqciUzQiUwQSUwOSUwOSUwOW1wJTVCbm93JTVEJTNEbXAlNUJub3clNUQlMkJ4LWxhcy0xJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTA5bGFzJTNEeCUzQiUwQSUwOSU3RCUwQSUwOWZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RxJTNCaSUyQiUyQiklN0IlMEElMDklMDlpbnQlMjB4JTNCY2luJTNFJTNFeCUzQiUwQSUwOSUwOWNvdXQlM0MlM0NtcCU1QnglNUQlM0MlM0MlMjIlMjAlMjIlM0IlMEElMDklN0QlMEElMDljb3V0JTNDJTNDZW5kbCUzQiUwQSU3RCUwQXNpZ25lZCUyMG1haW4oKSU3QiUwQSUwOWlvcyUzQSUzQXN5bmNfd2l0aF9zdGRpbyhmYWxzZSklM0IlMEElMDlpbnQlMjB0JTNCY2luJTNFJTNFdCUzQiUwQSUwOXdoaWxlKHQtLSklMjBzdWJ0YXNrKCklM0IlMEElMDlyZXR1cm4lMjAwJTNCJTBBJTdEJTBB"><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
	<span class="hljs-type">int</span> n,q;cin&gt;&gt;n&gt;&gt;q;
	unordered_map&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; mp;
	<span class="hljs-type">int</span> las;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-type">int</span> x;cin&gt;&gt;x;
		<span class="hljs-keyword">if</span>(i==<span class="hljs-number">1</span>||i==n){
			mp[n<span class="hljs-number">-1</span>]=mp[n<span class="hljs-number">-1</span>]<span class="hljs-number">+1</span>;
		}<span class="hljs-keyword">else</span>{
			<span class="hljs-type">int</span> now=i*(n-i<span class="hljs-number">+1</span>)<span class="hljs-number">-1</span>;
			mp[now]=mp[now]<span class="hljs-number">+1</span>;
		}
		<span class="hljs-keyword">if</span>(i!=<span class="hljs-number">1</span>){
			<span class="hljs-type">int</span> l=i<span class="hljs-number">-1</span>;
			<span class="hljs-type">int</span> r=n-l;
			<span class="hljs-type">int</span> now=l*r;
			mp[now]=mp[now]+x-las<span class="hljs-number">-1</span>;
		}
		las=x;
	}
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=q;i++){
		<span class="hljs-type">int</span> x;cin&gt;&gt;x;
		cout&lt;&lt;mp[x]&lt;&lt;<span class="hljs-string">&quot; &quot;</span>;
	}
	cout&lt;&lt;endl;
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
	<span class="hljs-type">int</span> t;cin&gt;&gt;t;
	<span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="cf-2019-c" tabindex="-1">CF2019C</h2>
<p>主观难度：普及/提高-
标签：贪心
我们设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 为分的堆数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 为每个堆中牌的数量，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 即为包含的总牌数。再设初始时牌数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span>，某个类型最大的牌数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">maxx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">xx</span></span></span></span>（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">maxx=max(a_1,a_2,...,a_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">xx</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>）。首先有个性质，假如我们不受 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 的限制，可以任意加牌，我们在确定了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 之后，发现还差点牌（即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi><mo>&gt;</mo><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">xy&gt;sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span>），那么是一定可以补上，且仍保持每堆中牌类型各不相同。
显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>≤</mo><mi>x</mi><mi>y</mi><mo>≤</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">sum\le xy\le sum+k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi><mo>≤</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">maxx\le x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">xx</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>（因为同一个堆中不能有相同的牌，所以相同类型的牌一定是要放到不同的堆）。
题目即要求我们求出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 的最大值。其实检查一个答案是否合法的时间复杂度并不高，所以我们考虑从大到小枚举 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>。对于给定的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 是有范围的，为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">⌈</mo><mfrac><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><mi>y</mi></mfrac><mo fence="true">⌉</mo></mrow><mo>≤</mo><mi>x</mi><mo>≤</mo><mrow><mo fence="true">⌊</mo><mfrac><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>k</mi></mrow><mi>y</mi></mfrac><mo fence="true">⌋</mo></mrow></mrow><annotation encoding="application/x-tex">\left \lceil \frac{sum}{y} \right \rceil \le x \le \left \lfloor \frac{sum+k}{y} \right \rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">⌈</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">⌉</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">⌊</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">⌋</span></span></span></span></span></span>，再加上 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi><mo>≤</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">maxx\le x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">xx</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，两个范围叠加上去，如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 有解，那么当前枚举的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 是合法的。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBaW5saW5lJTIwdm9pZCUyMHN1YnRhc2soKSU3QiUwQSUwOWludCUyMG4lMkNrJTNCY2luJTNFJTNFbiUzRSUzRWslM0IlMEElMDlpbnQlMjBtYXh4JTNELWluZiUzQiUwQSUwOWludCUyMHN1bSUzRDAlM0IlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aW50JTIweCUzQmNpbiUzRSUzRXglM0IlMEElMDklMDltYXh4JTNEbWF4KG1heHglMkN4KSUzQiUwQSUwOSUwOXN1bSUyQiUzRHglM0IlMEElMDklN0QlMEElMDlmb3IoaW50JTIwaSUzRG4lM0JpJTNFJTNEMSUzQmktLSklN0IlMEElMDklMDlpbnQlMjBmbCUzRGNlaWwoMS4wKnN1bSUyRmkpJTNCJTBBJTA5JTA5aW50JTIwZnIlM0RmbG9vcigxLjAqKHN1bSUyQmspJTJGaSklM0IlMEElMDklMDlpZihmbCUzRWZyKSUyMGNvbnRpbnVlJTNCJTBBJTA5JTA5aWYobWF4eCUzQyUzRGZyKSU3QiUwQSUwOSUwOSUwOWNvdXQlM0MlM0NpJTNDJTNDZW5kbCUzQiUwQSUwOSUwOSUwOWJyZWFrJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTdEJTBBc2lnbmVkJTIwbWFpbigpJTdCJTBBJTA5aW9zJTNBJTNBc3luY193aXRoX3N0ZGlvKGZhbHNlKSUzQiUwQSUwOWludCUyMHQlM0JjaW4lM0UlM0V0JTNCJTBBJTA5d2hpbGUodC0tKSUyMHN1YnRhc2soKSUzQiUwQSUwOXJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
	<span class="hljs-type">int</span> n,k;cin&gt;&gt;n&gt;&gt;k;
	<span class="hljs-type">int</span> maxx=-inf;
	<span class="hljs-type">int</span> sum=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-type">int</span> x;cin&gt;&gt;x;
		maxx=<span class="hljs-built_in">max</span>(maxx,x);
		sum+=x;
	}
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=n;i&gt;=<span class="hljs-number">1</span>;i--){
		<span class="hljs-type">int</span> fl=<span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.0</span>*sum/i);
		<span class="hljs-type">int</span> fr=<span class="hljs-built_in">floor</span>(<span class="hljs-number">1.0</span>*(sum+k)/i);
		<span class="hljs-keyword">if</span>(fl&gt;fr) <span class="hljs-keyword">continue</span>;
		<span class="hljs-keyword">if</span>(maxx&lt;=fr){
			cout&lt;&lt;i&lt;&lt;endl;
			<span class="hljs-keyword">break</span>;
		}
	}
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
	<span class="hljs-type">int</span> t;cin&gt;&gt;t;
	<span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="cf-2019-d" tabindex="-1">CF2019D</h2>
<p>主观难度：普及+/提高
标签：前缀和、二分、差分
比 E 难，赛时感觉做不出来就摆烂了，后面又自己想出来了。
首先有一点，如果点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 的时间限制为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，那么与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 距离大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的点都不会是有获胜策略的点。通过这一点我们就可以先排除一部分点。
然后我们考虑只判断一个点该怎么做。我们贪心地考虑，肯定先左右寻找 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 最小的点，然后一直沿着这个点的方向占领，直到占领了这个点，然后再寻找下一个最小的点，沿着对应的方向占领，以此类推。因为我们很自然地想去先把当前最棘手的点先处理掉，不那么棘手的点之后再处理。
然后我们就又得到一个结论，对于两个点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>，如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 之间点的数量（包括<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>）大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">max(t_x,t_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，那么这两个点之间的所有的点都不会是有必胜策略的点。可以按照上述的贪心策略证明。这中间的点，肯定会先去占领 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 最小的那个，占领完毕后再去占领另一个，此时中间所有的点都被占领了，但是耗费时间却大于另一个点的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 值，无法占领另一个点。
我们考虑枚举 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>。考虑枚举两者之间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 值最大的那个，记为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，然后分别在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>x</mi><mo>−</mo><msub><mi>t</mi><mi>x</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1,x-t_x]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>x</mi><mo>+</mo><msub><mi>t</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[x+t_x,n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span> 中寻找距离 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 最远的且小于等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">t_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>，然后 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 之间所有的点都标记为无必胜策略的点。其中，寻找 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 可以通过搞前缀和后缀最小值+二分解决。标记无必胜策略点可以通过差分来解决。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQSUyM2RlZmluZSUyMF8lMjAyMDAwMDUlMEF0eXBlZGVmJTIwcGFpciUzQ2ludCUyQ2ludCUzRSUyMHBpaSUzQiUwQWludCUyMHRhZyU1Ql8lNUQlMkNpbiU1Ql8lNUQlMkNwcmUlNUJfJTVEJTJDc3VmJTVCXyU1RCUzQiUwQWlubGluZSUyMHZvaWQlMjBwdXNoKGludCUyMGwlMkNpbnQlMjByKSU3QnRhZyU1QmwlNUQlMkIlMkIlMkN0YWclNUJyJTJCMSU1RC0tJTNCJTdEJTBBaW5saW5lJTIwdm9pZCUyMHN1YnRhc2soKSU3QiUwQSUyMCUyMCUyMCUyMGludCUyMG4lM0JjaW4lM0UlM0VuJTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSUyMGNpbiUzRSUzRWluJTVCaSU1RCUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RuJTNCaSUyQiUyQiklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpbnQlMjByJTNEaSUyQmluJTVCaSU1RCUyQ2wlM0RpLWluJTVCaSU1RCUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKHIlM0MlM0RuKSUyMHB1c2gociUyQ24pJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYobCUzRSUzRDEpJTIwcHVzaCgxJTJDbCklM0IlMEElMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjBwcmUlNUIxJTVEJTNEaW4lNUIxJTVEJTJDc3VmJTVCbiU1RCUzRGluJTVCbiU1RCUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMiUzQmklM0MlM0RuJTNCaSUyQiUyQiklMjBwcmUlNUJpJTVEJTNEbWluKHByZSU1QmktMSU1RCUyQ2luJTVCaSU1RCklM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRG4tMSUzQmklM0UlM0QxJTNCaS0tKSUyMHN1ZiU1QmklNUQlM0RtaW4oc3VmJTVCaSUyQjElNUQlMkNpbiU1QmklNUQpJTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGludCUyMG5vdyUzRGluJTVCaSU1RCUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGludCUyMFIlM0RpJTJCaW4lNUJpJTVEJTJDTCUzRGktaW4lNUJpJTVEJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYoUiUzQyUzRG4pJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTJGJTJGZGVhbCUyMHJpZ2h0JTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwbCUzRFIlMkNyJTNEbiUyQ2FucyUzRC0xJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwd2hpbGUobCUzQyUzRHIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwbWlkJTNEKGwlMkJyKSUzRSUzRTElM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihzdWYlNUJtaWQlNUQlM0MlM0Rub3cpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwYW5zJTNEbWlkJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwbCUzRG1pZCUyQjElM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0RlbHNlJTIwciUzRG1pZC0xJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYoYW5zISUzRC0xKSUyMHB1c2goaSUyQ2FucyklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihMJTNFJTNEMSklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMkYlMkZkZWFsJTIwbGVmdCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGludCUyMGwlM0QxJTJDciUzREwlMkNhbnMlM0QtMSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHdoaWxlKGwlM0MlM0RyKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGludCUyMG1pZCUzRChsJTJCciklM0UlM0UxJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYocHJlJTVCbWlkJTVEJTNDJTNEbm93KSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGFucyUzRG1pZCUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHIlM0RtaWQtMSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RGVsc2UlMjBsJTNEbWlkJTJCMSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKGFucyElM0QtMSklMjBwdXNoKGFucyUyQ2kpJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwaW50JTIwc3VtJTNEMCUyQ2FucyUzRDAlM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwc3VtJTJCJTNEdGFnJTVCaSU1RCUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKCFzdW0pJTIwYW5zJTJCJTJCJTNCJTBBJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwY291dCUzQyUzQ2FucyUzQyUzQ2VuZGwlM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUyQjElM0JpJTJCJTJCKSUyMHRhZyU1QmklNUQlM0QwJTNCJTBBJTdEJTBBc2lnbmVkJTIwbWFpbigpJTdCJTBBJTIwJTIwJTIwJTIwaW9zJTNBJTNBc3luY193aXRoX3N0ZGlvKGZhbHNlKSUzQiUwQSUyMCUyMCUyMCUyMGludCUyMHQlM0JjaW4lM0UlM0V0JTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRHQlM0JpJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHN1YnRhc2soKSUzQiUwQSUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMHJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _ 200005</span>
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-type">int</span> tag[_],in[_],pre[_],suf[_];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>{tag[l]++,tag[r<span class="hljs-number">+1</span>]--;}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    <span class="hljs-type">int</span> n;cin&gt;&gt;n;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;in[i];
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        <span class="hljs-type">int</span> r=i+in[i],l=i-in[i];
        <span class="hljs-keyword">if</span>(r&lt;=n) <span class="hljs-built_in">push</span>(r,n);
        <span class="hljs-keyword">if</span>(l&gt;=<span class="hljs-number">1</span>) <span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>,l);
    }
    pre[<span class="hljs-number">1</span>]=in[<span class="hljs-number">1</span>],suf[n]=in[n];
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++) pre[i]=<span class="hljs-built_in">min</span>(pre[i<span class="hljs-number">-1</span>],in[i]);
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=n<span class="hljs-number">-1</span>;i&gt;=<span class="hljs-number">1</span>;i--) suf[i]=<span class="hljs-built_in">min</span>(suf[i<span class="hljs-number">+1</span>],in[i]);
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        <span class="hljs-type">int</span> now=in[i];
        <span class="hljs-type">int</span> R=i+in[i],L=i-in[i];
        <span class="hljs-keyword">if</span>(R&lt;=n){
            <span class="hljs-comment">//deal right</span>
            <span class="hljs-type">int</span> l=R,r=n,ans=<span class="hljs-number">-1</span>;
            <span class="hljs-keyword">while</span>(l&lt;=r){
                <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span>(suf[mid]&lt;=now){
                    ans=mid;
                    l=mid<span class="hljs-number">+1</span>;
                }<span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;
            }
            <span class="hljs-keyword">if</span>(ans!=<span class="hljs-number">-1</span>) <span class="hljs-built_in">push</span>(i,ans);
        }
        <span class="hljs-keyword">if</span>(L&gt;=<span class="hljs-number">1</span>){
            <span class="hljs-comment">//deal left</span>
            <span class="hljs-type">int</span> l=<span class="hljs-number">1</span>,r=L,ans=<span class="hljs-number">-1</span>;
            <span class="hljs-keyword">while</span>(l&lt;=r){
                <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span>(pre[mid]&lt;=now){
                    ans=mid;
                    r=mid<span class="hljs-number">-1</span>;
                }<span class="hljs-keyword">else</span> l=mid<span class="hljs-number">+1</span>;
            }
            <span class="hljs-keyword">if</span>(ans!=<span class="hljs-number">-1</span>) <span class="hljs-built_in">push</span>(ans,i);
        }
    }
    <span class="hljs-type">int</span> sum=<span class="hljs-number">0</span>,ans=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        sum+=tag[i];
        <span class="hljs-keyword">if</span>(!sum) ans++;
    }
    cout&lt;&lt;ans&lt;&lt;endl;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n<span class="hljs-number">+1</span>;i++) tag[i]=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t;cin&gt;&gt;t;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=t;i++){
        <span class="hljs-built_in">subtask</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<p>注意的是，差分这里有这样的一句 <code>tag[r+1]--</code>，如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> 取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>，那么就涉及到了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>g</mi><mo stretchy="false">[</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">tag[n+1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 。如果最后清空的时候只清空到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>g</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">tag[n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span> 的话就寄啦！</p>
<h2 id="cf-2019-e" tabindex="-1">CF2019E</h2>
<p>主观难度：普及/提高-
标签：图论、bfs、dfs
赛时看这道题过的比D还多，于是直接跳过D来做E。一开始有点被题号吓到了，不过思考之后发现还是不难的。
到根的距离即为深度。我们从点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 开始一种类似 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>f</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">bfs</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">s</span></span></span></span> 的处理方式。先把点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 的子节点都取出来，放入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">sta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span></span></span></span> 数组中。这些点加上点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 就是如果我们让所有的点到根距离都为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 的话，需要保留的点。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">sta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span></span></span></span> 数组表示的是位于当前深度的点。考虑增加深度，我们让 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">sta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span></span></span></span> 数组中的点都尝试往下再遍历新的点。如果能的话就再把新的点也加入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">stb</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span></span></span></span> 数组中，不能的话，说明这个点要被删掉，给它打个标记。如果一个点的所有子点都被标记为删除，那么这个点也要被标记删除。然后在把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">stb</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span></span></span></span> 数组替换 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">sta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span></span></span></span> 数组，重复上述过程。一个点最多被添加一次，删除一次，所以复杂度是能控制住的。这个过程中维护当前留下来的点。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjB1bGwlMjB1bnNpZ25lZCUyMGxvbmclMjBsb25nJTBBJTIzZGVmaW5lJTIwbHMoayklMjAoayklM0MlM0MxJTBBJTIzZGVmaW5lJTIwcnMoayklMjAoayklM0MlM0MxJTdDMSUwQSUyM2RlZmluZSUyMGRlYnVnKHgpJTIwY291dCUzQyUzQyUyM3glM0MlM0MlMjIlM0QlMjIlM0MlM0N4JTNDJTNDZW5kbCUwQSUyM2RlZmluZSUyMF8lMjA1MDAwMDUlMEF1c2luZyUyMG5hbWVzcGFjZSUyMHN0ZCUzQiUwQWNvbnN0JTIwaW50JTIwaW5mJTNEMHgzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBc3RydWN0JTIwRWRnZSU3QmludCUyMG5leHQlMkN0byUzQiU3RCUyMGVkZ2UlNUJfJTNDJTNDMSU1RCUzQiUwQWludCUyMGhlYWQlNUJfJTVEJTJDc2l6JTJDZiU1Ql8lNUQlMkN0YWclNUJfJTVEJTJDY250JTVCXyU1RCUzQiUwQWlubGluZSUyMHZvaWQlMjBhZGQoaW50JTIwdSUyQ2ludCUyMHYpJTdCZWRnZSU1QiUyQiUyQnNpeiU1RC50byUzRHYlMkNlZGdlJTVCc2l6JTVELm5leHQlM0RoZWFkJTVCdSU1RCUyQ2hlYWQlNUJ1JTVEJTNEc2l6JTNCJTdEJTBBdm9pZCUyMGRmczEoaW50JTIweCUyQ2ludCUyMGZhKSU3QiUwQSUwOWZvcihpbnQlMjBpJTNEaGVhZCU1QnglNUQlM0JpJTNCaSUzRGVkZ2UlNUJpJTVELm5leHQpJTdCJTBBJTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaSU1RC50byUzQiUwQSUwOSUwOWlmKHRvJTNEJTNEZmEpJTIwY29udGludWUlM0IlMEElMDklMDlmJTVCdG8lNUQlM0R4JTNCJTBBJTA5JTA5Y250JTVCeCU1RCUyQiUyQiUzQiUwQSUwOSUwOWRmczEodG8lMkN4KSUzQiUwQSUwOSU3RCUwQSU3RCUwQWludCUyMHN0YSU1Ql8lNUQlMkNzdGIlNUJfJTVEJTJDcGElMkNwYiUyQ2FucyU1Ql8lNUQlMkNub3clMkNkZXAlM0IlMEF2b2lkJTIwZGVsKGludCUyMHgpJTdCJTBBJTA5bm93LS0lM0IlMEElMDl0YWclNUJmJTVCeCU1RCU1RCUyQiUyQiUzQiUwQSUwOWlmKHRhZyU1QmYlNUJ4JTVEJTVEJTNEJTNEY250JTVCZiU1QnglNUQlNUQpJTdCJTBBJTA5JTA5ZGVsKGYlNUJ4JTVEKSUzQiUwQSUwOSU3RCUwQSU3RCUwQXZvaWQlMjBkZnMyKGludCUyMHgpJTdCJTBBJTA5YW5zJTVCeCU1RCUzRG5vdyUzQiUwQSUwOXBiJTNEMCUzQiUwQSUwOWZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RwYSUzQmklMkIlMkIpJTdCJTBBJTA5JTA5aWYoIWNudCU1QnN0YSU1QmklNUQlNUQpJTdCJTBBJTA5JTA5JTA5ZGVsKHN0YSU1QmklNUQpJTNCJTBBJTA5JTA5JTdEZWxzZSU3QiUwQSUwOSUwOSUwOWZvcihpbnQlMjBqJTNEaGVhZCU1QnN0YSU1QmklNUQlNUQlM0JqJTNCaiUzRGVkZ2UlNUJqJTVELm5leHQpJTdCJTBBJTA5JTA5JTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaiU1RC50byUzQiUwQSUwOSUwOSUwOSUwOWlmKHRvJTNEJTNEZiU1QnN0YSU1QmklNUQlNUQpJTIwY29udGludWUlM0IlMEElMDklMDklMDklMDlzdGIlNUIlMkIlMkJwYiU1RCUzRHRvJTNCJTBBJTA5JTA5JTA5JTA5bm93JTJCJTJCJTNCJTBBJTA5JTA5JTA5JTdEJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTA5cGElM0QwJTNCJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRHBiJTNCaSUyQiUyQiklN0IlMEElMDklMDlzdGElNUIlMkIlMkJwYSU1RCUzRHN0YiU1QmklNUQlM0IlMEElMDklN0QlMEElMDlpZihwYSUzRCUzRDApJTIwcmV0dXJuJTIwZGVwJTNEeCUyQ3ZvaWQoKSUzQiUwQSUwOWVsc2UlMjBkZnMyKHglMkIxKSUzQiUwQSU3RCUwQWlubGluZSUyMHZvaWQlMjBzdWJ0YXNrKCklN0IlMEElMDlpbnQlMjBuJTNCY2luJTNFJTNFbiUzQiUwQSUwOWZvcihpbnQlMjBpJTNEMSUzQmklM0NuJTNCaSUyQiUyQiklN0IlMEElMDklMDlpbnQlMjB1JTJDdiUzQmNpbiUzRSUzRXUlM0UlM0V2JTNCJTBBJTA5JTA5YWRkKHUlMkN2KSUzQmFkZCh2JTJDdSklM0IlMEElMDklN0QlMEElMDlkZnMxKDElMkMwKSUzQiUwQSUwOXBhJTNEMCUzQiUwQSUwOWZvcihpbnQlMjBpJTNEaGVhZCU1QjElNUQlM0JpJTNCaSUzRGVkZ2UlNUJpJTVELm5leHQpJTdCJTBBJTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaSU1RC50byUzQiUwQSUwOSUwOXN0YSU1QiUyQiUyQnBhJTVEJTNEdG8lM0IlMEElMDklN0QlMEElMDlub3clM0QxJTJCcGElM0IlMEElMDlkZnMyKDEpJTNCJTBBJTA5aW50JTIwbWF4eCUzRC1pbmYlM0IlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEZGVwJTNCaSUyQiUyQiklMjBtYXh4JTNEbWF4KG1heHglMkNhbnMlNUJpJTVEKSUzQiUwQSUwOWNvdXQlM0MlM0NuLW1heHglM0MlM0NlbmRsJTNCJTBBJTA5c2l6JTNEMCUzQiUwQSUwOWZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RuJTNCaSUyQiUyQiklMjBoZWFkJTVCaSU1RCUzRGYlNUJpJTVEJTNEY250JTVCaSU1RCUzRHRhZyU1QmklNUQlM0QwJTNCJTBBJTdEJTBBc2lnbmVkJTIwbWFpbigpJTdCJTBBJTA5aW9zJTNBJTNBc3luY193aXRoX3N0ZGlvKGZhbHNlKSUzQiUwQSUwOWludCUyMHQlM0JjaW4lM0UlM0V0JTNCJTBBJTA5d2hpbGUodC0tKSUyMHN1YnRhc2soKSUzQiUwQSUwOXJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _ 500005</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>{<span class="hljs-type">int</span> next,to;} edge[_&lt;&lt;<span class="hljs-number">1</span>];
<span class="hljs-type">int</span> head[_],siz,f[_],tag[_],cnt[_];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span>{edge[++siz].to=v,edge[siz].next=head[u],head[u]=siz;}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs1</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> fa)</span></span>{
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[x];i;i=edge[i].next){
		<span class="hljs-type">int</span> to=edge[i].to;
		<span class="hljs-keyword">if</span>(to==fa) <span class="hljs-keyword">continue</span>;
		f[to]=x;
		cnt[x]++;
		<span class="hljs-built_in">dfs1</span>(to,x);
	}
}
<span class="hljs-type">int</span> sta[_],stb[_],pa,pb,ans[_],now,dep;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
	now--;
	tag[f[x]]++;
	<span class="hljs-keyword">if</span>(tag[f[x]]==cnt[f[x]]){
		<span class="hljs-built_in">del</span>(f[x]);
	}
}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs2</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
	ans[x]=now;
	pb=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=pa;i++){
		<span class="hljs-keyword">if</span>(!cnt[sta[i]]){
			<span class="hljs-built_in">del</span>(sta[i]);
		}<span class="hljs-keyword">else</span>{
			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=head[sta[i]];j;j=edge[j].next){
				<span class="hljs-type">int</span> to=edge[j].to;
				<span class="hljs-keyword">if</span>(to==f[sta[i]]) <span class="hljs-keyword">continue</span>;
				stb[++pb]=to;
				now++;
			}
		}
	}
	pa=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=pb;i++){
		sta[++pa]=stb[i];
	}
	<span class="hljs-keyword">if</span>(pa==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> dep=x,<span class="hljs-built_in">void</span>();
	<span class="hljs-keyword">else</span> <span class="hljs-built_in">dfs2</span>(x<span class="hljs-number">+1</span>);
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
	<span class="hljs-type">int</span> n;cin&gt;&gt;n;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++){
		<span class="hljs-type">int</span> u,v;cin&gt;&gt;u&gt;&gt;v;
		<span class="hljs-built_in">add</span>(u,v);<span class="hljs-built_in">add</span>(v,u);
	}
	<span class="hljs-built_in">dfs1</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
	pa=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[<span class="hljs-number">1</span>];i;i=edge[i].next){
		<span class="hljs-type">int</span> to=edge[i].to;
		sta[++pa]=to;
	}
	now=<span class="hljs-number">1</span>+pa;
	<span class="hljs-built_in">dfs2</span>(<span class="hljs-number">1</span>);
	<span class="hljs-type">int</span> maxx=-inf;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=dep;i++) maxx=<span class="hljs-built_in">max</span>(maxx,ans[i]);
	cout&lt;&lt;n-maxx&lt;&lt;endl;
	siz=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) head[i]=f[i]=cnt[i]=tag[i]=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
	<span class="hljs-type">int</span> t;cin&gt;&gt;t;
	<span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="cf-2019-f" tabindex="-1">CF2019F</h2>
<p>主观难度：普及+/提高
标签：并查集、贪心
感觉最后要最大化的东西影响因素很多，不好处理，于是就摆烂了（划掉
首先需要观察出一点：一定要把最大值选上（和A很像）。如果最大值两边都没有被选，显然选上最大值是更好的。如果一边的数被选了，显然取消选中，该选最大值是更好的。如果两边都选了，把这两个都取消选中，选上最大值，虽然数量上少了一，但是最大值比次大值至少大一，因此把亏的又给补上了。综上，一定要把最大值选上。
影响最终式子的还有最小值。我们不妨直接枚举最小值吧。从大到小枚举最小值。因为我们枚举的是最小值，所以只有位于最大值和最小值之间的数字目前能被选中。随着这个枚举过程，我们能够选中的数字是越来越多的。
但还有一个限制，选中的数字不能相邻。现在能被选中的数字都是可以随便选的，只会对选中的数量产生影响。于是我们考虑一个东西，给你一个序列，选择的数不能相邻，最多能选多少个数？显然是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">⌈</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo fence="true">⌉</mo></mrow><annotation encoding="application/x-tex">\left \lceil \frac{len}{2} \right \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2301em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">⌈</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">⌉</span></span></span></span></span></span> 的（ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">len</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span></span></span></span> 为这个序列的长度）。随着最小值的枚举，能够选中的数字是越来越多，这些能够选中的位置就形成了若干个联通块，各个联通块内怎么选互不干扰。于是我们维护联通块大小（这里就用到并查集了）一个大小为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">len</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span></span></span></span> 的联通块对答案的贡献为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">⌈</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo fence="true">⌉</mo></mrow><annotation encoding="application/x-tex">\left \lceil \frac{len}{2} \right \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2301em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">⌈</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">⌉</span></span></span></span></span></span>。
不过这里又有点问题，上述的做法的前提是能够选中的数字随便选。你要随便选的话可能没选中最大值，而我们说你要选中最大值了才是最优的。如果一个联通块内能把最大值选上，那么其他联通块内就能随便选了。对于偶数长度的联通块，只要包含最大值，就是能够选上的。而对于奇数的联通块，我们上面得出联通块对答案的贡献为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">⌈</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo fence="true">⌉</mo></mrow><annotation encoding="application/x-tex">\left \lceil \frac{len}{2} \right \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2301em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">⌈</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">⌉</span></span></span></span></span></span> 的前提是奇数长度联通块都是把第奇数个元素选中。而最大值可不一定在第奇数个元素里面。我们考虑，如果所有的偶数长度的联通块中不包含最大值，奇数长度的联通块中，最大值都出现在第偶数个元素的位置，那么就必须有一个奇数长度的联通块需要牺牲一下，不把第奇数个元素选中，而把第偶数个元素选中，对答案的贡献由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">⌈</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo fence="true">⌉</mo></mrow><annotation encoding="application/x-tex">\left \lceil \frac{len}{2} \right \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2301em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">⌈</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">⌉</span></span></span></span></span></span> 变为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">⌊</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><mn>2</mn></mfrac><mo fence="true">⌋</mo></mrow><annotation encoding="application/x-tex">\left \lfloor \frac{len}{2} \right \rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2301em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">⌊</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">⌋</span></span></span></span></span></span>，减了一。但是这个联通块牺牲后，最大值就被选上了，其余联通块对答案贡献不变。
为了处理这些，我们需要对每个联通块记录一下，其奇数位置是否有最大值出现，偶数位置是否有最大值出现。</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBJTIzZGVmaW5lJTIwXyUyMDIwMDAwNSUwQWludCUyMGluJTVCXyU1RCUyQ2ZhJTVCXyU1RCUyQ2hhcyU1Ql8lNUQlNUIyJTVEJTJDc2l6JTVCXyU1RCUyQ3RhZyUyQ3BpY2slNUJfJTVEJTJDY250JTNCJTBBJTJGJTJGJTIwdGFnJUU0JUI4JUJBJUU1JUJEJTkzJUU1JTg5JThEJUU2JTlDJTg5JUU1JUE0JTlBJUU1JUIwJTkxJUU0JUI4JUFBJUU4JTgxJTk0JUU5JTgwJTlBJUU1JTlEJTk3JUU4JTgzJUJEJUU1JTlDJUE4JUU0JUI4JThEJUU5JTk5JThEJUU0JUJEJThFJUU1JUFGJUI5JUU3JUFEJTk0JUU2JUExJTg4JUU3JTlBJTg0JUU4JUI0JUExJUU3JThDJUFFJUU2JTgzJTg1JUU1JTg2JUI1JUU0JUI4JThCJUU2JThBJThBJUU2JTlDJTgwJUU1JUE0JUE3JUU1JTgwJUJDJUU5JTgwJTg5JUU0JUI4JThBJTBBJTJGJTJGJTIwY250JUU0JUI4JUJBJUU1JUJEJTkzJUU1JTg5JThEJUU2JTg5JTgwJUU2JTlDJTg5JUU4JTgxJTk0JUU5JTgwJTlBJUU1JTlEJTk3JUU3JTlBJTg0JUU5JTk1JUJGJUU1JUJBJUE2JUU5JTgzJUE4JUU1JTg4JTg2JUU1JUFGJUI5JUU3JUFEJTk0JUU2JUExJTg4JUU3JTlBJTg0JUU4JUI0JUExJUU3JThDJUFFJTBBaW5saW5lJTIwaW50JTIwZmluZChpbnQlMjB4KSU3QndoaWxlKHghJTNEZmElNUJ4JTVEKSUyMHglM0RmYSU1QnglNUQlM0RmYSU1QmZhJTVCeCU1RCU1RCUzQnJldHVybiUyMHglM0IlN0QlMEFpbmxpbmUlMjBib29sJTIwcHJvdmlkZShpbnQlMjB4KSU3QiUwQSUyMCUyMCUyMCUyMGlmKHNpeiU1QnglNUQlMjUyJTNEJTNEMCklMjByZXR1cm4lMjBtYXgoaGFzJTVCeCU1RCU1QjAlNUQlMkNoYXMlNUJ4JTVEJTVCMSU1RCklM0IlMEElMjAlMjAlMjAlMjBlbHNlJTIwcmV0dXJuJTIwaGFzJTVCeCU1RCU1QjElNUQlM0IlMEElN0QlMEFpbmxpbmUlMjB2b2lkJTIwdW5pKGludCUyMGwlMkNpbnQlMjByKSU3QiUwQSUyMCUyMCUyMCUyMGludCUyMGZheCUzRGZpbmQobCklMkNmYXklM0RmaW5kKHIpJTNCJTBBJTIwJTIwJTIwJTIwaWYocHJvdmlkZShmYXgpKSUyMHRhZy0tJTNCJTBBJTIwJTIwJTIwJTIwaWYocHJvdmlkZShmYXkpKSUyMHRhZy0tJTNCJTBBJTIwJTIwJTIwJTIwY250LSUzRGNlaWwoMS4wKnNpeiU1QmZheCU1RCUyRjIpJTNCJTBBJTIwJTIwJTIwJTIwY250LSUzRGNlaWwoMS4wKnNpeiU1QmZheSU1RCUyRjIpJTNCJTBBJTIwJTIwJTIwJTIwaWYoc2l6JTVCZmF4JTVEJTI1MiklMjBoYXMlNUJmYXglNUQlNUIwJTVEJTNEbWF4KGhhcyU1QmZheCU1RCU1QjAlNUQlMkNoYXMlNUJmYXklNUQlNUIxJTVEKSUyQ2hhcyU1QmZheCU1RCU1QjElNUQlM0RtYXgoaGFzJTVCZmF4JTVEJTVCMSU1RCUyQ2hhcyU1QmZheSU1RCU1QjAlNUQpJTNCJTBBJTIwJTIwJTIwJTIwZWxzZSUyMGhhcyU1QmZheCU1RCU1QjAlNUQlM0RtYXgoaGFzJTVCZmF4JTVEJTVCMCU1RCUyQ2hhcyU1QmZheSU1RCU1QjAlNUQpJTJDaGFzJTVCZmF4JTVEJTVCMSU1RCUzRG1heChoYXMlNUJmYXglNUQlNUIxJTVEJTJDaGFzJTVCZmF5JTVEJTVCMSU1RCklM0IlMEElMjAlMjAlMjAlMjBzaXolNUJmYXglNUQlM0RzaXolNUJmYXglNUQlMkJzaXolNUJmYXklNUQlM0IlMEElMjAlMjAlMjAlMjBmYSU1QmZheSU1RCUzRGZheCUzQiUwQSUyMCUyMCUyMCUyMGlmKHByb3ZpZGUoZmF4KSklMjB0YWclMkIlMkIlM0IlMEElMjAlMjAlMjAlMjBjbnQlMkIlM0RjZWlsKDEuMCpzaXolNUJmYXglNUQlMkYyKSUzQiUwQSU3RCUwQXBpaSUyMHBhJTVCXyU1RCUzQiUwQWlubGluZSUyMHZvaWQlMjBzdWJ0YXNrKCklN0IlMEElMjAlMjAlMjAlMjB0YWclM0QwJTNCY250JTNEMCUzQiUwQSUyMCUyMCUyMCUyMGludCUyMG4lM0IlMEElMjAlMjAlMjAlMjBjaW4lM0UlM0VuJTNCZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSUyMGNpbiUzRSUzRWluJTVCaSU1RCUzQiUwQSUyMCUyMCUyMCUyMGlmKGZsYWcpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSUyMGNvdXQlM0MlM0NpbiU1QmklNUQlM0MlM0MnJTIwJyUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNvdXQlM0MlM0NlbmRsJTNCJTBBJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSUyMGZhJTVCaSU1RCUzRGklMkNzaXolNUJpJTVEJTNEMSUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RuJTNCaSUyQiUyQiklMjBwYSU1QmklNUQlM0RwaWkoaSUyQ2luJTVCaSU1RCklM0IlMEElMjAlMjAlMjAlMjBzb3J0KHBhJTJCMSUyQ3BhJTJCbiUyQjElMkMlNUIlNUQocGlpJTIwYSUyQ3BpaSUyMGIpJTdCcmV0dXJuJTIwYS5zZWNvbmQlM0ViLnNlY29uZCUzQiU3RCklM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaGFzJTVCaSU1RCU1QjAlNUQlM0QwJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYoaW4lNUJpJTVEJTNEJTNEcGElNUIxJTVELnNlY29uZCklMjBoYXMlNUJpJTVEJTVCMSU1RCUzRDElM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBlbHNlJTIwaGFzJTVCaSU1RCU1QjElNUQlM0QwJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwcGljayU1QmklNUQlM0QwJTNCJTBBJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwaW50JTIwYW5zJTNELWluZiUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RuJTNCaSUyQiUyQiklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpbnQlMjBwJTNEcGElNUJpJTVELmZpcnN0JTJDdiUzRHBhJTVCaSU1RC5zZWNvbmQlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMkYlMkZkZWJ1ZyhwKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHRhZyUyQiUzRGhhcyU1QnAlNUQlNUIxJTVEJTNCcGljayU1QnAlNUQlM0QxJTNCY250JTJCJTJCJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYocCUzRSUzRDIlMjYlMjZwaWNrJTVCcC0xJTVEKSUyMHVuaShwLTElMkNwKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKHAlM0MlM0RuLTElMjYlMjZwaWNrJTVCcCUyQjElNUQpJTIwdW5pKHAlMkNwJTJCMSklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZih0YWcpJTIwYW5zJTNEbWF4KGFucyUyQ3BhJTVCMSU1RC5zZWNvbmQlMkJ2JTJCY250KSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGVsc2UlMjBhbnMlM0RtYXgoYW5zJTJDcGElNUIxJTVELnNlY29uZCUyQnYlMkJjbnQtMSklM0IlMEElMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjBjb3V0JTNDJTNDYW5zJTNDJTNDZW5kbCUzQiUwQSU3RCUwQXNpZ25lZCUyMG1haW4oKSU3QiUwQSUyMCUyMCUyMCUyMGlvcyUzQSUzQXN5bmNfd2l0aF9zdGRpbyhmYWxzZSklM0IlMEElMjAlMjAlMjAlMjBpbnQlMjB0JTNCY2luJTNFJTNFdCUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0R0JTNCaSUyQiUyQiklMjBzdWJ0YXNrKCklM0IlMEElMjAlMjAlMjAlMjByZXR1cm4lMjAwJTNCJTBBJTdEJTBB"><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _ 200005</span>
<span class="hljs-type">int</span> in[_],fa[_],has[_][<span class="hljs-number">2</span>],siz[_],tag,pick[_],cnt;
<span class="hljs-comment">// tag为当前有多少个联通块能在不降低对答案的贡献情况下把最大值选上</span>
<span class="hljs-comment">// cnt为当前所有联通块的长度部分对答案的贡献</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{<span class="hljs-keyword">while</span>(x!=fa[x]) x=fa[x]=fa[fa[x]];<span class="hljs-keyword">return</span> x;}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">bool</span> <span class="hljs-title">provide</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
    <span class="hljs-keyword">if</span>(siz[x]%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(has[x][<span class="hljs-number">0</span>],has[x][<span class="hljs-number">1</span>]);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> has[x][<span class="hljs-number">1</span>];
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">uni</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>{
    <span class="hljs-type">int</span> fax=<span class="hljs-built_in">find</span>(l),fay=<span class="hljs-built_in">find</span>(r);
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">provide</span>(fax)) tag--;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">provide</span>(fay)) tag--;
    cnt-=<span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.0</span>*siz[fax]/<span class="hljs-number">2</span>);
    cnt-=<span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.0</span>*siz[fay]/<span class="hljs-number">2</span>);
    <span class="hljs-keyword">if</span>(siz[fax]%<span class="hljs-number">2</span>) has[fax][<span class="hljs-number">0</span>]=<span class="hljs-built_in">max</span>(has[fax][<span class="hljs-number">0</span>],has[fay][<span class="hljs-number">1</span>]),has[fax][<span class="hljs-number">1</span>]=<span class="hljs-built_in">max</span>(has[fax][<span class="hljs-number">1</span>],has[fay][<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">else</span> has[fax][<span class="hljs-number">0</span>]=<span class="hljs-built_in">max</span>(has[fax][<span class="hljs-number">0</span>],has[fay][<span class="hljs-number">0</span>]),has[fax][<span class="hljs-number">1</span>]=<span class="hljs-built_in">max</span>(has[fax][<span class="hljs-number">1</span>],has[fay][<span class="hljs-number">1</span>]);
    siz[fax]=siz[fax]+siz[fay];
    fa[fay]=fax;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">provide</span>(fax)) tag++;
    cnt+=<span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.0</span>*siz[fax]/<span class="hljs-number">2</span>);
}
pii pa[_];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    tag=<span class="hljs-number">0</span>;cnt=<span class="hljs-number">0</span>;
    <span class="hljs-type">int</span> n;
    cin&gt;&gt;n;<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;in[i];
    <span class="hljs-keyword">if</span>(flag){
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cout&lt;&lt;in[i]&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>;
        cout&lt;&lt;endl;
    }
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) fa[i]=i,siz[i]=<span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) pa[i]=<span class="hljs-built_in">pii</span>(i,in[i]);
    <span class="hljs-built_in">sort</span>(pa<span class="hljs-number">+1</span>,pa+n<span class="hljs-number">+1</span>,[](pii a,pii b){<span class="hljs-keyword">return</span> a.second&gt;b.second;});
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        has[i][<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span>(in[i]==pa[<span class="hljs-number">1</span>].second) has[i][<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> has[i][<span class="hljs-number">1</span>]=<span class="hljs-number">0</span>;
        pick[i]=<span class="hljs-number">0</span>;
    }
    <span class="hljs-type">int</span> ans=-inf;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        <span class="hljs-type">int</span> p=pa[i].first,v=pa[i].second;
        <span class="hljs-comment">//debug(p);</span>
        tag+=has[p][<span class="hljs-number">1</span>];pick[p]=<span class="hljs-number">1</span>;cnt++;
        <span class="hljs-keyword">if</span>(p&gt;=<span class="hljs-number">2</span>&amp;&amp;pick[p<span class="hljs-number">-1</span>]) <span class="hljs-built_in">uni</span>(p<span class="hljs-number">-1</span>,p);
        <span class="hljs-keyword">if</span>(p&lt;=n<span class="hljs-number">-1</span>&amp;&amp;pick[p<span class="hljs-number">+1</span>]) <span class="hljs-built_in">uni</span>(p,p<span class="hljs-number">+1</span>);
        <span class="hljs-keyword">if</span>(tag) ans=<span class="hljs-built_in">max</span>(ans,pa[<span class="hljs-number">1</span>].second+v+cnt);
        <span class="hljs-keyword">else</span> ans=<span class="hljs-built_in">max</span>(ans,pa[<span class="hljs-number">1</span>].second+v+cnt<span class="hljs-number">-1</span>);
    }
    cout&lt;&lt;ans&lt;&lt;endl;
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t;cin&gt;&gt;t;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=t;i++) <span class="hljs-built_in">subtask</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
