<p>由于想要在服务器上登录qq，所以把服务器的系统换成了windows系统。宝塔面板似乎不想支持windows系统（在windows系统上从来没有安装成功过），所以使用了php_study来搭建网站。而在之前使用宝塔面板的时候由于担心服务器跑路，所以使用了宝塔的七牛云备份插件，每天定时备份到七牛云储存。现在换到了windows系统上，需要自己实现一个七牛云备份的功能。</p>
<h2 id="dai-ma" tabindex="-1">代码</h2>
<p>使用node.js进行编写的脚本，执行后可以将数据库导出，并将网站文件夹打包压缩，上传到七牛云，执行完毕后还会进行邮件通知。以下为具体代码，需要手动安装模块，伸手党或使用方法直接看下面</p>
<pre><div class="head"><div class="language">javascript</div><div class="copy" data="dmFyJTIwYWNjZXNzS2V5JTIwJTNEJTIwJyclM0IlMEF2YXIlMjBzZWNyZXRLZXklMjAlM0QlMjAnJyUzQiUwQXZhciUyMGJ1Y2tldCUzRCcnJTNCJTBBdmFyJTIwc2l0ZVBhdGglM0QlMjIlMjIlM0IlMEF2YXIlMjBEQm5hbWUlM0QlMjIlMjIlM0IlMEF2YXIlMjBEQnB3ZCUzRCUyMiUyMiUzQiUwQXZhciUyMG1haWxIb3N0JTNEJTIyJTIyJTNCJTBBdmFyJTIwbWFpbFBvcnQlM0QlM0IlMEF2YXIlMjBtYWlsVXNlciUzRCUyMiUyMiUzQiUwQXZhciUyMG1haWxQd2QlM0QlMjIlMjIlM0IlMEF2YXIlMjBtYWlsVG8lM0QlMjIlMjIlM0IlMEElMEF2YXIlMjBsb2clM0QnJyUzQiUwQWNvbnN0JTIwc2QlMjAlM0QlMjByZXF1aXJlKCdzaWxseS1kYXRldGltZScpJTNCJTBBZnVuY3Rpb24lMjBhZGRMb2coc3RyKSU3QiUwQSUyMCUyMCUyMCUyMGNvbnN0JTIwdGltZSUzRHNkLmZvcm1hdChuZXclMjBEYXRlKCklMkMlMjAnWVlZWS1NTS1ERCUyMEhIJTNBbW0nKSUzQiUwQSUyMCUyMCUyMCUyMGxvZyUyQiUzRCclNUInJTJCdGltZSUyQiUyMiU1RCUyMiUyQnN0ciUyQiclM0NiciUzRSclM0IlMEElMjAlMjAlMjAlMjBjb25zb2xlLmxvZygnJTVCJyUyQnRpbWUlMkIlMjIlNUQlMjIlMkJzdHIlMkInJTVDbicpJTNCJTBBJTdEJTBBJTBBdmFyJTIwZnMlMjAlMjAlMjAlMjAlMjAlMjAlM0QlMjByZXF1aXJlKCdmcycpJTNCJTBBdmFyJTIwcGF0aCUyMCUyMCUyMCUyMCUzRCUyMHJlcXVpcmUoJ3BhdGgnKSUzQiUwQXZhciUyMGFyY2hpdmVyJTIwJTIwJTNEJTIwcmVxdWlyZSgnYXJjaGl2ZXInKSUzQiUwQWNvbnN0JTIwJTdCJTIwdG9OYW1lc3BhY2VkUGF0aCUyMCU3RCUyMCUzRCUyMHJlcXVpcmUoJ3BhdGgnKSUzQiUwQWZ1bmN0aW9uJTIwemlwRm9sZGVyKHNvdXJjZUZvbGRlciUyQyUyMGRlc3RaaXAlMkMlMjBzdWJkaXIpJTIwJTdCJTBBJTIwJTIwJTIwJTIwJTJGJTJGJTIwaW5pdCUwQSUyMCUyMCUyMCUyMHZhciUyMG91dHB1dCUyMCUzRCUyMGZzLmNyZWF0ZVdyaXRlU3RyZWFtKGRlc3RaaXApJTNCJTBBJTIwJTIwJTIwJTIwdmFyJTIwYXJjaGl2ZSUyMCUzRCUyMGFyY2hpdmVyKCd6aXAnJTJDJTIwJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwemxpYiUzQSUyMCU3QiUyMGxldmVsJTNBJTIwOSUyMCU3RCUwQSUyMCUyMCUyMCUyMCU3RCklM0IlMEElMEElMjAlMjAlMjAlMjAlMkYlMkYlMjBvbiUwQSUyMCUyMCUyMCUyMG91dHB1dC5vbignY2xvc2UnJTJDJTIwZnVuY3Rpb24lMjAoKSUyMCU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGZzLnN0YXQoJTIyc2l0ZS56aXAlMjIlMkMlMjBmdW5jdGlvbiUyMChlcnJvciUyQyUyMHN0YXRzKSUyMCU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGFkZExvZyglMjIlRTclQkQlOTElRTclQUIlOTklRTYlOTYlODclRTQlQkIlQjYlRTUlOEUlOEIlRTclQkMlQTklRTUlQUUlOEMlRTYlQUYlOTUlRUYlQkMlOEMlRTUlOEUlOEIlRTclQkMlQTklRTYlOTYlODclRTQlQkIlQjYlRTUlQTQlQTclRTUlQjAlOEYlRUYlQkMlOUElMjIlMkJzdGF0cy5zaXplJTJGMTAyNCUyRjEwMjQlMkInTUInKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHVwTG9hZFNpdGUoKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCklMEElMjAlMjAlMjAlMjAlN0QpJTNCJTBBJTIwJTIwJTIwJTIwYXJjaGl2ZS5vbignZXJyb3InJTJDJTIwZnVuY3Rpb24lMjAoZXJyKSUyMCU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGFkZExvZyglMjIlRTclQkQlOTElRTclQUIlOTklRTYlOTYlODclRTQlQkIlQjYlRTUlOEUlOEIlRTclQkMlQTklRTUlQTQlQjElRTglQjQlQTUlRUYlQkMlOUElMjIlMkJlcnIpJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwdG9FbmQoKSUzQiUwQSUyMCUyMCUyMCUyMCU3RCklM0IlMEElMEElMjAlMjAlMjAlMjAlMkYlMkYlMjB6aXAlMEElMjAlMjAlMjAlMjBhcmNoaXZlLnBpcGUob3V0cHV0KSUzQiUwQSUyMCUyMCUyMCUyMGFyY2hpdmUuZGlyZWN0b3J5KHNvdXJjZUZvbGRlciUyQyUyMHN1YmRpciUyMCUzRiUyMHNvdXJjZUZvbGRlci5zdWJzdHIocGF0aC5kaXJuYW1lKHNvdXJjZUZvbGRlcikubGVuZ3RoJTIwJTJCJTIwMSklMjAlM0ElMjBmYWxzZSklM0IlMEElMjAlMjAlMjAlMjBhcmNoaXZlLmZpbmFsaXplKCklM0IlMEElN0QlMEElMEFhZGRMb2coJTIyJUU1JUE0JTg3JUU0JUJCJUJEJUU0JUJCJUJCJUU1JThBJUExJUU1JUJDJTgwJUU1JUE3JThCJUU2JTg5JUE3JUU4JUExJThDJTIyKSUzQiUwQWFkZExvZyglMjIlRTYlQUQlQTMlRTUlOUMlQTglRTUlQUYlQkMlRTUlODclQkElRTYlOTUlQjAlRTYlOEQlQUUlRTUlQkElOTMlMjIpJTNCJTBBY29uc3QlMjBjaGlsZFByb2Nlc3MlM0RyZXF1aXJlKCdjaGlsZF9wcm9jZXNzJyklM0IlMEFsZXQlMjBjbWQlM0QlMjJteXNxbGR1bXAlMjAtdXJvb3QlMjAtcCUyMiUyQkRCcHdkJTJCJTIyJTIwJTIyJTJCREJuYW1lJTJCJTIyJTNFJTIyJTJCc2l0ZVBhdGglMkIlMjIlNUMlNUNkYXRhYmFzZS5zcWwlMjIlM0IlMEFhZGRMb2coJTIyJUU2JTg5JUE3JUU4JUExJThDJUU1JTkxJUJEJUU0JUJCJUE0JUVGJUJDJTlBJTIyJTJCY21kKSUzQiUwQWNoaWxkUHJvY2Vzcy5leGVjKGNtZCUyQyhlcnJvciUyQyUyMHN0ZG91dCUyQyUyMHN0ZGVyciklM0QlM0UlN0IlMEElMjAlMjAlMjAlMjBmcy5zdGF0KHNpdGVQYXRoJTJCJTIyJTVDJTVDZGF0YWJhc2Uuc3FsJTIyJTJDJTIwZnVuY3Rpb24lMjAoZXJyb3IlMkMlMjBzdGF0cyklMjAlN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBhZGRMb2coJTIyJUU2JTk1JUIwJUU2JThEJUFFJUU1JUJBJTkzJUU1JUE0JUE3JUU1JUIwJThGJUVGJUJDJTlBJTIyJTJCc3RhdHMuc2l6ZSUyRjEwMjQlMkInS0InKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGFkZExvZyglMjIlRTYlQUQlQTMlRTUlOUMlQTglRTYlODklOTMlRTUlOEMlODUlRTclQUIlOTklRTclODIlQjklRTYlOTUlQjAlRTYlOEQlQUUlMjIpJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwemlwRm9sZGVyKHNpdGVQYXRoJTJDJTIyc2l0ZS56aXAlMjIlMkN0cnVlKSUzQiUwQSUyMCUyMCUyMCUyMCU3RCklMEElN0QpJTNCJTBBJTBBdmFyJTIwcWluaXUlMjAlMjAlMjAlMjAlMjAlMjAlM0QlMjByZXF1aXJlKCdxaW5pdScpJTNCJTBBZnVuY3Rpb24lMjB1cExvYWRTaXRlKCklN0IlMEElMjAlMjAlMjAlMjBhZGRMb2coJTIyJUU1JTg3JTg2JUU1JUE0JTg3JUU0JUI4JThBJUU0JUJDJUEwJTIyKSUzQiUwQSUyMCUyMCUyMCUyMHZhciUyMG1hYyUyMCUzRCUyMG5ldyUyMHFpbml1LmF1dGguZGlnZXN0Lk1hYyhhY2Nlc3NLZXklMkMlMjBzZWNyZXRLZXkpJTNCJTBBJTIwJTIwJTIwJTIwdmFyJTIwb3B0aW9ucyUyMCUzRCUyMCU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHNjb3BlJTNBJTIwYnVja2V0JTJCJTIyJTNBc2l0ZS56aXAlMjIlMkMlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBleHBpcmVzJTNBJTIwMTgwMDAlMEElMjAlMjAlMjAlMjAlN0QlM0IlMEElMjAlMjAlMjAlMjB2YXIlMjBwdXRQb2xpY3klMjAlM0QlMjBuZXclMjBxaW5pdS5ycy5QdXRQb2xpY3kob3B0aW9ucyklM0IlMEElMjAlMjAlMjAlMjB2YXIlMjB1cGxvYWRUb2tlbiUzRHB1dFBvbGljeS51cGxvYWRUb2tlbihtYWMpJTNCJTBBJTIwJTIwJTIwJTIwdmFyJTIwY29uZmlnJTIwJTNEJTIwbmV3JTIwcWluaXUuY29uZi5Db25maWcoKSUzQiUwQSUyMCUyMCUyMCUyMHZhciUyMGZvcm1VcGxvYWRlciUyMCUzRCUyMG5ldyUyMHFpbml1LmZvcm1fdXAuRm9ybVVwbG9hZGVyKGNvbmZpZyklM0IlMEElMjAlMjAlMjAlMjB2YXIlMjBwdXRFeHRyYSUyMCUzRCUyMG5ldyUyMHFpbml1LmZvcm1fdXAuUHV0RXh0cmEoKSUzQiUwQSUyMCUyMCUyMCUyMGFkZExvZyglMjIlRTUlQkMlODAlRTUlQTclOEIlRTQlQjglOEElRTQlQkMlQTAlMjIpJTNCJTBBJTBBJTIwJTIwJTIwJTIwJTJGJTJGdG9FbmQoKSUzQiUwQSUyMCUyMCUyMCUyMCUyRiUyRnJldHVybiUzQiUwQSUyMCUyMCUyMCUyMGZvcm1VcGxvYWRlci5wdXRGaWxlKHVwbG9hZFRva2VuJTJDJTIwJ3NpdGUuemlwJyUyQyUyMCdzaXRlLnppcCclMkMlMjBwdXRFeHRyYSUyQyUyMGZ1bmN0aW9uJTIwKHJlc3BFcnIlMkMlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjByZXNwQm9keSUyQyUyMHJlc3BJbmZvKSUyMCU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmJTIwKHJlc3BFcnIpJTIwJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwYWRkTG9nKCUyMiVFOSU4MSU4NyVFNSU4OCVCMCVFNiU5QyVBQSVFNyU5RiVBNSVFOSU5NCU5OSVFOCVBRiVBRiUyMiklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjB0b0VuZCgpJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYlMjAocmVzcEluZm8uc3RhdHVzQ29kZSUyMCUzRCUzRCUyMDIwMCklMjAlN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBhZGRMb2coJTIyJUU0JUI4JThBJUU0JUJDJUEwJUU1JUFFJThDJUU2JTg4JTkwJUVGJUJDJTgxJTIyKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHRvRW5kKCklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0RlbHNlJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwYWRkTG9nKCUyMiVFOSU4MSU4NyVFNSU4OCVCMCVFNiU5QyVBQSVFNyU5RiVBNSVFOSU5NCU5OSVFOCVBRiVBRiUyMiUyQnJlc3BJbmZvLnN0YXR1c0NvZGUpJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwdG9FbmQoKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMCU3RCklM0IlMEElMEElN0QlMEElMEFjb25zdCUyMG5vZGVtYWlsZXIlMjAlM0QlMjByZXF1aXJlKCdub2RlbWFpbGVyJyklM0IlMEFmdW5jdGlvbiUyMHRvRW5kKCklN0IlMEElMjAlMjAlMjAlMjBsZXQlMjB0cmFuc3BvcnRlciUyMCUzRCUyMG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KCU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGhvc3QlM0ElMjBtYWlsSG9zdCUyQyUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHBvcnQlM0ElMjBtYWlsUG9ydCUyQyUyMCUyRiUyRiUyMFNNVFAlMjAlRTclQUIlQUYlRTUlOEYlQTMlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBhdXRoJTNBJTIwJTdCJTIwJTIwJTIwJTJGJTJGJUU1JThGJTkxJUU5JTgwJTgxJUU4JTgwJTg1JUU3JTlBJTg0JUU4JUI0JUE2JUU2JTg4JUI3JUU1JTkyJThDJUU2JThFJTg4JUU2JTlEJTgzJUU3JUEwJTgxJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwdXNlciUzQSUyMG1haWxVc2VyJTJDJTIwJTJGJTJGJUU4JUI0JUE2JUU2JTg4JUI3JTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwcGFzcyUzQSUyMG1haWxQd2QlMkMlMjAlMkYlMkZzbXRwJUU2JThFJTg4JUU2JTlEJTgzJUU3JUEwJTgxJUVGJUJDJThDJUU1JTg4JUIwJUU5JTgyJUFFJUU3JUFFJUIxJUU4JUFFJUJFJUU3JUJEJUFFJUU0JUI4JThCJUU4JThFJUI3JUU1JThGJTk2JTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwJTdEKSUzQiUwQSUyMCUyMCUyMCUyMGxldCUyMG1haWxPcHRpb25zJTIwJTNEJTIwJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZnJvbSUzQSUyMCclMjJHY3RlYW1vJTIyJTIwJTNDYWRtaW4lNDBnY3RlYW1vLmNvbSUzRSclMkMlMjAlMkYlMkYlMjAlRTUlOEYlOTElRTklODAlODElRTglODAlODUlRTYlOTglQjUlRTclQTclQjAlRTUlOTIlOEMlRTUlOUMlQjAlRTUlOUQlODAlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjB0byUzQSUyMG1haWxUbyUyQyUyMCUyRiUyRiUyMCVFNiU4RSVBNSVFNiU5NCVCNiVFOCU4MCU4NSVFNyU5QSU4NCVFOSU4MiVBRSVFNyVBRSVCMSVFNSU5QyVCMCVFNSU5RCU4MCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHN1YmplY3QlM0ElMjAnJUU1JUE0JTg3JUU0JUJCJUJEJUU0JUJCJUJCJUU1JThBJUExJUU2JTg5JUE3JUU4JUExJThDJUU2JThBJUE1JUU1JTkxJThBJyUyQyUyMCUyRiUyRiUyMCVFOSU4MiVBRSVFNCVCQiVCNiVFNCVCOCVCQiVFOSVBMiU5OCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGh0bWwlM0ElMjAlMjIlM0NodG1sJTNFJTNDYm9keSUzRSVFNyVCRCU5MSVFNyVBQiU5OSVFNSVBNCU4NyVFNCVCQiVCRCVFNCVCQiVCQiVFNSU4QSVBMSVFNiU4OSVBNyVFOCVBMSU4QyVFNSVBRSU4QyVFNiVBRiU5NSVFRiVCQyU4QyVFNCVCOCU4QiVFOSU5RCVBMiVFNCVCOCVCQSVFNiU4OSVBNyVFOCVBMSU4QyVFNiU5NyVBNSVFNSVCRiU5NyUzQ2JyJTNFJTNDYnIlM0UlMjIlMkJsb2clMkIlMjIlM0MlMkZib2R5JTNFJTNDJTJGaHRtbCUzRSUyMiUwQSUyMCUyMCUyMCUyMCU3RCUzQiUwQSUyMCUyMCUyMCUyMCUyRiUyRiVFNSU4RiU5MSVFOSU4MCU4MSVFOSU4MiVBRSVFNCVCQiVCNiUwQSUyMCUyMCUyMCUyMHRyYW5zcG9ydGVyLnNlbmRNYWlsKG1haWxPcHRpb25zJTJDJTIwKGVycm9yJTJDJTIwaW5mbyklMjAlM0QlM0UlMjAlN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZiUyMChlcnJvciklMjAlN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjByZXR1cm4lMjBjb25zb2xlLmxvZyhlcnJvciklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBjb25zb2xlLmxvZygnJUU5JTgyJUFFJUU0JUJCJUI2JUU1JThGJTkxJUU5JTgwJTgxJUU2JTg4JTkwJUU1JThBJTlGJTIwSUQlRUYlQkMlOUEnJTJDJTIwaW5mby5tZXNzYWdlSWQpJTNCJTBBJTIwJTIwJTIwJTIwJTdEKSUzQiUwQSUyMCUyMCUyMCUyMCUyRiUyRmNvbnNvbGUubG9nKGxvZyklM0IlMEElN0QlMEElMkYlMkZ2YXIlMjBtYWMlMjAlM0QlMjBuZXclMjBxaW5pdS5hdXRoLmRpZ2VzdC5NYWMoYWNjZXNzS2V5JTJDJTIwc2VjcmV0S2V5KSUzQiUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div><div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div><div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div><div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div><div>111</div><div>112</div><div>113</div><div>114</div><div>115</div><div>116</div><div>117</div><div>118</div><div>119</div><div>120</div><div>121</div><div>122</div></div><div class="code"><span class="hljs-keyword">var</span> accessKey = <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">var</span> secretKey = <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">var</span> bucket=<span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">var</span> sitePath=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> <span class="hljs-title class_">DBname</span>=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> <span class="hljs-title class_">DBpwd</span>=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> mailHost=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> mailPort=;
<span class="hljs-keyword">var</span> mailUser=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> mailPwd=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> mailTo=<span class="hljs-string">&quot;&quot;</span>;

<span class="hljs-keyword">var</span> log=<span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">const</span> sd = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;silly-datetime&#x27;</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addLog</span>(<span class="hljs-params">str</span>){
    <span class="hljs-keyword">const</span> time=sd.<span class="hljs-title function_">format</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-string">&#x27;YYYY-MM-DD HH:mm&#x27;</span>);
    log+=<span class="hljs-string">&#x27;[&#x27;</span>+time+<span class="hljs-string">&quot;]&quot;</span>+str+<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;[&#x27;</span>+time+<span class="hljs-string">&quot;]&quot;</span>+str+<span class="hljs-string">&#x27;\n&#x27;</span>);
}

<span class="hljs-keyword">var</span> fs      = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);
<span class="hljs-keyword">var</span> path    = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">var</span> archiver  = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;archiver&#x27;</span>);
<span class="hljs-keyword">const</span> { toNamespacedPath } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">zipFolder</span>(<span class="hljs-params">sourceFolder, destZip, subdir</span>) {
    <span class="hljs-comment">// init</span>
    <span class="hljs-keyword">var</span> output = fs.<span class="hljs-title function_">createWriteStream</span>(destZip);
    <span class="hljs-keyword">var</span> archive = <span class="hljs-title function_">archiver</span>(<span class="hljs-string">&#x27;zip&#x27;</span>, {
        <span class="hljs-attr">zlib</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">9</span> }
    });

    <span class="hljs-comment">// on</span>
    output.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;close&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        fs.<span class="hljs-title function_">stat</span>(<span class="hljs-string">&quot;site.zip&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, stats</span>) {
            <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;网站文件压缩完毕，压缩文件大小：&quot;</span>+stats.<span class="hljs-property">size</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>+<span class="hljs-string">&#x27;MB&#x27;</span>);
            <span class="hljs-title function_">upLoadSite</span>();
        })
    });
    archive.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
        <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;网站文件压缩失败：&quot;</span>+err);
        <span class="hljs-title function_">toEnd</span>();
    });

    <span class="hljs-comment">// zip</span>
    archive.<span class="hljs-title function_">pipe</span>(output);
    archive.<span class="hljs-title function_">directory</span>(sourceFolder, subdir ? sourceFolder.<span class="hljs-title function_">substr</span>(path.<span class="hljs-title function_">dirname</span>(sourceFolder).<span class="hljs-property">length</span> + <span class="hljs-number">1</span>) : <span class="hljs-literal">false</span>);
    archive.<span class="hljs-title function_">finalize</span>();
}

<span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;备份任务开始执行&quot;</span>);
<span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;正在导出数据库&quot;</span>);
<span class="hljs-keyword">const</span> childProcess=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>);
<span class="hljs-keyword">let</span> cmd=<span class="hljs-string">&quot;mysqldump -uroot -p&quot;</span>+<span class="hljs-title class_">DBpwd</span>+<span class="hljs-string">&quot; &quot;</span>+<span class="hljs-title class_">DBname</span>+<span class="hljs-string">&quot;&gt;&quot;</span>+sitePath+<span class="hljs-string">&quot;\\database.sql&quot;</span>;
<span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;执行命令：&quot;</span>+cmd);
childProcess.<span class="hljs-title function_">exec</span>(cmd,<span class="hljs-function">(<span class="hljs-params">error, stdout, stderr</span>)=&gt;</span>{
    fs.<span class="hljs-title function_">stat</span>(sitePath+<span class="hljs-string">&quot;\\database.sql&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, stats</span>) {
        <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;数据库大小：&quot;</span>+stats.<span class="hljs-property">size</span>/<span class="hljs-number">1024</span>+<span class="hljs-string">&#x27;KB&#x27;</span>);
        <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;正在打包站点数据&quot;</span>);
        <span class="hljs-title function_">zipFolder</span>(sitePath,<span class="hljs-string">&quot;site.zip&quot;</span>,<span class="hljs-literal">true</span>);
    })
});

<span class="hljs-keyword">var</span> qiniu      = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;qiniu&#x27;</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">upLoadSite</span>(<span class="hljs-params"></span>){
    <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;准备上传&quot;</span>);
    <span class="hljs-keyword">var</span> mac = <span class="hljs-keyword">new</span> qiniu.<span class="hljs-property">auth</span>.<span class="hljs-property">digest</span>.<span class="hljs-title class_">Mac</span>(accessKey, secretKey);
    <span class="hljs-keyword">var</span> options = {
        <span class="hljs-attr">scope</span>: bucket+<span class="hljs-string">&quot;:site.zip&quot;</span>,
        <span class="hljs-attr">expires</span>: <span class="hljs-number">18000</span>
    };
    <span class="hljs-keyword">var</span> putPolicy = <span class="hljs-keyword">new</span> qiniu.<span class="hljs-property">rs</span>.<span class="hljs-title class_">PutPolicy</span>(options);
    <span class="hljs-keyword">var</span> uploadToken=putPolicy.<span class="hljs-title function_">uploadToken</span>(mac);
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> qiniu.<span class="hljs-property">conf</span>.<span class="hljs-title class_">Config</span>();
    <span class="hljs-keyword">var</span> formUploader = <span class="hljs-keyword">new</span> qiniu.<span class="hljs-property">form_up</span>.<span class="hljs-title class_">FormUploader</span>(config);
    <span class="hljs-keyword">var</span> putExtra = <span class="hljs-keyword">new</span> qiniu.<span class="hljs-property">form_up</span>.<span class="hljs-title class_">PutExtra</span>();
    <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;开始上传&quot;</span>);

    <span class="hljs-comment">//toEnd();</span>
    <span class="hljs-comment">//return;</span>
    formUploader.<span class="hljs-title function_">putFile</span>(uploadToken, <span class="hljs-string">&#x27;site.zip&#x27;</span>, <span class="hljs-string">&#x27;site.zip&#x27;</span>, putExtra, <span class="hljs-keyword">function</span> (<span class="hljs-params">respErr,
        respBody, respInfo</span>) {
        <span class="hljs-keyword">if</span> (respErr) {
            <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;遇到未知错误&quot;</span>);
            <span class="hljs-title function_">toEnd</span>();
        }
        <span class="hljs-keyword">if</span> (respInfo.<span class="hljs-property">statusCode</span> == <span class="hljs-number">200</span>) {
            <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;上传完成！&quot;</span>);
            <span class="hljs-title function_">toEnd</span>();
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-title function_">addLog</span>(<span class="hljs-string">&quot;遇到未知错误&quot;</span>+respInfo.<span class="hljs-property">statusCode</span>);
            <span class="hljs-title function_">toEnd</span>();
        }
    });

}

<span class="hljs-keyword">const</span> nodemailer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;nodemailer&#x27;</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toEnd</span>(<span class="hljs-params"></span>){
    <span class="hljs-keyword">let</span> transporter = nodemailer.<span class="hljs-title function_">createTransport</span>({
        <span class="hljs-attr">host</span>: mailHost,
        <span class="hljs-attr">port</span>: mailPort, <span class="hljs-comment">// SMTP 端口</span>
        <span class="hljs-attr">auth</span>: {   <span class="hljs-comment">//发送者的账户和授权码</span>
            <span class="hljs-attr">user</span>: mailUser, <span class="hljs-comment">//账户</span>
            <span class="hljs-attr">pass</span>: mailPwd, <span class="hljs-comment">//smtp授权码，到邮箱设置下获取</span>
        }
    });
    <span class="hljs-keyword">let</span> mailOptions = {
        <span class="hljs-attr">from</span>: <span class="hljs-string">&#x27;&quot;Gcteamo&quot; &lt;admin@gcteamo.com&gt;&#x27;</span>, <span class="hljs-comment">// 发送者昵称和地址</span>
        <span class="hljs-attr">to</span>: mailTo, <span class="hljs-comment">// 接收者的邮箱地址</span>
        <span class="hljs-attr">subject</span>: <span class="hljs-string">&#x27;备份任务执行报告&#x27;</span>, <span class="hljs-comment">// 邮件主题</span>
        <span class="hljs-attr">html</span>: <span class="hljs-string">&quot;&lt;html&gt;&lt;body&gt;网站备份任务执行完毕，下面为执行日志&lt;br&gt;&lt;br&gt;&quot;</span>+log+<span class="hljs-string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>
    };
    <span class="hljs-comment">//发送邮件</span>
    transporter.<span class="hljs-title function_">sendMail</span>(mailOptions, <span class="hljs-function">(<span class="hljs-params">error, info</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (error) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
        }
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;邮件发送成功 ID：&#x27;</span>, info.<span class="hljs-property">messageId</span>);
    });
    <span class="hljs-comment">//console.log(log);</span>
}
<span class="hljs-comment">//var mac = new qiniu.auth.digest.Mac(accessKey, secretKey);</span>
</div></code></pre>
<h2 id="pei-zhi-yu-shi-yong" tabindex="-1">配置与使用</h2>
<h3 id="xia-zai" tabindex="-1">下载</h3>
<p>你可以直接下载已经把所有依赖的模块安装好的脚本，下载链接：<br>
<a href="https://www.aliyundrive.com/s/QqAsBAGfXgv">https://www.aliyundrive.com/s/QqAsBAGfXgv</a>
（由于特殊原因，下载到的文件是图片，你需要把后缀改成.rar，然后将其视为正常的压缩文件解压）</p>
<h3 id="pei-zhi" tabindex="-1">配置</h3>
<p>打开解压后文件夹中的 <code>main.js</code> 文件，填写前11行信息，变量名与说明如下：</p>
<ol>
<li>accessKey：你的七牛云公钥</li>
<li>secretKey：你的七牛云私钥</li>
<li>bucket：你要上传到的七牛云储存的空间名称</li>
<li>sitePath：你网站的目录，注意目录的最后不要带 <code>\\</code></li>
<li>DBname：你要备份的数据库的名称</li>
<li>DBpwd：mysql数据库root的密码</li>
<li>mailHost：发件邮箱的SMTP服务器地址</li>
<li>mailPor：SMTP服务器的端口</li>
<li>mailUser：发件邮箱地址</li>
<li>mailPwd：发件邮箱密码</li>
<li>mailTo：要通知的邮箱地址</li>
</ol>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220812180646.png" style="transform: scale(1)" width=624 height=358><div class="img-title">填写完毕后大概长这样</div></div></p>
<h3 id="she-zhi-ding-shi-ren-wu" tabindex="-1">设置定时任务</h3>
<p>你的服务器需要安装node.js才能运行脚本。你可以在命令行中输入 <code>node -v</code> 如果出现类似于下面的输出信息，说明你正常安装了node.js</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220812183337.png" style="transform: scale(1)" width=238 height=49></div></p>
<p>将脚本文件打包上传到服务器后，进入 控制面板/管理工具/计划任务。</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220811143225.png" style="transform: scale(1)" width=625 height=89></div></p>
<p>在右边选择 创建任务</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220811143249.png" style="transform: scale(1)" width=396 height=369></div></p>
<p>在最下面勾选这个</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220811143614.png" style="transform: scale(1)" width=588 height=129></div></p>
<p>设置触发器，在里面填写好任务执行频率</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220811143549.png" style="transform: scale(1)" width=643 height=555></div></p>
<p>设置操作，按照下面填写<br>
（添加参数中填写脚本的路径）</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220811143627.png" style="transform: scale(1)" width=507 height=407></div></p>
<p>成功添加</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220811144222.png" style="transform: scale(1)" width=833 height=166></div></p>
<p>点击旁边的运行，测试一下</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220812184133.png" style="transform: scale(1)" width=252 height=106></div></p>
<p>如果一切顺利，就可以在大约5分钟后收到任务执行成功的通知邮件</p>
<p><div class="img-box"><img class="lazy" date-src="https://www.caiwen.work/wp-content/uploads/2022/08/QQ%E6%88%AA%E5%9B%BE20220812184332.png" style="transform: scale(1)" width=765 height=405></div></p>
