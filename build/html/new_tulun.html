<h2 id="ou-la-lu" tabindex="-1">欧拉路</h2>
<p><strong>欧拉路</strong> 一口气经过所有的点和边，且所有的边只经过一次</p>
<p><strong>欧拉回路</strong> 能形成回路的欧拉路</p>
<h3 id="pan-ding" tabindex="-1">判定</h3>
<h4 id="wu-xiang-tu" tabindex="-1">无向图</h4>
<ul>
<li>当且仅当无向图中所有点的度数均为偶数时才有欧拉回路</li>
<li>当且仅当无向图中有欧拉回路，或者有且仅有两个度数为奇数的点时才有欧拉路。对于后者，度数为奇数的点时起点或者终点</li>
<li>需注意图是否联通</li>
</ul>
<h4 id="you-xiang-tu" tabindex="-1">有向图</h4>
<p>如果我们令一个点的出度记为 1，入度记为 -1，这个点所有的出度和入度相加，就是它的度数</p>
<ul>
<li>当且仅当有向图中所有的点度数为 0 时才有欧拉回路</li>
<li>当且仅当有向图中有欧拉回路，或者有且仅有一个度数为 1 的点和一个度数为 -1 的点，其他所有的点度数均为 0。对于后者，度数为 1 的是起点，度数为 -1 的是终点</li>
<li>需注意图是否联通</li>
</ul>
<h3 id="da-yin-fang-an" tabindex="-1">打印方案</h3>
<h4 id="di-gui-bian-li" tabindex="-1">递归遍历</h4>
<p>直接 dfs 整个图，注意所有的边只能走一次，然后<strong>在回溯时</strong>打印答案。有向图和无向图都一样</p>
<p><strong>例题</strong> <a href="https://vjudge.net/problem/UVA-10054">UVA10054</a> 无向图求欧拉回路，打印方案</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBaW50JTIwZCU1QjU1JTVEJTJDZyU1QjU1JTVEJTVCNTUlNUQlM0IlMEF2b2lkJTIwZGZzKGludCUyMHUpJTdCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMHYlM0QxJTNCdiUzQyUzRDUwJTNCdiUyQiUyQiklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihnJTVCdSU1RCU1QnYlNUQpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZyU1QnUlNUQlNUJ2JTVELS0lMkNnJTVCdiU1RCU1QnUlNUQtLSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGRmcyh2KSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNvdXQlM0MlM0N2JTNDJTNDJTIyJTIwJTIyJTNDJTNDdSUzQyUzQ2VuZGwlM0IlMjAlMkYlMkYlMjAlRTUlOUIlOUUlRTYlQkElQUYlRTclOUElODQlRTYlOTclQjYlRTUlODAlOTklMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlN0QlMEElN0QlMEFpbmxpbmUlMjB2b2lkJTIwc3VidGFzaygpJTdCJTBBJTIwJTIwJTIwJTIwaW50JTIwbiUzQmNpbiUzRSUzRW4lM0IlMEElMjAlMjAlMjAlMjB3aGlsZShuLS0pJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwdSUyQ3YlM0JjaW4lM0UlM0V1JTNFJTNFdiUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGQlNUJ1JTVEJTJCJTJCJTJDZCU1QnYlNUQlMkIlMkIlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBnJTVCdSU1RCU1QnYlNUQlMkIlMkIlMkNnJTVCdiU1RCU1QnUlNUQlMkIlMkIlM0IlMEElMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNENTAlM0JpJTJCJTJCKSUyMGlmKGQlNUJpJTVEJTI1MiklMjByZXR1cm4lMjBjb3V0JTNDJTNDJTIyc29tZSUyMGJlYWRzJTIwbWF5JTIwYmUlMjBsb3N0JTIyJTNDJTNDZW5kbCUyQ3ZvaWQoKSUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0Q1MCUzQmklMkIlMkIpJTIwaWYoZCU1QmklNUQpJTIwcmV0dXJuJTIwZGZzKGkpJTJDdm9pZCgpJTNCJTBBJTdEJTBBc2lnbmVkJTIwbWFpbigpJTdCJTBBJTIwJTIwJTIwJTIwaW9zJTNBJTNBc3luY193aXRoX3N0ZGlvKGZhbHNlKSUzQiUwQSUyMCUyMCUyMCUyMGludCUyMHQlM0JjaW4lM0UlM0V0JTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRHQlM0JpJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNvdXQlM0MlM0MlMjJDYXNlJTIwJTIzJTIyJTNDJTNDaSUzQyUzQ2VuZGwlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBzdWJ0YXNrKCklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBtZW1zZXQoZCUyQzAlMkNzaXplb2YoZCkpJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwbWVtc2V0KGclMkMwJTJDc2l6ZW9mKGcpKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNvdXQlM0MlM0NlbmRsJTNCJTBBJTIwJTIwJTIwJTIwJTdEJTBBJTIwJTIwJTIwJTIwcmV0dXJuJTIwMCUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-type">int</span> d[<span class="hljs-number">55</span>],g[<span class="hljs-number">55</span>][<span class="hljs-number">55</span>];
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>{
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> v=<span class="hljs-number">1</span>;v&lt;=<span class="hljs-number">50</span>;v++){
        <span class="hljs-keyword">if</span>(g[u][v]){
            g[u][v]--,g[v][u]--;
            <span class="hljs-built_in">dfs</span>(v);
            cout&lt;&lt;v&lt;&lt;<span class="hljs-string">&quot; &quot;</span>&lt;&lt;u&lt;&lt;endl; <span class="hljs-comment">// 回溯的时候</span>
        }
    }
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    <span class="hljs-type">int</span> n;cin&gt;&gt;n;
    <span class="hljs-keyword">while</span>(n--){
        <span class="hljs-type">int</span> u,v;cin&gt;&gt;u&gt;&gt;v;
        d[u]++,d[v]++;
        g[u][v]++,g[v][u]++;
    }
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">50</span>;i++) <span class="hljs-keyword">if</span>(d[i]%<span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> cout&lt;&lt;<span class="hljs-string">&quot;some beads may be lost&quot;</span>&lt;&lt;endl,<span class="hljs-built_in">void</span>();
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">50</span>;i++) <span class="hljs-keyword">if</span>(d[i]) <span class="hljs-keyword">return</span> <span class="hljs-built_in">dfs</span>(i),<span class="hljs-built_in">void</span>();
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t;cin&gt;&gt;t;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=t;i++){
        cout&lt;&lt;<span class="hljs-string">&quot;Case #&quot;</span>&lt;&lt;i&lt;&lt;endl;
        <span class="hljs-built_in">subtask</span>();
        <span class="hljs-built_in">memset</span>(d,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(d));
        <span class="hljs-built_in">memset</span>(g,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(g));
        cout&lt;&lt;endl;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h4 id="mo-ni-zhan" tabindex="-1">模拟栈</h4>
<p>如果递归深度过大的话，有可能会爆栈。此时我们考虑模拟递归时的栈来解决。基本思想是先从一个点一直往下dfs，dfs不动了，就把最后一个数字计入答案，然后再从第二个数字开始一直往下dfs</p>
<p><strong>例题</strong> <a href="https://vjudge.net/problem/POJ-1780">POJ1780</a> 有向图求欧拉路，打印方案，按字典序</p>
<p>题目大概意思是给定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 然后让我们生成一个字符串，使得字符串从头开始每看 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个数都是互不相同的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 位数字，且覆盖所有的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 位数字（含前导 0）</p>
<p>我们考虑现在已经有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 位数字，然后填入下一位数字，此时就构成了一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 位数字，但同时后面的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 位数字又变成了新的”状态“，等待填入下一位数字</p>
<p>因此我们可以把所有的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 位数字视为一个状态，通过连有向边，即填数，来转移到另一个状态。每个状态向外连边只能经过一次，且需要把所有的边都走一遍，于是就转化为了欧拉路问题</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2lvc3RyZWFtJTNFJTBBJTIzaW5jbHVkZSUzQ2FsZ29yaXRobSUzRSUwQSUyM2luY2x1ZGUlM0NzdGFjayUzRSUwQXVzaW5nJTIwbmFtZXNwYWNlJTIwc3RkJTNCJTBBJTIzaW5jbHVkZSUyMCUzQ2Nhc3NlcnQlM0UlMEElMEFpbnQlMjBueHQlNUIxMDAwMDA2JTVEJTJDbiUyQ2NudCUzQiUwQXN0YWNrJTNDaW50JTNFJTIwcyUyQ2FucyUzQiUwQXZvaWQlMjBkZnMoaW50JTIweCklN0IlMkYlMkYlMjAlRTQlQjglODAlRTclOUIlQjQlRTglQjUlQjAlRTQlQjglOEIlRTUlOEUlQkIlMEElMDl3aGlsZShueHQlNUJ4JTVEJTNDMTApJTdCJTBBJTA5JTA5aW50JTIwdG8lM0QoeCoxMCUyQm54dCU1QnglNUQpJTI1Y250JTNCJTBBJTA5JTA5cy5wdXNoKHRvKSUzQiUwQSUwOSUwOW54dCU1QnglNUQlMkIlMkIlM0IlMEElMDklMDl4JTNEdG8lM0IlMEElMDklN0QlMEElN0QlMEElMEFpbnQlMjBtYWluKCklN0IlMEElMDlpb3MlM0ElM0FzeW5jX3dpdGhfc3RkaW8oZmFsc2UpJTNCJTBBJTA5d2hpbGUoY2luJTNFJTNFbiUyMCUyNiUyNiUyMG4pJTdCJTBBJTA5JTA5aWYoIW4pJTIwYnJlYWslM0IlMEElMDklMDlpZihuJTNEJTNEMSklN0IlMEElMDklMDklMDljb3V0JTNDJTNDJTIyMDEyMzQ1Njc4OSUyMiUzQyUzQ2VuZGwlM0IlMEElMDklMDklMDljb250aW51ZSUzQiUwQSUwOSUwOSU3RCUwQSUwOSUwOWNudCUzRDElM0IlMEElMDklMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbi0xJTNCaSUyQiUyQiklMjBjbnQqJTNEMTAlM0IlMEElMDklMDlmb3IoaW50JTIwaSUzRDAlM0JpJTNDY250JTNCaSUyQiUyQiklMjBueHQlNUJpJTVEJTNEMCUzQiUwQSUwOSUwOWZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RuLTElM0JpJTJCJTJCKSUyMGNvdXQlM0MlM0MwJTNCJTBBJTA5JTA5ZGZzKDApJTNCJTBBJTA5JTA5d2hpbGUoIXMuZW1wdHkoKSklN0IlMkYlMkYlMjAlRTglQjUlQjAlRTQlQjglOEQlRTUlOEElQTglRTQlQkElODYlRUYlQkMlOEMlRTglQUYlQjQlRTYlOTglOEUlRTglQUYlQTUlRTUlOUIlOUUlRTYlQkElQUYlRTUlODglQjAlRTQlQjglOEElRTQlQjglODAlRTQlQjglQUElRTclODIlQjklRUYlQkMlOEMlRTclODQlQjYlRTUlOTAlOEUlRTUlODYlOEQlRTUlOTAlOTElRTUlOEYlQTYlRTQlQjglODAlRTQlQjglQUElRTYlOTYlQjklRTUlOTAlOTElRTQlQjglODAlRTclOUIlQjQlRTglQjUlQjAlMEElMDklMDklMDlhbnMucHVzaChzLnRvcCgpJTI1MTApJTNCcy5wb3AoKSUzQiUwQSUwOSUwOSUwOWlmKCFzLmVtcHR5KCkpJTIwZGZzKHMudG9wKCkpJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTA5aW50JTIwdG90JTNEbi0xJTNCJTBBJTA5JTA5d2hpbGUoIWFucy5lbXB0eSgpKSUyMGNvdXQlM0MlM0NhbnMudG9wKCklMkNhbnMucG9wKCklMkN0b3QlMkIlMkIlM0IlMEElMDklMDljb3V0JTNDJTNDZW5kbCUzQiUwQSUwOSU3RCUwQSUwOXJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stack&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cassert&gt;</span></span>

<span class="hljs-type">int</span> nxt[<span class="hljs-number">1000006</span>],n,cnt;
stack&lt;<span class="hljs-type">int</span>&gt; s,ans;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{<span class="hljs-comment">// 一直走下去</span>
	<span class="hljs-keyword">while</span>(nxt[x]&lt;<span class="hljs-number">10</span>){
		<span class="hljs-type">int</span> to=(x*<span class="hljs-number">10</span>+nxt[x])%cnt;
		s.<span class="hljs-built_in">push</span>(to);
		nxt[x]++;
		x=to;
	}
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
	<span class="hljs-keyword">while</span>(cin&gt;&gt;n &amp;&amp; n){
		<span class="hljs-keyword">if</span>(!n) <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">if</span>(n==<span class="hljs-number">1</span>){
			cout&lt;&lt;<span class="hljs-string">&quot;0123456789&quot;</span>&lt;&lt;endl;
			<span class="hljs-keyword">continue</span>;
		}
		cnt=<span class="hljs-number">1</span>;
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n<span class="hljs-number">-1</span>;i++) cnt*=<span class="hljs-number">10</span>;
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;cnt;i++) nxt[i]=<span class="hljs-number">0</span>;
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n<span class="hljs-number">-1</span>;i++) cout&lt;&lt;<span class="hljs-number">0</span>;
		<span class="hljs-built_in">dfs</span>(<span class="hljs-number">0</span>);
		<span class="hljs-keyword">while</span>(!s.<span class="hljs-built_in">empty</span>()){<span class="hljs-comment">// 走不动了，说明该回溯到上一个点，然后再向另一个方向一直走</span>
			ans.<span class="hljs-built_in">push</span>(s.<span class="hljs-built_in">top</span>()%<span class="hljs-number">10</span>);s.<span class="hljs-built_in">pop</span>();
			<span class="hljs-keyword">if</span>(!s.<span class="hljs-built_in">empty</span>()) <span class="hljs-built_in">dfs</span>(s.<span class="hljs-built_in">top</span>());
		}
		<span class="hljs-type">int</span> tot=n<span class="hljs-number">-1</span>;
		<span class="hljs-keyword">while</span>(!ans.<span class="hljs-built_in">empty</span>()) cout&lt;&lt;ans.<span class="hljs-built_in">top</span>(),ans.<span class="hljs-built_in">pop</span>(),tot++;
		cout&lt;&lt;endl;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h4 id="an-zi-dian-xu" tabindex="-1">按字典序</h4>
<p>先把点连出的所有边按照字典序排序，然后再求欧拉路，此时得到的方案其实就是按字典序的。但是由于我们是在回溯时记录答案，所以得到的方案其实是反的。所以我们还需要再把回溯时的要记录的点先放到一个栈里，然后最后再从栈中取出（相当于又反了一遍）</p>
<p><strong>例题</strong> <a href="https://www.luogu.com.cn/problem/P7771">P7771</a> 有向图求欧拉路板子题，按字典序输出方案</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBfJTIwMjAwMDA1JTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEElMEFpbmxpbmUlMjBpbnQlMjByZWFkKCklN0IlMEElMDlpbnQlMjByZXMlM0QwJTJDY2glM0RnZXRjaGFyKCklMkNmJTNEMSUzQiUwQSUwOXdoaWxlKCFpc2RpZ2l0KGNoKSUyMGFuZCUyMGNoISUzREVPRiklN0IlMEElMDklMDlpZihjaCUzRCUzRCctJyklMjBmJTNELTElM0IlMEElMDklMDljaCUzRGdldGNoYXIoKSUzQiUwQSUwOSU3RCUwQSUwOXdoaWxlKGlzZGlnaXQoY2gpKSU3QiUwQSUwOSUwOXJlcyUzRChyZXMlM0MlM0MzKSUyQihyZXMlM0MlM0MxKSUyQihjaC0nMCcpJTNCJTBBJTA5JTA5Y2glM0RnZXRjaGFyKCklM0IlMEElMDklN0QlMEElMDlyZXR1cm4lMjByZXMqZiUzQiUwQSU3RCUwQSUwQXZlY3RvciUzQ2ludCUzRSUyMHZlJTVCXyU1RCUzQiUwQWludCUyMGJsJTVCXyU1RCUyQ24lMkNtJTJDaW4lNUJfJTVEJTJDb3V0JTVCXyU1RCUzQiUwQXN0YWNrJTNDaW50JTNFJTIwc3QlM0IlMEF2b2lkJTIwZGZzKGludCUyMHgpJTdCJTBBJTA5Zm9yKGludCUyMGklM0RibCU1QnglNUQlM0JpJTNDdmUlNUJ4JTVELnNpemUoKSUzQmklM0RibCU1QnglNUQpJTdCJTBBJTA5JTA5YmwlNUJ4JTVEJTJCJTJCJTNCJTBBJTA5JTA5ZGZzKHZlJTVCeCU1RCU1QmklNUQpJTNCJTBBJTA5JTdEJTBBJTA5c3QucHVzaCh4KSUzQiUwQSU3RCUwQSUwQWludCUyMG1haW4oKSU3QiUwQSUwOW4lM0RyZWFkKCklMkNtJTNEcmVhZCgpJTNCJTBBJTA5Zm9yKGludCUyMGklM0QxJTNCaSUzQyUzRG0lM0JpJTJCJTJCKSU3QiUwQSUwOSUwOWludCUyMHUlM0RyZWFkKCklMkN2JTNEcmVhZCgpJTNCJTBBJTA5JTA5aW4lNUJ2JTVEJTJCJTJCJTJDb3V0JTVCdSU1RCUyQiUyQiUzQiUwQSUwOSUwOXZlJTVCdSU1RC5wdXNoX2JhY2sodiklM0IlMEElMDklN0QlMEElMDlmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTIwc29ydCh2ZSU1QmklNUQuYmVnaW4oKSUyQ3ZlJTVCaSU1RC5lbmQoKSklM0IlMEElMDlpbnQlMjBmbGFnJTNEMCUyQ2NudDElM0QwJTJDY250MiUzRDAlMkNzJTNEMCUzQiUwQSUwOWZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RuJTNCaSUyQiUyQiklN0IlMEElMDklMDlpZihpbiU1QmklNUQhJTNEb3V0JTVCaSU1RCklMjBmbGFnJTNEdHJ1ZSUzQiUwQSUwOSUwOWlmKGluJTVCaSU1RC1vdXQlNUJpJTVEJTNEJTNEMSklMjBjbnQxJTJCJTJCJTNCJTBBJTA5JTA5aWYob3V0JTVCaSU1RC1pbiU1QmklNUQlM0QlM0QxKSUyMHMlM0RpJTJDY250MiUyQiUyQiUzQiUwQSUwOSU3RCUwQSUwOWlmKGZsYWclMjYlMjYhKGNudDElM0QlM0RjbnQyJTI2JTI2Y250MSUzRCUzRDEpKSUyMHJldHVybiUyMGNvdXQlM0MlM0MlMjJObyUyMiUyQzAlM0IlMEElMDlpZihmbGFnKSUyMGRmcyhzKSUzQiUwQSUwOWVsc2UlMjBkZnMoMSklM0IlMEElMDl3aGlsZSghc3QuZW1wdHkoKSklMjBjb3V0JTNDJTNDc3QudG9wKCklM0MlM0MnJTIwJyUyQ3N0LnBvcCgpJTNCJTBBJTA5cmV0dXJuJTIwMCUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _ 200005</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span>{
	<span class="hljs-type">int</span> res=<span class="hljs-number">0</span>,ch=<span class="hljs-built_in">getchar</span>(),f=<span class="hljs-number">1</span>;
	<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(ch) <span class="hljs-keyword">and</span> ch!=EOF){
		<span class="hljs-keyword">if</span>(ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;
		ch=<span class="hljs-built_in">getchar</span>();
	}
	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(ch)){
		res=(res&lt;&lt;<span class="hljs-number">3</span>)+(res&lt;&lt;<span class="hljs-number">1</span>)+(ch-<span class="hljs-string">&#x27;0&#x27;</span>);
		ch=<span class="hljs-built_in">getchar</span>();
	}
	<span class="hljs-keyword">return</span> res*f;
}

vector&lt;<span class="hljs-type">int</span>&gt; ve[_];
<span class="hljs-type">int</span> bl[_],n,m,in[_],out[_];
stack&lt;<span class="hljs-type">int</span>&gt; st;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=bl[x];i&lt;ve[x].<span class="hljs-built_in">size</span>();i=bl[x]){
		bl[x]++;
		<span class="hljs-built_in">dfs</span>(ve[x][i]);
	}
	st.<span class="hljs-built_in">push</span>(x);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	n=<span class="hljs-built_in">read</span>(),m=<span class="hljs-built_in">read</span>();
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){
		<span class="hljs-type">int</span> u=<span class="hljs-built_in">read</span>(),v=<span class="hljs-built_in">read</span>();
		in[v]++,out[u]++;
		ve[u].<span class="hljs-built_in">push_back</span>(v);
	}
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">sort</span>(ve[i].<span class="hljs-built_in">begin</span>(),ve[i].<span class="hljs-built_in">end</span>());
	<span class="hljs-type">int</span> flag=<span class="hljs-number">0</span>,cnt1=<span class="hljs-number">0</span>,cnt2=<span class="hljs-number">0</span>,s=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
		<span class="hljs-keyword">if</span>(in[i]!=out[i]) flag=<span class="hljs-literal">true</span>;
		<span class="hljs-keyword">if</span>(in[i]-out[i]==<span class="hljs-number">1</span>) cnt1++;
		<span class="hljs-keyword">if</span>(out[i]-in[i]==<span class="hljs-number">1</span>) s=i,cnt2++;
	}
	<span class="hljs-keyword">if</span>(flag&amp;&amp;!(cnt1==cnt2&amp;&amp;cnt1==<span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> cout&lt;&lt;<span class="hljs-string">&quot;No&quot;</span>,<span class="hljs-number">0</span>;
	<span class="hljs-keyword">if</span>(flag) <span class="hljs-built_in">dfs</span>(s);
	<span class="hljs-keyword">else</span> <span class="hljs-built_in">dfs</span>(<span class="hljs-number">1</span>);
	<span class="hljs-keyword">while</span>(!st.<span class="hljs-built_in">empty</span>()) cout&lt;&lt;st.<span class="hljs-built_in">top</span>()&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>,st.<span class="hljs-built_in">pop</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="wang-luo-liu" tabindex="-1">网络流</h2>
<h3 id="zui-da-liu" tabindex="-1">最大流</h3>
<p>弧优化的dinic算法</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="aW50JTIwZGlzJTVCXyU1RCUyQ3JhZCU1Ql8lNUQlMkNzJTJDdCUzQiUwQWJvb2wlMjBiZnMoKSU3QiUwQSUwOW1lbXNldChkaXMlMkMwJTJDc2l6ZW9mKGRpcykpJTNCZGlzJTVCcyU1RCUzRDElM0IlMEElMDlxdWV1ZSUzQ2ludCUzRSUyMHElM0JxLnB1c2gocyklM0IlMEElMDl3aGlsZSghcS5lbXB0eSgpKSU3QiUwQSUwOSUwOWludCUyMG5vdyUzRHEuZnJvbnQoKSUzQnEucG9wKCklM0IlMEElMDklMDlyYWQlNUJub3clNUQlM0RoZWFkJTVCbm93JTVEJTNCJTBBJTA5JTA5Zm9yKGludCUyMGklM0RoZWFkJTVCbm93JTVEJTNCaSUzQmklM0RlZGdlJTVCaSU1RC5ueHQpJTdCJTBBJTA5JTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaSU1RC50byUzQiUwQSUwOSUwOSUwOWlmKCFkaXMlNUJ0byU1RCUyNiUyNmVkZ2UlNUJpJTVELncpJTIwZGlzJTVCdG8lNUQlM0RkaXMlNUJub3clNUQlMkIxJTJDcS5wdXNoKHRvKSUzQiUwQSUwOSUwOSU3RCUwQSUwOSU3RCUwQSUwOXJldHVybiUyMGRpcyU1QnQlNUQhJTNEMCUzQiUwQSU3RCUwQWludCUyMGRmcyhpbnQlMjBub3clMkNpbnQlMjByZW0pJTdCJTBBJTA5aWYobm93JTNEJTNEdCklMjByZXR1cm4lMjByZW0lM0IlMEElMDlpbnQlMjB0bXAlM0RyZW0lM0IlMEElMDlmb3IoaW50JTIwaSUzRHJhZCU1Qm5vdyU1RCUzQmklM0JpJTNEZWRnZSU1QmklNUQubnh0KSU3QiUwQSUwOSUwOWludCUyMHRvJTNEZWRnZSU1QmklNUQudG8lM0JyYWQlNUJub3clNUQlM0RpJTNCJTBBJTA5JTA5aWYoZGlzJTVCdG8lNUQlM0QlM0RkaXMlNUJub3clNUQlMkIxJTI2JTI2ZWRnZSU1QmklNUQudyklN0IlMEElMDklMDklMDlpbnQlMjBrJTNEbWluKGVkZ2UlNUJpJTVELnclMkN0bXApJTNCJTBBJTA5JTA5JTA5aW50JTIwZCUzRGRmcyh0byUyQ2spJTNCJTBBJTA5JTA5JTA5ZWRnZSU1QmklNUQudy0lM0RkJTJDZWRnZSU1QmklNUUxJTVELnclMkIlM0RkJTNCJTBBJTA5JTA5JTA5dG1wLSUzRGQlM0IlMEElMDklMDklMDlpZighdG1wKSUyMGJyZWFrJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTA5cmV0dXJuJTIwcmVtLXRtcCUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div></div><div class="code"><span class="hljs-type">int</span> dis[_],rad[_],s,t;
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(dis));dis[s]=<span class="hljs-number">1</span>;
	queue&lt;<span class="hljs-type">int</span>&gt; q;q.<span class="hljs-built_in">push</span>(s);
	<span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>()){
		<span class="hljs-type">int</span> now=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();
		rad[now]=head[now];
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[now];i;i=edge[i].nxt){
			<span class="hljs-type">int</span> to=edge[i].to;
			<span class="hljs-keyword">if</span>(!dis[to]&amp;&amp;edge[i].w) dis[to]=dis[now]<span class="hljs-number">+1</span>,q.<span class="hljs-built_in">push</span>(to);
		}
	}
	<span class="hljs-keyword">return</span> dis[t]!=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> now,<span class="hljs-type">int</span> rem)</span></span>{
	<span class="hljs-keyword">if</span>(now==t) <span class="hljs-keyword">return</span> rem;
	<span class="hljs-type">int</span> tmp=rem;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=rad[now];i;i=edge[i].nxt){
		<span class="hljs-type">int</span> to=edge[i].to;rad[now]=i;
		<span class="hljs-keyword">if</span>(dis[to]==dis[now]<span class="hljs-number">+1</span>&amp;&amp;edge[i].w){
			<span class="hljs-type">int</span> k=<span class="hljs-built_in">min</span>(edge[i].w,tmp);
			<span class="hljs-type">int</span> d=<span class="hljs-built_in">dfs</span>(to,k);
			edge[i].w-=d,edge[i^<span class="hljs-number">1</span>].w+=d;
			tmp-=d;
			<span class="hljs-keyword">if</span>(!tmp) <span class="hljs-keyword">break</span>;
		}
	}
	<span class="hljs-keyword">return</span> rem-tmp;
}
</div></code></pre>
<h3 id="dag-zui-xiao-lu-jing-fu-gai" tabindex="-1">DAG最小路径覆盖</h3>
<h4 id="bu-xiang-jiao-lu-jing" tabindex="-1">不相交路径</h4>
<p><div class="img-box"><img class="lazy" date-src="C:%5CUsers%5CCaiwen%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20250306174049255.png" style="transform: scale(1)" ><div class="img-title">image-20250306174049255</div></div></p>
<p>如图所示，一种不相交的最小路径覆盖为 1-&gt;3-&gt;4、2、5</p>
<p>一个点也可以视为一个长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 的路径</p>
<p>我们可以先建立一个二分图，左边是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1\sim n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> ，右边也是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1\sim n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>。如果 DAG 上存在一个有向边 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> 的话，那么就把二分图中左边的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> 和右边的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 连边。最后有</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>最小不相交路径覆盖</mtext><mo>=</mo><mtext>总点数</mtext><mo>−</mo><mtext>最大匹配</mtext></mrow><annotation encoding="application/x-tex">\text{最小不相交路径覆盖}=\text{总点数}-\text{最大匹配}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">最小不相交路径覆盖</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord cjk_fallback">总点数</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">最大匹配</span></span></span></span></span></span></p>
<p>可以理解为，我先让每个点被自己覆盖。然后如果我在二分图上建立了一个匹配了，那么就相当于延长了一个路径，也就是少花费了一个点</p>
<h4 id="ke-xiang-jiao-lu-jing" tabindex="-1">可相交路径</h4>
<p>还是如上图，一种可相交的最小路径覆盖为 1-&gt;3-&gt;4、2-&gt;3-&gt;5</p>
<p>我们先用 floyd 在图上搞传递闭包，然后如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> 能到达 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> ，就在把二分图左边的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> 与右边的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 连边。最后答案还是按上式计算</p>
<p>可以理解为如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> 能到达 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> ，那么我们直接给连过去，先把中间的点省略，因为中间的点可能会被其他路径使用。如果后面的路径没使用到这个中间点的话，那么根据最大匹配的算法，一定会调整为选择使用中间的点，因为这样才能得到最大匹配</p>
<h3 id="ti-mu" tabindex="-1">题目</h3>
<h4 id="p2472-scoi-2007-xi-yi" tabindex="-1">P2472 [SCOI2007] 蜥蜴</h4>
<p><a href="https://www.luogu.com.cn/problem/P2472">https://www.luogu.com.cn/problem/P2472</a></p>
<p><strong>题目描述</strong></p>
<p>在一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> 行 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> 列的网格地图中有一些高度不同的石柱，第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 行 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> 列的石柱高度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">h_{i,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>一些石柱上站着一些蜥蜴，你的任务是让尽量多的蜥蜴逃到边界外。</p>
<p>每行每列中相邻石柱的距离为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，蜥蜴的跳跃距离是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>，即蜥蜴可以跳到<strong>平面距离</strong>不超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> 的任何一个石柱上。</p>
<p>石柱都不稳定，每次当蜥蜴跳跃时，所离开的石柱高度减 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>（如果仍然落在地图内部，则到达的石柱高度不变）。</p>
<p>如果该石柱原来高度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，则蜥蜴离开后消失，以后其他蜥蜴不能落脚。</p>
<p>任何时刻不能有两只蜥蜴在同一个石柱上。</p>
<p><strong>数据范围</strong></p>
<p>对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">100\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span></span></span> 的数据满足：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>r</mi><mo separator="true">,</mo><mi>c</mi><mo>≤</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">1\le r,c\le20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>d</mi><mo>≤</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">1\le d\le 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>h</mi><mo>≤</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">1\le h\le 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>。</p>
<p><strong>笔记</strong></p>
<p>题目总体来说有两个限制，一个是跳完之后高度就减一，减到 0 后就不能再跳到该位置了。另一个是同一时间只能有一个蜥蜴在一个柱子上</p>
<p>对于后者，其实可以忽略。如果我们能够得到一个蜥蜴的跳出方案，而这个蜥蜴要跳到的柱子已经被占用了，那么我们可以一直等待柱子解除占用，毕竟题目又没要求时间</p>
<p>于是就只需要考虑前面这个限制了。其实就是限制经过一个点的次数。对于这种要求，我们有如下建模方案：将点拆成入点和出点，然后入点到出点设置流量为限制次数的边</p>
<p><div class="img-box"><img class="lazy" date-src="C:%5CUsers%5CCaiwen%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20250306155451629.png" style="transform: scale(1)" ><div class="img-title">image-20250306155451629</div></div></p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBaW50JTIwbiUyQ20lMkNkJTJDZyU1QjIyJTVEJTVCMjIlNUQlMkNzJTJDdCUyQ2hhcyU1QjIyJTVEJTVCMjIlNUQlMkNzaXolM0QxJTJDaGVhZCU1QjkwMCU1RCUyQ2RpcyU1QjkwMCU1RCUyQ3JhZCU1QjkwMCU1RCUzQiUwQWlubGluZSUyMGludCUyMGdldChpbnQlMjB4JTJDaW50JTIweSUyQ2ludCUyMHQpJTdCJTBBJTIwJTIwJTIwJTIwaW50JTIwcmVzJTNEKHgtMSkqbSUyQnklM0IlMEElMjAlMjAlMjAlMjByZXR1cm4lMjB0JTNEJTNEMCUzRiUyMHJlcyUzQW4qbSUyQnJlcyUzQiUwQSU3RCUwQWlubGluZSUyMGludCUyMGRpczIoaW50JTIweDElMkNpbnQlMjB5MSUyQ2ludCUyMHgyJTJDaW50JTIweTIpJTdCcmV0dXJuJTIwKHgxLXgyKSooeDEteDIpJTJCKHkxLXkyKSooeTEteTIpJTNCJTdEJTBBc3RydWN0JTIwRWRnZSU3QmludCUyMHRvJTJDbnh0JTJDdyUzQiU3RCUyMGVkZ2UlNUIzMjAwMDQlNUQlM0IlMEFpbmxpbmUlMjB2b2lkJTIwX2FkZChpbnQlMjB1JTJDaW50JTIwdiUyQ2ludCUyMHcpJTdCZWRnZSU1QiUyQiUyQnNpeiU1RC5ueHQlM0RoZWFkJTVCdSU1RCUyQ2VkZ2UlNUJzaXolNUQudG8lM0R2JTJDZWRnZSU1QnNpeiU1RC53JTNEdyUyQ2hlYWQlNUJ1JTVEJTNEc2l6JTNCJTdEJTBBaW5saW5lJTIwdm9pZCUyMGFkZChpbnQlMjB1JTJDaW50JTIwdiUyQ2ludCUyMHcpJTdCX2FkZCh1JTJDdiUyQ3cpJTJDX2FkZCh2JTJDdSUyQzApJTNCJTdEJTBBYm9vbCUyMGJmcygpJTdCJTBBJTA5bWVtc2V0KGRpcyUyQzAlMkNzaXplb2YoZGlzKSklM0JkaXMlNUJzJTVEJTNEMSUzQiUwQSUwOXF1ZXVlJTNDaW50JTNFJTIwcSUzQnEucHVzaChzKSUzQiUwQSUwOXdoaWxlKCFxLmVtcHR5KCkpJTdCJTBBJTA5JTA5aW50JTIwbm93JTNEcS5mcm9udCgpJTNCcS5wb3AoKSUzQiUwQSUwOSUwOXJhZCU1Qm5vdyU1RCUzRGhlYWQlNUJub3clNUQlM0IlMEElMDklMDlmb3IoaW50JTIwaSUzRGhlYWQlNUJub3clNUQlM0JpJTNCaSUzRGVkZ2UlNUJpJTVELm54dCklN0IlMEElMDklMDklMDlpbnQlMjB0byUzRGVkZ2UlNUJpJTVELnRvJTNCJTBBJTA5JTA5JTA5aWYoIWRpcyU1QnRvJTVEJTI2JTI2ZWRnZSU1QmklNUQudyklMjBkaXMlNUJ0byU1RCUzRGRpcyU1Qm5vdyU1RCUyQjElMkNxLnB1c2godG8pJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTA5cmV0dXJuJTIwZGlzJTVCdCU1RCElM0QwJTNCJTBBJTdEJTBBaW50JTIwZGZzKGludCUyMG5vdyUyQ2ludCUyMHJlbSklN0IlMEElMDlpZihub3clM0QlM0R0KSUyMHJldHVybiUyMHJlbSUzQiUwQSUwOWludCUyMHRtcCUzRHJlbSUzQiUwQSUwOWZvcihpbnQlMjBpJTNEcmFkJTVCbm93JTVEJTNCaSUzQmklM0RlZGdlJTVCaSU1RC5ueHQpJTdCJTBBJTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaSU1RC50byUzQnJhZCU1Qm5vdyU1RCUzRGklM0IlMEElMDklMDlpZihkaXMlNUJ0byU1RCUzRCUzRGRpcyU1Qm5vdyU1RCUyQjElMjYlMjZlZGdlJTVCaSU1RC53KSU3QiUwQSUwOSUwOSUwOWludCUyMGslM0RtaW4oZWRnZSU1QmklNUQudyUyQ3RtcCklM0IlMEElMDklMDklMDlpbnQlMjBkJTNEZGZzKHRvJTJDayklM0IlMEElMDklMDklMDllZGdlJTVCaSU1RC53LSUzRGQlMkNlZGdlJTVCaSU1RTElNUQudyUyQiUzRGQlM0IlMEElMDklMDklMDl0bXAtJTNEZCUzQiUwQSUwOSUwOSUwOWlmKCF0bXApJTIwYnJlYWslM0IlMEElMDklMDklN0QlMEElMDklN0QlMEElMDlyZXR1cm4lMjByZW0tdG1wJTNCJTBBJTdEJTBBaW5saW5lJTIwdm9pZCUyMHN1YnRhc2soKSU3QiUwQSUyMCUyMCUyMCUyMGNpbiUzRSUzRW4lM0UlM0VtJTNFJTNFZCUzQiUwQSUyMCUyMCUyMCUyMGludCUyMGNudCUzRDAlM0IlMEElMjAlMjAlMjAlMjBzJTNEMCUyQ3QlM0QyKm4qbSUyQjElM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwc3RyaW5nJTIwc3RyJTNCY2luJTNFJTNFc3RyJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZm9yKGludCUyMGolM0QxJTNCaiUzQyUzRG0lM0JqJTJCJTJCKSUyMGclNUJpJTVEJTVCaiU1RCUzRHN0ciU1QmotMSU1RC0nMCclM0IlMEElMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwc3RyaW5nJTIwc3RyJTNCY2luJTNFJTNFc3RyJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZm9yKGludCUyMGolM0QxJTNCaiUzQyUzRG0lM0JqJTJCJTJCKSUyMGhhcyU1QmklNUQlNUJqJTVEJTNEc3RyJTVCai0xJTVEJTNEJTNEJy4nJTNGMCUzQTElM0IlMEElMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZm9yKGludCUyMGolM0QxJTNCaiUzQyUzRG0lM0JqJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKCFnJTVCaSU1RCU1QmolNUQpJTIwY29udGludWUlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihoYXMlNUJpJTVEJTVCaiU1RCklMjBhZGQocyUyQ2dldChpJTJDaiUyQzApJTJDMSklMkNjbnQlMkIlMkIlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBhZGQoZ2V0KGklMkNqJTJDMCklMkNnZXQoaSUyQ2olMkMxKSUyQ2clNUJpJTVEJTVCaiU1RCklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihtaW4oaSUyQ21pbihqJTJDbWluKG4taSUyQjElMkNtLWolMkIxKSkpJTNDJTNEZCklMjBhZGQoZ2V0KGklMkNqJTJDMSklMkN0JTJDaW5mKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGZvcihpbnQlMjBrJTNEbWF4KDFsbCUyQ2ktZCklM0JrJTNDJTNEbWluKGklMkJkJTJDbiklM0JrJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGZvcihpbnQlMjBsJTNEbWF4KDFsbCUyQ2otZCklM0JsJTNDJTNEbWluKGolMkJkJTJDbSklM0JsJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKGslM0QlM0RpJTI2JTI2bCUzRCUzRGopJTIwY29udGludWUlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZighZyU1QmslNUQlNUJsJTVEKSUyMGNvbnRpbnVlJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYoZGlzMihpJTJDaiUyQ2slMkNsKSUzQyUzRGQqZCklMjBhZGQoZ2V0KGklMkNqJTJDMSklMkNnZXQoayUyQ2wlMkMwKSUyQ2luZiklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjBpbnQlMjBhbnMlM0QwJTNCJTBBJTIwJTIwJTIwJTIwd2hpbGUoYmZzKCkpJTIwYW5zJTJCJTNEZGZzKHMlMkNpbmYpJTNCJTBBJTIwJTIwJTIwJTIwY291dCUzQyUzQ2NudC1hbnMlM0IlMEElN0QlMEFzaWduZWQlMjBtYWluKCklN0IlMEElMjAlMjAlMjAlMjBpb3MlM0ElM0FzeW5jX3dpdGhfc3RkaW8oZmFsc2UpJTNCJTBBJTIwJTIwJTIwJTIwaW50JTIwdCUzRDElM0IlMkYlMkZjaW4lM0UlM0V0JTNCJTBBJTIwJTIwJTIwJTIwd2hpbGUodC0tKSUyMHN1YnRhc2soKSUzQiUwQSUyMCUyMCUyMCUyMHJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div><div>81</div><div>82</div><div>83</div><div>84</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-type">int</span> n,m,d,g[<span class="hljs-number">22</span>][<span class="hljs-number">22</span>],s,t,has[<span class="hljs-number">22</span>][<span class="hljs-number">22</span>],siz=<span class="hljs-number">1</span>,head[<span class="hljs-number">900</span>],dis[<span class="hljs-number">900</span>],rad[<span class="hljs-number">900</span>];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y,<span class="hljs-type">int</span> t)</span></span>{
    <span class="hljs-type">int</span> res=(x<span class="hljs-number">-1</span>)*m+y;
    <span class="hljs-keyword">return</span> t==<span class="hljs-number">0</span>? res:n*m+res;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">dis2</span><span class="hljs-params">(<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2)</span></span>{<span class="hljs-keyword">return</span> (x1-x2)*(x1-x2)+(y1-y2)*(y1-y2);}
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>{<span class="hljs-type">int</span> to,nxt,w;} edge[<span class="hljs-number">320004</span>];
<span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> _add(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w){edge[++siz].nxt=head[u],edge[siz].to=v,edge[siz].w=w,head[u]=siz;}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w)</span></span>{_add(u,v,w),_add(v,u,<span class="hljs-number">0</span>);}
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(dis));dis[s]=<span class="hljs-number">1</span>;
	queue&lt;<span class="hljs-type">int</span>&gt; q;q.<span class="hljs-built_in">push</span>(s);
	<span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>()){
		<span class="hljs-type">int</span> now=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();
		rad[now]=head[now];
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[now];i;i=edge[i].nxt){
			<span class="hljs-type">int</span> to=edge[i].to;
			<span class="hljs-keyword">if</span>(!dis[to]&amp;&amp;edge[i].w) dis[to]=dis[now]<span class="hljs-number">+1</span>,q.<span class="hljs-built_in">push</span>(to);
		}
	}
	<span class="hljs-keyword">return</span> dis[t]!=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> now,<span class="hljs-type">int</span> rem)</span></span>{
	<span class="hljs-keyword">if</span>(now==t) <span class="hljs-keyword">return</span> rem;
	<span class="hljs-type">int</span> tmp=rem;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=rad[now];i;i=edge[i].nxt){
		<span class="hljs-type">int</span> to=edge[i].to;rad[now]=i;
		<span class="hljs-keyword">if</span>(dis[to]==dis[now]<span class="hljs-number">+1</span>&amp;&amp;edge[i].w){
			<span class="hljs-type">int</span> k=<span class="hljs-built_in">min</span>(edge[i].w,tmp);
			<span class="hljs-type">int</span> d=<span class="hljs-built_in">dfs</span>(to,k);
			edge[i].w-=d,edge[i^<span class="hljs-number">1</span>].w+=d;
			tmp-=d;
			<span class="hljs-keyword">if</span>(!tmp) <span class="hljs-keyword">break</span>;
		}
	}
	<span class="hljs-keyword">return</span> rem-tmp;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    cin&gt;&gt;n&gt;&gt;m&gt;&gt;d;
    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;
    s=<span class="hljs-number">0</span>,t=<span class="hljs-number">2</span>*n*m<span class="hljs-number">+1</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        string str;cin&gt;&gt;str;
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++) g[i][j]=str[j<span class="hljs-number">-1</span>]-<span class="hljs-string">&#x27;0&#x27;</span>;
    }
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        string str;cin&gt;&gt;str;
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++) has[i][j]=str[j<span class="hljs-number">-1</span>]==<span class="hljs-string">&#x27;.&#x27;</span>?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++){
            <span class="hljs-keyword">if</span>(!g[i][j]) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">if</span>(has[i][j]) <span class="hljs-built_in">add</span>(s,<span class="hljs-built_in">get</span>(i,j,<span class="hljs-number">0</span>),<span class="hljs-number">1</span>),cnt++;
            <span class="hljs-built_in">add</span>(<span class="hljs-built_in">get</span>(i,j,<span class="hljs-number">0</span>),<span class="hljs-built_in">get</span>(i,j,<span class="hljs-number">1</span>),g[i][j]);
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">min</span>(i,<span class="hljs-built_in">min</span>(j,<span class="hljs-built_in">min</span>(n-i<span class="hljs-number">+1</span>,m-j<span class="hljs-number">+1</span>)))&lt;=d) <span class="hljs-built_in">add</span>(<span class="hljs-built_in">get</span>(i,j,<span class="hljs-number">1</span>),t,inf);
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-built_in">max</span>(<span class="hljs-number">1ll</span>,i-d);k&lt;=<span class="hljs-built_in">min</span>(i+d,n);k++){
                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> l=<span class="hljs-built_in">max</span>(<span class="hljs-number">1ll</span>,j-d);l&lt;=<span class="hljs-built_in">min</span>(j+d,m);l++){
                    <span class="hljs-keyword">if</span>(k==i&amp;&amp;l==j) <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span>(!g[k][l]) <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">dis2</span>(i,j,k,l)&lt;=d*d) <span class="hljs-built_in">add</span>(<span class="hljs-built_in">get</span>(i,j,<span class="hljs-number">1</span>),<span class="hljs-built_in">get</span>(k,l,<span class="hljs-number">0</span>),inf);
                }
            }
        }
    }
    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>()) ans+=<span class="hljs-built_in">dfs</span>(s,inf);
    cout&lt;&lt;cnt-ans;
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t=<span class="hljs-number">1</span>;<span class="hljs-comment">//cin&gt;&gt;t;</span>
    <span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h4 id="p2754-ctsc-1999-jia-yuan-xing-ji-zhuan-yi-wen-ti" tabindex="-1">P2754 [CTSC1999] 家园 / 星际转移问题</h4>
<p><a href="https://www.luogu.com.cn/problem/P2754">https://www.luogu.com.cn/problem/P2754</a></p>
<p><strong>题目描述</strong></p>
<p>有 地球，月球，还有额外的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个星球，然后有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 个宇宙飞船，可以分别以自己的某个顺序循环在几个星球之间穿梭，每次穿梭消耗一个单位的时间。每个飞船都有自己的容量限制</p>
<p>现在问至少需要多少时间才能把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个人从 地球 运往 月球</p>
<p><strong>数据范围</strong></p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>13</mn></mrow><annotation encoding="application/x-tex">1 \leq n \leq 13</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">13</span></span></span></span>。</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">1 \leq m \leq 20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span></span></span></span>。</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">1 \leq k \leq 50</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">50</span></span></span></span>。</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>r</mi><mi>i</mi></msub><mo>≤</mo><mi>n</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1 \leq r_i \leq n + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>。</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1</mn><mo>≤</mo><msub><mi>S</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>≤</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">-1 \leq S_{i, j}\leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>。</li>
</ul>
<p><strong>笔记</strong></p>
<p>先用并查集判断是否有解</p>
<p>然后题目中这个”时间“有点不好搞。这里又引出一个建模方法：根据时间分层，具体如图：</p>
<p><div class="img-box"><img class="lazy" date-src="C:%5CUsers%5CCaiwen%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20250306160443125.png" style="transform: scale(1)" ><div class="img-title">image-20250306160443125</div></div></p>
<p>然后我们枚举时间，建图跑最大流，直到得到的流量等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 即可得到答案</p>
<p>注意理论上这种问题应该是二分答案的，但我们考虑直接枚举，因为如果有解，那么最大耗时不会超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">kn^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> ，所以枚举可以。而且当我们枚举完一个答案再往下枚举的时候，我们可以直接在现有的图上补充点和边，而不用再重新建立一个完整的图，这是二分做不到的。而且我们跑完最大流后，补充点和边，直接再基于上一次的残留网络继续跑最大流就可以了。所以直接枚举的效率并不会太低</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjB1bGwlMjB1bnNpZ25lZCUyMGxvbmclMjBsb25nJTBBJTIzZGVmaW5lJTIwbHMoayklMjAoayklM0MlM0MxJTBBJTIzZGVmaW5lJTIwcnMoayklMjAoayklM0MlM0MxJTdDMSUwQSUyM2RlZmluZSUyMGRlYnVnKHgpJTIwY291dCUzQyUzQyUyM3glM0MlM0MlMjIlM0QlMjIlM0MlM0N4JTNDJTNDZW5kbCUwQXVzaW5nJTIwbmFtZXNwYWNlJTIwc3RkJTNCJTBBY29uc3QlMjBpbnQlMjBpbmYlM0QweDNmM2YzZjNmM2YzZjNmM2YlM0IlMEFjb25zdCUyMGludCUyMG1vZCUzRDAlM0IlMEF0eXBlZGVmJTIwcGFpciUzQ2ludCUyQ2ludCUzRSUyMHBpaSUzQiUwQSUyM2RlZmluZSUyMF8lMjAxMDAwMDA2JTBBc3RydWN0JTIwRWRnZSU3QmludCUyMG54dCUyQ3RvJTJDdyUzQiU3RCUyMGVkZ2UlNUJfJTNDJTNDMSU1RCUzQiUwQWludCUyMGhlYWQlNUJfJTVEJTJDc2l6JTNEMSUyQ29wYSU1Ql8lNUQlMkNmYSU1Ql8lNUQlMkNsYXMlNUJfJTVEJTNCJTBBaW5saW5lJTIwaW50JTIwZmluZChpbnQlMjB4KSU3QndoaWxlKHghJTNEZmElNUJ4JTVEKSUyMHglM0RmYSU1QnglNUQlM0RmYSU1QmZhJTVCeCU1RCU1RCUzQnJldHVybiUyMHglM0IlN0QlMEFpbmxpbmUlMjB2b2lkJTIwX2FkZChpbnQlMjB1JTJDaW50JTIwdiUyQ2ludCUyMHcpJTdCZWRnZSU1QiUyQiUyQnNpeiU1RC5ueHQlM0RoZWFkJTVCdSU1RCUyQ2VkZ2UlNUJzaXolNUQudG8lM0R2JTJDZWRnZSU1QnNpeiU1RC53JTNEdyUyQ2hlYWQlNUJ1JTVEJTNEc2l6JTNCJTdEJTBBaW5saW5lJTIwdm9pZCUyMGFkZChpbnQlMjB1JTJDaW50JTIwdiUyQ2ludCUyMHcpJTdCX2FkZCh1JTJDdiUyQ3cpJTJDX2FkZCh2JTJDdSUyQzApJTNCJTdEJTBBaW50JTIwZGlzJTVCMjAwMDA1JTVEJTJDcmFkJTVCXyU1RCUyQ3MlMkN0JTNCJTBBYm9vbCUyMGJmcygpJTdCJTBBJTA5bWVtc2V0KGRpcyUyQzAlMkNzaXplb2YoZGlzKSklM0JkaXMlNUJzJTVEJTNEMSUzQiUwQSUwOXF1ZXVlJTNDaW50JTNFJTIwcSUzQnEucHVzaChzKSUzQiUwQSUwOXdoaWxlKCFxLmVtcHR5KCkpJTdCJTBBJTA5JTA5aW50JTIwbm93JTNEcS5mcm9udCgpJTNCcS5wb3AoKSUzQiUwQSUwOSUwOXJhZCU1Qm5vdyU1RCUzRGhlYWQlNUJub3clNUQlM0IlMEElMDklMDlmb3IoaW50JTIwaSUzRGhlYWQlNUJub3clNUQlM0JpJTNCaSUzRGVkZ2UlNUJpJTVELm54dCklN0IlMEElMDklMDklMDlpbnQlMjB0byUzRGVkZ2UlNUJpJTVELnRvJTNCJTBBJTA5JTA5JTA5aWYoIWRpcyU1QnRvJTVEJTI2JTI2ZWRnZSU1QmklNUQudyklMjBkaXMlNUJ0byU1RCUzRGRpcyU1Qm5vdyU1RCUyQjElMkNxLnB1c2godG8pJTNCJTBBJTA5JTA5JTdEJTBBJTA5JTdEJTBBJTA5cmV0dXJuJTIwZGlzJTVCdCU1RCElM0QwJTNCJTBBJTdEJTBBaW50JTIwZGZzKGludCUyMG5vdyUyQ2ludCUyMHJlbSklN0IlMEElMDlpZihub3clM0QlM0R0KSUyMHJldHVybiUyMHJlbSUzQiUwQSUwOWludCUyMHRtcCUzRHJlbSUzQiUwQSUwOWZvcihpbnQlMjBpJTNEcmFkJTVCbm93JTVEJTNCaSUzQmklM0RlZGdlJTVCaSU1RC5ueHQpJTdCJTBBJTA5JTA5aW50JTIwdG8lM0RlZGdlJTVCaSU1RC50byUzQnJhZCU1Qm5vdyU1RCUzRGklM0IlMEElMDklMDlpZihkaXMlNUJ0byU1RCUzRCUzRGRpcyU1Qm5vdyU1RCUyQjElMjYlMjZlZGdlJTVCaSU1RC53KSU3QiUwQSUwOSUwOSUwOWludCUyMGslM0RtaW4oZWRnZSU1QmklNUQudyUyQ3RtcCklM0IlMEElMDklMDklMDlpbnQlMjBkJTNEZGZzKHRvJTJDayklM0IlMEElMDklMDklMDllZGdlJTVCaSU1RC53LSUzRGQlMkNlZGdlJTVCaSU1RTElNUQudyUyQiUzRGQlM0IlMEElMDklMDklMDl0bXAtJTNEZCUzQiUwQSUwOSUwOSUwOWlmKCF0bXApJTIwYnJlYWslM0IlMEElMDklMDklN0QlMEElMDklN0QlMEElMDlyZXR1cm4lMjByZW0tdG1wJTNCJTBBJTdEJTBBdmVjdG9yJTNDaW50JTNFJTIwdG8lNUJfJTVEJTNCJTBBaW5saW5lJTIwdm9pZCUyMHN1YnRhc2soKSU3QiUwQSUyMCUyMCUyMCUyMGludCUyMG4lMkNtJTJDayUzQmNpbiUzRSUzRW4lM0UlM0VtJTNFJTNFayUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMCUzQmklM0MlM0RuJTJCMSUzQmklMkIlMkIpJTIwZmElNUJpJTVEJTNEaSUzQiUwQSUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMSUzQmklM0MlM0RtJTNCaSUyQiUyQiklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBjaW4lM0UlM0VvcGElNUJpJTVEJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwciUzQmNpbiUzRSUzRXIlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBmb3IoaW50JTIwaiUzRDElMkN4JTNCaiUzQyUzRHIlM0JqJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNpbiUzRSUzRXglM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZih4JTNEJTNELTEpJTIweCUzRDElM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBlbHNlJTIwaWYoeCElM0QwKSUyMHglMkIlM0QxJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwdG8lNUJpJTVELnB1c2hfYmFjayh4KSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGZvcihpbnQlMjBqJTNEMCUzQmolM0N0byU1QmklNUQuc2l6ZSgpJTNCaiUyQiUyQiklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpbnQlMjB1JTNEdG8lNUJpJTVEJTVCaiU1RCUyQ3YlM0R0byU1QmklNUQlNUIoaiUyQjEpJTI1dG8lNUJpJTVELnNpemUoKSU1RCUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHUlM0RmaW5kKHUpJTJDdiUzRGZpbmQodiklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZih1ISUzRHYpJTIwZmElNUJ1JTVEJTNEdiUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMGlmKGZpbmQoMSkhJTNEZmluZCgwKSklMjByZXR1cm4lMjBjb3V0JTNDJTNDMCUyQ3ZvaWQoKSUzQiUwQSUyMCUyMCUyMCUyMHMlM0QwJTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QwJTNCaSUzQyUzRG4lMkIxJTNCaSUyQiUyQiklMjBsYXMlNUJpJTVEJTNEaSUyQjElM0IlMEElMjAlMjAlMjAlMjBpbnQlMjBhbnMlM0QwJTJDYmFzZSUzRG4lMkIzJTNCJTBBJTIwJTIwJTIwJTIwYWRkKHMlMkNsYXMlNUIwJTVEJTJDayklM0IlMEElMjAlMjAlMjAlMjBpbnQlMjBvayUzRDAlM0IlMEElMjAlMjAlMjAlMjB3aGlsZSh0cnVlKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGFucyUyQiUyQiUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGZvcihpbnQlMjBpJTNEMCUzQmklM0MlM0RuJTJCMSUzQmklMkIlMkIpJTIwYWRkKGxhcyU1QmklNUQlMkNiYXNlJTJCaSUyQ2luZiklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbSUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwdSUzRHRvJTVCaSU1RCU1QihhbnMtMSklMjV0byU1QmklNUQuc2l6ZSgpJTVEJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwdiUzRHRvJTVCaSU1RCU1QmFucyUyNXRvJTVCaSU1RC5zaXplKCklNUQlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBhZGQobGFzJTVCdSU1RCUyQ2Jhc2UlMkJ2JTJDb3BhJTVCaSU1RCklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDAlM0JpJTNDJTNEbiUyQjElM0JpJTJCJTJCKSUyMGxhcyU1QmklNUQlM0RiYXNlJTJCaSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHQlM0RiYXNlJTJCMSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGJhc2UlM0RiYXNlJTJCbiUyQjElMkIxJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwd2hpbGUoYmZzKCkpJTIwb2slMkIlM0RkZnMocyUyQ2luZiklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihvayUzRCUzRGspJTIwcmV0dXJuJTIwY291dCUzQyUzQ2FucyUzQyUzQ2VuZGwlMkN2b2lkKCklM0IlMEElMjAlMjAlMjAlMjAlN0QlMEElN0QlMEFzaWduZWQlMjBtYWluKCklN0IlMEElMjAlMjAlMjAlMjBpb3MlM0ElM0FzeW5jX3dpdGhfc3RkaW8oZmFsc2UpJTNCJTBBJTIwJTIwJTIwJTIwaW50JTIwdCUzRDElM0IlMkYlMkZjaW4lM0UlM0V0JTNCJTBBJTIwJTIwJTIwJTIwd2hpbGUodC0tKSUyMHN1YnRhc2soKSUzQiUwQSUyMCUyMCUyMCUyMHJldHVybiUyMDAlM0IlMEElN0QlMEE="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div><div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _ 1000006</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>{<span class="hljs-type">int</span> nxt,to,w;} edge[_&lt;&lt;<span class="hljs-number">1</span>];
<span class="hljs-type">int</span> head[_],siz=<span class="hljs-number">1</span>,opa[_],fa[_],las[_];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{<span class="hljs-keyword">while</span>(x!=fa[x]) x=fa[x]=fa[fa[x]];<span class="hljs-keyword">return</span> x;}
<span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> _add(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w){edge[++siz].nxt=head[u],edge[siz].to=v,edge[siz].w=w,head[u]=siz;}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w)</span></span>{_add(u,v,w),_add(v,u,<span class="hljs-number">0</span>);}
<span class="hljs-type">int</span> dis[<span class="hljs-number">200005</span>],rad[_],s,t;
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(dis));dis[s]=<span class="hljs-number">1</span>;
	queue&lt;<span class="hljs-type">int</span>&gt; q;q.<span class="hljs-built_in">push</span>(s);
	<span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>()){
		<span class="hljs-type">int</span> now=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();
		rad[now]=head[now];
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[now];i;i=edge[i].nxt){
			<span class="hljs-type">int</span> to=edge[i].to;
			<span class="hljs-keyword">if</span>(!dis[to]&amp;&amp;edge[i].w) dis[to]=dis[now]<span class="hljs-number">+1</span>,q.<span class="hljs-built_in">push</span>(to);
		}
	}
	<span class="hljs-keyword">return</span> dis[t]!=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> now,<span class="hljs-type">int</span> rem)</span></span>{
	<span class="hljs-keyword">if</span>(now==t) <span class="hljs-keyword">return</span> rem;
	<span class="hljs-type">int</span> tmp=rem;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=rad[now];i;i=edge[i].nxt){
		<span class="hljs-type">int</span> to=edge[i].to;rad[now]=i;
		<span class="hljs-keyword">if</span>(dis[to]==dis[now]<span class="hljs-number">+1</span>&amp;&amp;edge[i].w){
			<span class="hljs-type">int</span> k=<span class="hljs-built_in">min</span>(edge[i].w,tmp);
			<span class="hljs-type">int</span> d=<span class="hljs-built_in">dfs</span>(to,k);
			edge[i].w-=d,edge[i^<span class="hljs-number">1</span>].w+=d;
			tmp-=d;
			<span class="hljs-keyword">if</span>(!tmp) <span class="hljs-keyword">break</span>;
		}
	}
	<span class="hljs-keyword">return</span> rem-tmp;
}
vector&lt;<span class="hljs-type">int</span>&gt; to[_];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    <span class="hljs-type">int</span> n,m,k;cin&gt;&gt;n&gt;&gt;m&gt;&gt;k;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=n<span class="hljs-number">+1</span>;i++) fa[i]=i;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){
        cin&gt;&gt;opa[i];
        <span class="hljs-type">int</span> r;cin&gt;&gt;r;
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>,x;j&lt;=r;j++){
            cin&gt;&gt;x;
            <span class="hljs-keyword">if</span>(x==<span class="hljs-number">-1</span>) x=<span class="hljs-number">1</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x!=<span class="hljs-number">0</span>) x+=<span class="hljs-number">1</span>;
            to[i].<span class="hljs-built_in">push_back</span>(x);
        }
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;to[i].<span class="hljs-built_in">size</span>();j++){
            <span class="hljs-type">int</span> u=to[i][j],v=to[i][(j<span class="hljs-number">+1</span>)%to[i].<span class="hljs-built_in">size</span>()];
            u=<span class="hljs-built_in">find</span>(u),v=<span class="hljs-built_in">find</span>(v);
            <span class="hljs-keyword">if</span>(u!=v) fa[u]=v;
        }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">find</span>(<span class="hljs-number">1</span>)!=<span class="hljs-built_in">find</span>(<span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span> cout&lt;&lt;<span class="hljs-number">0</span>,<span class="hljs-built_in">void</span>();
    s=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=n<span class="hljs-number">+1</span>;i++) las[i]=i<span class="hljs-number">+1</span>;
    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>,base=n<span class="hljs-number">+3</span>;
    <span class="hljs-built_in">add</span>(s,las[<span class="hljs-number">0</span>],k);
    <span class="hljs-type">int</span> ok=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>){
        ans++;
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=n<span class="hljs-number">+1</span>;i++) <span class="hljs-built_in">add</span>(las[i],base+i,inf);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){
            <span class="hljs-type">int</span> u=to[i][(ans<span class="hljs-number">-1</span>)%to[i].<span class="hljs-built_in">size</span>()];
            <span class="hljs-type">int</span> v=to[i][ans%to[i].<span class="hljs-built_in">size</span>()];
            <span class="hljs-built_in">add</span>(las[u],base+v,opa[i]);
        }
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=n<span class="hljs-number">+1</span>;i++) las[i]=base+i;
        t=base<span class="hljs-number">+1</span>;
        base=base+n<span class="hljs-number">+1</span><span class="hljs-number">+1</span>;
        <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>()) ok+=<span class="hljs-built_in">dfs</span>(s,inf);
        <span class="hljs-keyword">if</span>(ok==k) <span class="hljs-keyword">return</span> cout&lt;&lt;ans&lt;&lt;endl,<span class="hljs-built_in">void</span>();
    }
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t=<span class="hljs-number">1</span>;<span class="hljs-comment">//cin&gt;&gt;t;</span>
    <span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h4 id="p2765-mo-shu-qiu-wen-ti" tabindex="-1">P2765 魔术球问题</h4>
<p><a href="https://www.luogu.com.cn/problem/P2765">https://www.luogu.com.cn/problem/P2765</a></p>
<p><strong>题目描述</strong></p>
<p>假设有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 根柱子，现要按下述规则在这 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 根柱子中依次放入编号为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>，...的球“</p>
<ol>
<li>
<p>每次只能在某根柱子的最上面放球。</p>
</li>
<li>
<p>同一根柱子中，任何 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 个相邻球的编号之和为完全平方数。</p>
</li>
</ol>
<p>试设计一个算法，计算出在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 根柱子上最多能放多少个球。例如，在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> 根柱子上最多可放 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>11</mn></mrow><annotation encoding="application/x-tex">11</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">11</span></span></span></span> 个球。</p>
<p>对于给定的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>，计算在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 根柱子上最多能放多少个球。</p>
<p><strong>数据范围</strong></p>
<p>对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">100\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span></span></span> 的数据，保证 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>55</mn></mrow><annotation encoding="application/x-tex">1 \leq n \leq 55</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">55</span></span></span></span>。</p>
<p><strong>笔记</strong></p>
<p>如果两个数能构成完全平方数，那么我们就把这两个数字连边，并规定一定是大的数字连向小的数字（其实小的数字往大的数字连边也可以，总之就是要保证一个顺序，但是大连小的话在后面补充建边时更有优势）</p>
<p>如果我们要判断答案是否为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，那么就相当于现在我们有一个含有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 个点的 DAG，并去判断这个 DAG 的最小不相交路径覆盖是否为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></p>
<p>我们沿用上道题的做法，枚举答案。考虑答案增加一，那么我们就相当于二分图两边多了个点，然后把这个点连向相加可以为完全平方数的数，然后在仅对新增的这个点跑最大匹配就可以了</p>
<p>设当前点数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span>，当前最大匹配为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">ok</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>，那么如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi><mo>−</mo><mi>o</mi><mi>k</mi><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">ans-ok=n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 说明 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span> 即为答案。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span></span></span></span> 增加 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">ok</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 可能增加 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 也可能不增加，所以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi><mo>−</mo><mi>o</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">ans-ok</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 是单调不减的，所以直接枚举的正确性是可以保证的</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBdmVjdG9yJTNDaW50JTNFJTIwdmUlNUIxMDAwMDA2JTVEJTNCJTBBaW50JTIwbWF0Y2glNUIxMDAwMDA2JTVEJTJDdCU1QjEwMDAwMDYlNUQlMkNueHQlNUIxMDAwMDA2JTVEJTNCJTBBYm9vbCUyMGRmcyhpbnQlMjB4JTJDaW50JTIwdGFnKSU3QiUwQSUyMCUyMCUyMCUyMGlmKHQlNUJ4JTVEJTNEJTNEdGFnKSUyMHJldHVybiUyMGZhbHNlJTNCJTBBJTIwJTIwJTIwJTIwdCU1QnglNUQlM0R0YWclM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwdG8lM0F2ZSU1QnglNUQpJTIwaWYoIW1hdGNoJTVCdG8lNUQlN0MlN0NkZnMobWF0Y2glNUJ0byU1RCUyQ3RhZykpJTIwcmV0dXJuJTIwbWF0Y2glNUJ0byU1RCUzRHglMkN0cnVlJTNCJTBBJTIwJTIwJTIwJTIwcmV0dXJuJTIwZmFsc2UlM0IlMEElN0QlMEFpbmxpbmUlMjB2b2lkJTIwc3VidGFzaygpJTdCJTBBJTIwJTIwJTIwJTIwaW50JTIwbiUzQmNpbiUzRSUzRW4lM0IlMEElMjAlMjAlMjAlMjBpbnQlMjBhbnMlM0QwJTJDb2slM0QwJTJDdGFnJTNEMCUzQiUwQSUyMCUyMCUyMCUyMHdoaWxlKHRydWUpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwYW5zJTJCJTJCJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QyJTNCaSppJTNDMiphbnMlM0JpJTJCJTJCKSU3QiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKGkqaSUzQyUzRGFucyklMjBjb250aW51ZSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHZlJTVCYW5zJTVELnB1c2hfYmFjayhpKmktYW5zKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKGRmcyhhbnMlMkMlMkIlMkJ0YWcpKSUyMG9rJTJCJTJCJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYoYW5zLW9rJTNFbiklMjBicmVhayUzQiUwQSUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMGFucy0tJTNCJTBBJTIwJTIwJTIwJTIwY291dCUzQyUzQ2FucyUzQyUzQ2VuZGwlM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEYW5zJTNCaSUyQiUyQiklMjBueHQlNUJtYXRjaCU1QmklNUQlNUQlM0RpJTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QxJTNCaSUzQyUzRGFucyUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYobWF0Y2glNUJpJTVEKSUyMGNvbnRpbnVlJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaW50JTIwbm93JTNEaSUzQmNvdXQlM0MlM0Nub3clM0MlM0MnJTIwJyUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHdoaWxlKG54dCU1Qm5vdyU1RCklMjBjb3V0JTNDJTNDbnh0JTVCbm93JTVEJTNDJTNDJyUyMCclMkNub3clM0RueHQlNUJub3clNUQlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBjb3V0JTNDJTNDZW5kbCUzQiUwQSUyMCUyMCUyMCUyMCU3RCUwQSU3RCUwQXNpZ25lZCUyMG1haW4oKSU3QiUwQSUyMCUyMCUyMCUyMGlvcyUzQSUzQXN5bmNfd2l0aF9zdGRpbyhmYWxzZSklM0IlMEElMjAlMjAlMjAlMjBpbnQlMjB0JTNEMSUzQiUyRiUyRmNpbiUzRSUzRXQlM0IlMEElMjAlMjAlMjAlMjB3aGlsZSh0LS0pJTIwc3VidGFzaygpJTNCJTBBJTIwJTIwJTIwJTIwcmV0dXJuJTIwMCUzQiUwQSU3RCUwQQ=="><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
vector&lt;<span class="hljs-type">int</span>&gt; ve[<span class="hljs-number">1000006</span>];
<span class="hljs-type">int</span> match[<span class="hljs-number">1000006</span>],t[<span class="hljs-number">1000006</span>],nxt[<span class="hljs-number">1000006</span>];
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> tag)</span></span>{
    <span class="hljs-keyword">if</span>(t[x]==tag) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    t[x]=tag;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> to:ve[x]) <span class="hljs-keyword">if</span>(!match[to]||<span class="hljs-built_in">dfs</span>(match[to],tag)) <span class="hljs-keyword">return</span> match[to]=x,<span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    <span class="hljs-type">int</span> n;cin&gt;&gt;n;
    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>,ok=<span class="hljs-number">0</span>,tag=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>){
        ans++;
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i*i&lt;<span class="hljs-number">2</span>*ans;i++){
            <span class="hljs-keyword">if</span>(i*i&lt;=ans) <span class="hljs-keyword">continue</span>;
            ve[ans].<span class="hljs-built_in">push_back</span>(i*i-ans);
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">dfs</span>(ans,++tag)) ok++;
        <span class="hljs-keyword">if</span>(ans-ok&gt;n) <span class="hljs-keyword">break</span>;
    }
    ans--;
    cout&lt;&lt;ans&lt;&lt;endl;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=ans;i++) nxt[match[i]]=i;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=ans;i++){
        <span class="hljs-keyword">if</span>(match[i]) <span class="hljs-keyword">continue</span>;
        <span class="hljs-type">int</span> now=i;cout&lt;&lt;now&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>;
        <span class="hljs-keyword">while</span>(nxt[now]) cout&lt;&lt;nxt[now]&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>,now=nxt[now];
        cout&lt;&lt;endl;
    }
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t=<span class="hljs-number">1</span>;<span class="hljs-comment">//cin&gt;&gt;t;</span>
    <span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h4 id="p2766-zui-chang-bu-xia-jiang-zi-xu-lie-wen-ti" tabindex="-1">P2766 最长不下降子序列问题</h4>
<p><a href="https://www.luogu.com.cn/problem/P2766">https://www.luogu.com.cn/problem/P2766</a></p>
<p><strong>题目描述</strong></p>
<p>给定正整数序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1 \ldots, x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<ol>
<li>计算其最长不下降子序列的长度 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>。</li>
<li>如果每个元素只允许使用一次，计算从给定的序列中最多可取出多少个长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 的不下降子序列。</li>
<li>如果允许在取出的序列中多次使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>（其他元素仍然只允许使用一次），则从给定序列中最多可取出多少个<strong>不同的</strong>长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 的不下降子序列。</li>
</ol>
<p>令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>a</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">a_1, a_2, \ldots, a_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为构造 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> 时所使用的下标，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>b</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>b</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">b_1, b_2, \ldots, b_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为构造 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 时所使用的下标。且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>s</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\forall i \in [1,s-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord">∀</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>，都有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">a_i \lt a_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>b</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">b_i \lt b_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>。则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> <strong>不同</strong>，当且仅当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∃</mi><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\exists i \in [1,s]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord">∃</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">s</span><span class="mclose">]</span></span></span></span>，使得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo mathvariant="normal">≠</mo><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i \neq b_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p><strong>数据范围</strong></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">1 \le n\le 500</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">500</span></span></span></span></p>
<p><strong>笔记</strong></p>
<p>直接使用 dp 跑最长不下降子序列。不用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 做法的原因是 dp 的话我们就知道以每个数结尾能够形成的最长不下降子序列的长度是多少，这有助于我们计算方案</p>
<p>如果所有的数都可以重复取，那么我们可以用组合数学直接计算出来方案个数。但现在一个数只能取一次，即使考虑 dp 计算的话，后效性也太大</p>
<p>于是此时网络流又派上用场了，我们按 dp 转移阶段分层，然后如果一个点能够转移到另一个点，就连边。直接这么连的话有些点会被取多次。于是又是套路的拆点，限制经过点的流量</p>
<p>对于第三问，把边权改为 inf 后继续增广就可以了</p>
<pre><div class="head"><div class="language">cpp</div><div class="copy" data="JTIzaW5jbHVkZSUzQ2JpdHMlMkZzdGRjJTJCJTJCLmglM0UlMEElMjNkZWZpbmUlMjBpbnQlMjBsb25nJTIwbG9uZyUwQSUyM2RlZmluZSUyMHVsbCUyMHVuc2lnbmVkJTIwbG9uZyUyMGxvbmclMEElMjNkZWZpbmUlMjBscyhrKSUyMChrKSUzQyUzQzElMEElMjNkZWZpbmUlMjBycyhrKSUyMChrKSUzQyUzQzElN0MxJTBBJTIzZGVmaW5lJTIwZGVidWcoeCklMjBjb3V0JTNDJTNDJTIzeCUzQyUzQyUyMiUzRCUyMiUzQyUzQ3glM0MlM0NlbmRsJTBBdXNpbmclMjBuYW1lc3BhY2UlMjBzdGQlM0IlMEFjb25zdCUyMGludCUyMGluZiUzRDB4M2YzZjNmM2YzZjNmM2YzZiUzQiUwQWNvbnN0JTIwaW50JTIwbW9kJTNEMCUzQiUwQXR5cGVkZWYlMjBwYWlyJTNDaW50JTJDaW50JTNFJTIwcGlpJTNCJTBBJTIzZGVmaW5lJTIwXyUyMDUwNSUwQWludCUyMGElNUJfJTVEJTJDZHAlNUJfJTVEJTJDc2l6JTNEMSUyQ2hlYWQlNUJfJTVEJTJDcyUyQ3QlM0IlMEFzdHJ1Y3QlMjBFZGdlJTdCaW50JTIwbnh0JTJDdG8lMkN3JTNCJTdEJTIwZWRnZSU1QjEwMDAwMDYlNUQlM0IlMEFpbmxpbmUlMjB2b2lkJTIwX2FkZChpbnQlMjB1JTJDaW50JTIwdiUyQ2ludCUyMHcpJTdCZWRnZSU1QiUyQiUyQnNpeiU1RC5ueHQlM0RoZWFkJTVCdSU1RCUyQ2VkZ2UlNUJzaXolNUQudG8lM0R2JTJDZWRnZSU1QnNpeiU1RC53JTNEdyUyQ2hlYWQlNUJ1JTVEJTNEc2l6JTNCJTdEJTBBaW5saW5lJTIwdm9pZCUyMGFkZChpbnQlMjB1JTJDaW50JTIwdiUyQ2ludCUyMHcpJTdCX2FkZCh1JTJDdiUyQ3cpJTJDX2FkZCh2JTJDdSUyQzApJTNCJTdEJTBBaW50JTIwZGlzJTVCXyU1RCUyQ3JhZCU1Ql8lNUQlM0IlMEFib29sJTIwYmZzKCklN0IlMEElMDltZW1zZXQoZGlzJTJDMCUyQ3NpemVvZihkaXMpKSUzQmRpcyU1QnMlNUQlM0QxJTNCJTBBJTA5cXVldWUlM0NpbnQlM0UlMjBxJTNCcS5wdXNoKHMpJTNCJTBBJTA5d2hpbGUoIXEuZW1wdHkoKSklN0IlMEElMDklMDlpbnQlMjBub3clM0RxLmZyb250KCklM0JxLnBvcCgpJTNCJTBBJTA5JTA5cmFkJTVCbm93JTVEJTNEaGVhZCU1Qm5vdyU1RCUzQiUwQSUwOSUwOWZvcihpbnQlMjBpJTNEaGVhZCU1Qm5vdyU1RCUzQmklM0JpJTNEZWRnZSU1QmklNUQubnh0KSU3QiUwQSUwOSUwOSUwOWludCUyMHRvJTNEZWRnZSU1QmklNUQudG8lM0IlMEElMDklMDklMDlpZighZGlzJTVCdG8lNUQlMjYlMjZlZGdlJTVCaSU1RC53KSUyMGRpcyU1QnRvJTVEJTNEZGlzJTVCbm93JTVEJTJCMSUyQ3EucHVzaCh0byklM0IlMEElMDklMDklN0QlMEElMDklN0QlMEElMDlyZXR1cm4lMjBkaXMlNUJ0JTVEISUzRDAlM0IlMEElN0QlMEFpbnQlMjBkZnMoaW50JTIwbm93JTJDaW50JTIwcmVtKSU3QiUwQSUwOWlmKG5vdyUzRCUzRHQpJTIwcmV0dXJuJTIwcmVtJTNCJTBBJTA5aW50JTIwdG1wJTNEcmVtJTNCJTBBJTA5Zm9yKGludCUyMGklM0RyYWQlNUJub3clNUQlM0JpJTNCaSUzRGVkZ2UlNUJpJTVELm54dCklN0IlMEElMDklMDlpbnQlMjB0byUzRGVkZ2UlNUJpJTVELnRvJTNCcmFkJTVCbm93JTVEJTNEaSUzQiUwQSUwOSUwOWlmKGRpcyU1QnRvJTVEJTNEJTNEZGlzJTVCbm93JTVEJTJCMSUyNiUyNmVkZ2UlNUJpJTVELncpJTdCJTBBJTA5JTA5JTA5aW50JTIwayUzRG1pbihlZGdlJTVCaSU1RC53JTJDdG1wKSUzQiUwQSUwOSUwOSUwOWludCUyMGQlM0RkZnModG8lMkNrKSUzQiUwQSUwOSUwOSUwOWVkZ2UlNUJpJTVELnctJTNEZCUyQ2VkZ2UlNUJpJTVFMSU1RC53JTJCJTNEZCUzQiUwQSUwOSUwOSUwOXRtcC0lM0RkJTNCJTBBJTA5JTA5JTA5aWYoIXRtcCklMjBicmVhayUzQiUwQSUwOSUwOSU3RCUwQSUwOSU3RCUwQSUwOXJldHVybiUyMHJlbS10bXAlM0IlMEElN0QlMEFpbmxpbmUlMjB2b2lkJTIwc3VidGFzaygpJTdCJTBBJTIwJTIwJTIwJTIwaW50JTIwbiUzQmNpbiUzRSUzRW4lM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTIwY2luJTNFJTNFYSU1QmklNUQlM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTIwZHAlNUJpJTVEJTNEMSUzQiUwQSUyMCUyMCUyMCUyMGludCUyMG1heHglM0QxJTNCJTBBJTIwJTIwJTIwJTIwZm9yKGludCUyMGklM0QyJTNCaSUzQyUzRG4lM0JpJTJCJTJCKSUyMGZvcihpbnQlMjBqJTNEMSUzQmolM0NpJTNCaiUyQiUyQiklMjBpZihhJTVCaiU1RCUzQyUzRGElNUJpJTVEKSUyMGRwJTVCaSU1RCUzRG1heChkcCU1QmklNUQlMkNkcCU1QmolNUQlMkIxKSUyQ21heHglM0RtYXgobWF4eCUyQ2RwJTVCaSU1RCklM0IlMEElMjAlMjAlMjAlMjBjb3V0JTNDJTNDbWF4eCUzQyUzQ2VuZGwlM0IlMEElMjAlMjAlMjAlMjBpZihtYXh4JTNEJTNEMSklMjByZXR1cm4lMjBjb3V0JTNDJTNDbiUzQyUzQ2VuZGwlM0MlM0NuJTJDdm9pZCgpJTNCJTBBJTIwJTIwJTIwJTIwcyUzRDAlMkN0JTNEMipuJTJCMSUzQiUwQSUyMCUyMCUyMCUyMGludCUyMGUxJTJDZW4lM0IlMEElMjAlMjAlMjAlMjBmb3IoaW50JTIwaSUzRDElM0JpJTNDJTNEbiUzQmklMkIlMkIpJTdCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwYWRkKDIqaS0xJTJDMippJTJDMSklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihpJTNEJTNEMSklMjBlMSUzRHNpei0xJTNCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwaWYoaSUzRCUzRG4pJTIwZW4lM0RzaXotMSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGlmKGRwJTVCaSU1RCUzRCUzRDEpJTIwYWRkKHMlMkMyKmktMSUyQ2luZiklM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZihkcCU1QmklNUQlM0QlM0RtYXh4KSUyMGFkZCgyKmklMkN0JTJDaW5mKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGZvcihpbnQlMjBqJTNEMSUzQmolM0NpJTNCaiUyQiUyQiklN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZighKGElNUJqJTVEJTNDJTNEYSU1QmklNUQlMjYlMjZkcCU1QmolNUQlM0QlM0RkcCU1QmklNUQtMSkpJTIwY29udGludWUlM0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBhZGQoMipqJTJDMippLTElMkMxKSUzQiUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCUyMCUyMGludCUyMGFucyUzRDAlM0IlMEElMjAlMjAlMjAlMjB3aGlsZShiZnMoKSklMjBhbnMlMkIlM0RkZnMocyUyQ2luZiklM0IlMEElMjAlMjAlMjAlMjBjb3V0JTNDJTNDYW5zJTNDJTNDZW5kbCUzQiUwQSUyMCUyMCUyMCUyMGVkZ2UlNUJlMSU1RC53JTNEaW5mJTNCJTBBJTIwJTIwJTIwJTIwZWRnZSU1QmVuJTVELnclM0RpbmYlM0IlMEElMjAlMjAlMjAlMjB3aGlsZShiZnMoKSklMjBhbnMlMkIlM0RkZnMocyUyQ2luZiklM0IlMEElMjAlMjAlMjAlMjBjb3V0JTNDJTNDYW5zJTNCJTBBJTdEJTBBc2lnbmVkJTIwbWFpbigpJTdCJTBBJTIwJTIwJTIwJTIwaW9zJTNBJTNBc3luY193aXRoX3N0ZGlvKGZhbHNlKSUzQiUwQSUyMCUyMCUyMCUyMGludCUyMHQlM0QxJTNCJTJGJTJGY2luJTNFJTNFdCUzQiUwQSUyMCUyMCUyMCUyMHdoaWxlKHQtLSklMjBzdWJ0YXNrKCklM0IlMEElMjAlMjAlMjAlMjByZXR1cm4lMjAwJTNCJTBBJTdEJTBB"><svg focusable="false" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"></path></svg></div></div><code class="hljs"><div class="lines"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div></div><div class="code"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ull unsigned long long</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(k) (k)&lt;&lt;1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(k) (k)&lt;&lt;1|1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="hljs-string">&quot;=&quot;</span>&lt;&lt;x&lt;&lt;endl</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> inf=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> mod=<span class="hljs-number">0</span>;
<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; pii;
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _ 505</span>
<span class="hljs-type">int</span> a[_],dp[_],siz=<span class="hljs-number">1</span>,head[_],s,t;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>{<span class="hljs-type">int</span> nxt,to,w;} edge[<span class="hljs-number">1000006</span>];
<span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> _add(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w){edge[++siz].nxt=head[u],edge[siz].to=v,edge[siz].w=w,head[u]=siz;}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w)</span></span>{_add(u,v,w),_add(v,u,<span class="hljs-number">0</span>);}
<span class="hljs-type">int</span> dis[_],rad[_];
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>{
	<span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(dis));dis[s]=<span class="hljs-number">1</span>;
	queue&lt;<span class="hljs-type">int</span>&gt; q;q.<span class="hljs-built_in">push</span>(s);
	<span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>()){
		<span class="hljs-type">int</span> now=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();
		rad[now]=head[now];
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[now];i;i=edge[i].nxt){
			<span class="hljs-type">int</span> to=edge[i].to;
			<span class="hljs-keyword">if</span>(!dis[to]&amp;&amp;edge[i].w) dis[to]=dis[now]<span class="hljs-number">+1</span>,q.<span class="hljs-built_in">push</span>(to);
		}
	}
	<span class="hljs-keyword">return</span> dis[t]!=<span class="hljs-number">0</span>;
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> now,<span class="hljs-type">int</span> rem)</span></span>{
	<span class="hljs-keyword">if</span>(now==t) <span class="hljs-keyword">return</span> rem;
	<span class="hljs-type">int</span> tmp=rem;
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=rad[now];i;i=edge[i].nxt){
		<span class="hljs-type">int</span> to=edge[i].to;rad[now]=i;
		<span class="hljs-keyword">if</span>(dis[to]==dis[now]<span class="hljs-number">+1</span>&amp;&amp;edge[i].w){
			<span class="hljs-type">int</span> k=<span class="hljs-built_in">min</span>(edge[i].w,tmp);
			<span class="hljs-type">int</span> d=<span class="hljs-built_in">dfs</span>(to,k);
			edge[i].w-=d,edge[i^<span class="hljs-number">1</span>].w+=d;
			tmp-=d;
			<span class="hljs-keyword">if</span>(!tmp) <span class="hljs-keyword">break</span>;
		}
	}
	<span class="hljs-keyword">return</span> rem-tmp;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">subtask</span><span class="hljs-params">()</span></span>{
    <span class="hljs-type">int</span> n;cin&gt;&gt;n;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) dp[i]=<span class="hljs-number">1</span>;
    <span class="hljs-type">int</span> maxx=<span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++) <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;i;j++) <span class="hljs-keyword">if</span>(a[j]&lt;=a[i]) dp[i]=<span class="hljs-built_in">max</span>(dp[i],dp[j]<span class="hljs-number">+1</span>),maxx=<span class="hljs-built_in">max</span>(maxx,dp[i]);
    cout&lt;&lt;maxx&lt;&lt;endl;
    <span class="hljs-keyword">if</span>(maxx==<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> cout&lt;&lt;n&lt;&lt;endl&lt;&lt;n,<span class="hljs-built_in">void</span>();
    s=<span class="hljs-number">0</span>,t=<span class="hljs-number">2</span>*n<span class="hljs-number">+1</span>;
    <span class="hljs-type">int</span> e1,en;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){
        <span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>*i<span class="hljs-number">-1</span>,<span class="hljs-number">2</span>*i,<span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span>(i==<span class="hljs-number">1</span>) e1=siz<span class="hljs-number">-1</span>;
        <span class="hljs-keyword">if</span>(i==n) en=siz<span class="hljs-number">-1</span>;
        <span class="hljs-keyword">if</span>(dp[i]==<span class="hljs-number">1</span>) <span class="hljs-built_in">add</span>(s,<span class="hljs-number">2</span>*i<span class="hljs-number">-1</span>,inf);
        <span class="hljs-keyword">if</span>(dp[i]==maxx) <span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>*i,t,inf);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;i;j++){
            <span class="hljs-keyword">if</span>(!(a[j]&lt;=a[i]&amp;&amp;dp[j]==dp[i]<span class="hljs-number">-1</span>)) <span class="hljs-keyword">continue</span>;
            <span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>*j,<span class="hljs-number">2</span>*i<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>);
        }
    }
    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>()) ans+=<span class="hljs-built_in">dfs</span>(s,inf);
    cout&lt;&lt;ans&lt;&lt;endl;
    edge[e1].w=inf;
    edge[en].w=inf;
    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>()) ans+=<span class="hljs-built_in">dfs</span>(s,inf);
    cout&lt;&lt;ans;
}
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-type">int</span> t=<span class="hljs-number">1</span>;<span class="hljs-comment">//cin&gt;&gt;t;</span>
    <span class="hljs-keyword">while</span>(t--) <span class="hljs-built_in">subtask</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
